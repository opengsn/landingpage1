/*! For license information please see 63.7d02effdd85375e19724.js.LICENSE.txt */
(self.webpackChunkrm_frontend=self.webpackChunkrm_frontend||[]).push([[63],{1072:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-branding",r=(0,d.f)(n||(o=['\n\t<div class="rm-branding offscreen-initially">\n\t<a class="rm-branding-button" href="<%="https://readymag.com" + \'?\' + utm_params%>" target="_blank"></a>\n\t</div>\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1059:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-cart-sidebar",r=(0,d.f)(n||(o=['\n  <div id="cart-sidebar" class="cart-sidebar<% if (isViewer) { %> cart-in-viewer<% } %><% if (isMobile) { %> cart-is-mobile<% } %>">\n    <div class="close-button" data-alt="Close cart" data-alt-pos="bottom" data-alt-offset="9">\n      <div class="line-1"></div>\n      <div class="line-3"></div>\n    </div>\n\n    <div class="text-size-calc-container"></div>\n\n    <div class="cart-sidebar-wrapper">\n      <div class="cart-sidebar-tabs">\n\n        <div class="cart-sidebar-tab tab-items active">\n          <div class="sidebar-header">\n            <div class="sidebar-title">\n              <input\n                  type="text"\n                  class="cart-text-input cart-title-input"\n                  name="title"\n                  placeholder="Cart"\n                  maxlength="32"\n                  translate="no"\n                  autocomplete="off"\n                  autocorrect="off"\n                  spellcheck="false"\n                  <% if (isViewer) { %>readonly<% } %>\n                />\n            </div>\n            <div class="sidebar-settings-container"></div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="cart-items-list"></div>\n            <div class="sidebar-btn сheck-out-btn" data-tab="tab-inputs" aria-labelledby="cart-sidebar-checkout-button">\n              <input\n                type="text"\n                class="cart-text-input cart-checkout-input"\n                name="checkout"\n                placeholder="Check out"\n                maxlength="32"\n                translate="no"\n                autoComplete="off"\n                autocorrect="off"\n                spellcheck="false"\n                <% if (isViewer) { %>readonly<% } %>\n              />\n              <img class="btn-icon-right svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n            <div class="empty-cart">\n              <div class="empty-cart-title">\n                <input\n                  type="text"\n                  class="cart-text-input empty-cart-title-input"\n                  name="emptyСartTitle"\n                  placeholder="Cart is empty"\n                  maxlength="32"\n                  translate="no"\n                  autoComplete="off"\n                  autocorrect="off"\n                  spellcheck="false"\n                  <% if (isViewer) { %>readonly<% } %>\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-inputs">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-items">\n                <img class="btn-icon-center svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward" data-tab="tab-order">\n              Summary\n              <img class="btn-icon-right svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n          </div>\n          <div class="sidebar-body">\n            <div class="order-details-form shipping-form">\n              <div class="form-title">Shipping address</div>\n              <div class="form-row">\n                <div class="form-error country-error hidden"></div>\n                <div class="countries-select"></div>\n              </div>\n              <div class="form-row">\n                <div class="form-error name-error hidden"></div>\n                <input type="text" class="form-input name-input" name="name" placeholder="Customer name" />\n              </div>\n              <div class="form-row">\n                <div class="form-error line1-error hidden"></div>\n                <input type="text" class="form-input line1-input" name="line1" placeholder="Address" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input line2-input" name="line2" placeholder="Apt, unit, building, floor…" />\n              </div>\n              <div class="form-row">\n                <div class="form-error city-error hidden"></div>\n                <input type="text" class="form-input city-input" name="city" placeholder="City" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input state-input" name="state" placeholder="State/Region" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input postal_code-input" name="postal_code" placeholder="Zip/Postal code" />\n              </div>\n              <div class="form-row">\n                <div class="form-error phone-error hidden"></div>\n                <input type="text" class="form-input phone-input" name="phone" placeholder="Phone" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Email</div>\n              <div class="form-row">\n                <div class="form-error email-error hidden"></div>\n                <input type="text" class="form-input email-input" name="email" placeholder="address@sample.com" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Note</div>\n              <div class="form-row">\n                <textarea class="form-input note-input" rows="4" name="note" placeholder="Add shipping details"></textarea>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-order">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-inputs">\n                <img class="btn-icon-center svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward cart-pay-btn hidden" data-tab="tab-checkout">\n              Pay\n              <img class="btn-icon-right svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="order-details">\n              <div class="order-items-block order-row">\n                <div class="order-title-row summary-title">Order summary</div>\n                <div class="order-items-list order-info-block"></div>\n              </div>\n              <div class="order-id-container order-row">\n                  <div class="order-title-row">Order ID</div>\n                  <div class="order-id order-info-block"></div>\n              </div>\n              <div class="shipping-details">\n                <div class="shipping-address order-row">\n                  <div class="order-title-row">Shipping address</div>\n                  <div class="order-shipping-address order-info-block"></div>\n                </div>\n                <div class="shipping-method order-row">\n                    <div class="order-title-row">Shipping method</div>\n                    <div class="order-shipping-method order-info-block"></div>\n                </div>\n              </div>\n              <div class="shipping-tax-size order-row">\n                <div class="order-title-row">Order tax</div>\n                <div class="order-tax order-info-block"></div>\n              </div>\n              <div class="shipping-email order-row hidden">\n                    <div class="order-title-row">Email</div>\n                    <div class="order-shipping-email order-info-block"></div>\n              </div>\n              <div class="shipping-phone order-row hidden">\n                    <div class="order-title-row">Phone</div>\n                    <div class="order-shipping-phone order-info-block"></div>\n              </div>\n              <div class="shipping-total-price order-row">\n                <div class="order-title-row">Grand total</div>\n                <div class="order-total-price order-info-block"></div>\n              </div>\n            </div>\n          </div>\n          <div class="order-error hidden">\n            <div class="order-error-container">\n              <div class="order-error-title">\n                Error\n              </div>\n              <div class="order-error-message">\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-checkout">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-order">\n                <img class="btn-icon-center svg" src="<%= imgPublicPath %>img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="payment-title">Pay with card</div>\n            <form action="/charge" method="post" id="payment-form">\n              <div class="form-row">\n                <div class="form-error card-number-error hidden"></div>\n                <div id="card-number-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-expiry-error hidden"></div>\n                <div id="card-expiry-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-name-error hidden"></div>\n                <input type="text" class="payment-input card-name-input hidden" name="name" placeholder="Name on card" />\n              </div>\n              <div class="form-row">\n                <div class="form-error card-cvc-error hidden"></div>\n                <div id="card-cvc-element" class="payment-input">\n                </div>\n              </div>\n\n              \x3c!-- Used to display Element errors. --\x3e\n              <div id="card-number-errors" role="alert"></div>\n              <div id="card-expiry-errors" role="alert"></div>\n              <div id="card-name-errors" role="alert"></div>\n              <div id="card-cvc-errors" role="alert"></div>\n\n              <div id="payment-failed-msg">\n                <div class="failed-msg-content">\n                  <div class="error-icon">\n                    <svg width="4px" height="27px" viewBox="0 0 4 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                          <g transform="translate(-1010.000000, -261.000000)" fill="#FFFFFF" fill-rule="nonzero">\n                              <g transform="translate(1010.000000, 261.000000)">\n                                  <g>\n                                      <path d="M2,0 C3.05322259,-1.93473851e-16 3.90702819,0.853805605 3.90702819,1.90702819 C3.90702819,1.93727706 3.90630849,1.96752165 3.9048697,1.99773628 L3.04535404,20.0475651 C3.01996411,20.5807536 2.58027854,21 2.0464859,21 L1.9535141,21 C1.41972146,21 0.980035886,20.5807536 0.954645959,20.0475651 L0.0951302988,1.99773628 C0.045033609,0.945705789 0.857261433,0.0522551831 1.90929192,0.00215849327 C1.93950655,0.000719701408 1.96975113,5.55662667e-18 2,0 Z"></path>\n                                      <circle cx="2" cy="25" r="2"></circle>\n                                  </g>\n                              </g>\n                          </g>\n                      </g>\n                    </svg>\n                  </div>\n                  <div class="error-message"></div>\n                </div>\n              </div>\n\n              <button class="sidebar-btn cart-payment-btn">Pay</button>\n            </form>\n            <div id="payment-request-button"></div>\n            <div class="cart-cancel-btn">Cancel order</div>\n          </div>\n          <div id="payment-success-msg">\n            <div class="success-msg-content">\n              <div class="title">Payment completed</div>\n              <div class="description">Check your email for details</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1070:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-mag-menu",r=(0,d.f)(n||(o=['\n\t<noindex>\n\t\t<div class="mag-menu <%=(!hasProjectInfo ? \'no-project-info\' : \'\')%>" data-nosnippet>\n\t\t\t<div class="menu-wrapper">\n\n\t\t\t\t<% if (hasProjectInfo) { %>\n\t\t\t\t\t<div class="menu-info">\n\n\t\t\t\t\t\t<a class="link <%= !common.isDownloadedSource? \'\': \'inactive-link\'%>" href="<%-mag.model.user.getLink()%>">\n\t\t\t\t\t\t\t<div class="userpic" style="background-image:url(\'<%=mag.model.user.getUserpic(64)%>\')"></div>\n\t\t\t\t\t\t\t<div class="username"><%-mag.user.name%></div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class="published-by" data_caption="published by" data_date="<%=publishDate%>"></div>\n\t\t\t\t\t\t<div class="mag-title"><%-mag.title%></div>\n\t\t\t\t\t</div>\n\t\t\t\t<% } %>\n\n\t\t\t\t<div class="scroll-wrapper">\n\n\t\t\t\t\t<div class="pages-wrapper has-<%=viewerType%>-scroll">\n\t\t\t\t\t\t<div class="pages">\n\n\t\t\t\t\t\t\t<%_.each(pages, function(page, ind) {\n\t\t\t\t\t\t\t\tvar attr = viewerType == \'horizontal\' ? \'left\' : \'top\',\n\t\t\t\t\t\t\t\t\t\tval = ind * (viewerType == \'horizontal\' ? width : height);\n\t\t\t\t\t\t\t%>\n\t\t\t\t\t\t\t\t<div class="page" data-id="<%=page._id%>" data-num="<%=page.num%>" data-src="<%=mag.model.getPageScreenshot(width, {_id: page._id})%>" style="width:<%=width%>px;height:<%=height%>px;<%=attr%>:<%=val%>px">\n\t\t\t\t\t\t\t\t\t<img class="screenshot" src="<%=stub%>" />\n\t\t\t\t\t\t\t\t\t<% if (page.unauthorized) { %>\n\t\t\t\t\t\t\t\t\t<div class="private-page"></div>\n\t\t\t\t\t\t\t\t\t<% } %>\n\t\t\t\t\t\t\t\t\t<div class="num <%=(page.pageNestedNum && page.pageNestedNum.length > 3 ? page.pageNestedNum.length > 4 ? \'nested-over-4\' : \'nested-over-3\' : page.num > 99 ? \'over99\' : \'\')%>"><%=page.pageNestedNum ? page.pageNestedNum : page.num%></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<%});%>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</noindex>\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1051:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-mag",r=(0,d.f)(n||(o=['\n\n\t<div class="mag">\n\t\t<div class="mag-pages-container">\n\t\t\t<div class="container disable-transitions">\n\n\t\t\t\t<div class="blackout"></div>\n\t\t\t</div>\n\t\t\t<div class="above-pages-container"></div>\n\t\t</div>\n\n\t\t<% if (hasStandaloneBottomArrow) {%>\n\t\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div></div>\n\t\t<%}%>\n\n\n\t\t<% if (isPreview) {%>\n\t\t\t<div class="mag-pages-viewport-device"></div>\n\t\t<%}%>\n\t</div>\n\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1064:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-navigation",r=(0,d.f)(n||(o=['\n\n\t<div class="navigation">\n\t\t<div class="navigation-arrow left offscreen"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div></div>\n\t\t<div class="navigation-arrow right offscreen"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div></div>\n\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div></div>\n\t</div>\n\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1053:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-page",r=(0,d.f)(n||(o=['\n\t<div class="page hidden">\n\t\t<div id="page-<%=pageNum%>-password-container" class="polyfill-sticky"></div>\n\t\t<div class="page-fixed-bg-container polyfill-sticky"></div>\n\t\t<div class="fixed-position-container-top polyfill-sticky"></div>\n\t\t<div class="fixed-position-container polyfill-sticky"></div>\n\t\t<div class="content-scroll-wrapper <%=isStickyVerticalViewer ? \'\' : \'has-vertical-scroll\'%>">\n\t\t\t<div class="content-bounds">\n\t\t\t\t<div class="page-content-container" tabindex="-1"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1068:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-share",r=(0,d.f)(n||(o=['\n\t<% if (hasOverlay) {%>\n\t\t<div class="share-popup-overlay hidden" data-nosnippet></div>\n\t<%}%>\n\n\t<div class="share-popup hidden" data-nosnippet>\n\t\t<noindex>\n\t\t\t<div class="content-wrapper">\n\n\t\t\t\t<div class="share-wrapper">\n\t\t\t\t\t<div class="caption">Share</div>\n\n\t\t\t\t\t<div class="type-selector">\n\t\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t\t<div class="type-full">Project</div>\n\t\t\t\t\t\t<div class="type-page">Current Page</div>\n\t\t\t\t\t\t<div class="arrow sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="buttons-wrapper">\n\t\t\t\t\t\t<div class="share-facebook button" data-tp="facebook"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Share</div>\n\t\t\t\t\t\t<div class="share-twitter button" data-tp="twitter"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Tweet</div>\n\t\t\t\t\t\t<div class="share-pinterest button" data-tp="pinterest"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Pin</div>\n\t\t\t\t\t\t<div class="share-linkedin button" data-tp="linkedin"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Linkedin</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<% if (!common.isDownloadedSource) { %>\n\t\t\t\t\t\t<div class="open-embed"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Embed</div>\n\t\t\t\t\t\t<div class="close">Close</div>\n\t\t\t\t\t\t<div class="send-report" data-tp="report"><div class="icon sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>Report</div>\n\t\t\t\t\t<% } %>\n\t\t\t\t</div>\n\n\t\t\t\t<% if (!common.isDownloadedSource) { %>\n\t\t\t\t\t<div class="embed-wrapper">\n\t\t\t\t\t\t<div class="caption">Embed</div>\n\n\t\t\t\t\t\t<div class="size-selector" data-selected="responsive">\n\t\t\t\t\t\t\t<div class="size responsive" data-size="responsive">Responsive</div>\n\t\t\t\t\t\t\t<div class="size big" data-size="big">512×383</div>\n\t\t\t\t\t\t\t<div class="size small" data-size="small">288×236</div>\n\t\t\t\t\t\t\t<div class="arrow sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="code-block">\n\t\t\t\t\t\t\t<div class="thumb">\n\t\t\t\t\t\t\t\t<img class="thumb-pic" src="" alt=""/>\n\t\t\t\t\t\t\t\t<div class="thumb-toolbar">\n\t\t\t\t\t\t\t\t\t<div class="icon arrows" style="background-image: url(\'<%=icons.thumbArrows%>\')"></div>\n\t\t\t\t\t\t\t\t\t<div class="icon open" style="background-image: url(\'<%=icons.thumbOpen%>\')"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<textarea class="embed-code"></textarea>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="back">Back</div>\n\t\t\t\t\t</div>\n\t\t\t\t<% } %>\n\t\t\t</div>\n\n\t\t\t<div class="corner-wrapper">\n\t\t\t\t<div class="corner"></div>\n\t\t\t</div>\n\t\t</noindex>\n\t</div>\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1066:function(e,t,i){"use strict";var n,a,s,r,o,c,d=i(350);t.Z=(a={},s="template-viewer-toolbar",r=(0,d.f)(n||(o=['\n\n\t<div class="toolbar for-viewer">\n\n\t\t<%\tvar offscreenClass = (isPreview || common.embedMode) ? \'\' : \'offscreen-initially\'; %>\n\n\t\t<% if (hasPageCounter && !pageCounterInsideMenu) { %>\n\t\t\t<div class="page-counter-wrapper <%=offscreenClass%>">\n\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total"><%=totalPages%></span></div>\n\t\t\t</div>\n\t\t<% } %>\n\n\t\t<% if (brandingInToolbar) { %>\n\t\t\t<div class="toolbar-branding"></div>\n\t\t<% } %>\n\n\t\t<% if (hasShare) { %>\n\t\t\t<div class="share-button sprite <%=offscreenClass%>" data-alt="Share" data-alt-pos="<%= !controlsOnTop ? \'top\' : \'bottom\' %>" data-alt-offset="9"  data-alt-style="toolbar-share-tooltip" style="background-image: url(\'<%=icons.sprite%>\')"></div>\n\t\t<% } %>\n\n\t\t<% if (hasMenu) { %>\n\t\t\t<div class="menu-button <%=offscreenClass%>" data-alt="Menu (M)" data-alt-pos="<%= !controlsOnTop ? \'top\' : \'bottom\' %>" data-alt-offset="9" data-alt-style="toolbar-menu-tooltip">\n\t\t\t\t<% if (hasPageCounter && pageCounterInsideMenu) { %>\n\t\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total"><%=totalPages%></span></div>\n\t\t\t\t<% } %>\n\n\t\t\t\t<svg class="menu-icon" width="32" height="14" viewBox="0 0 32 14">\n\t\t\t\t\t<g fill="currentColor" fill-rule="evenodd"><path d="M1 0h30a1 1 0 010 2H1a1 1 0 110-2zM1 12h30a1 1 0 010 2H1a1 1 0 010-2z"/></g>\n\t\t\t\t</svg>\n\t\t\t\t<svg class="cross-icon" width="18" height="18" viewBox="0 0 18 18">\n\t\t\t\t\t<path d="M17.485.515a1 1 0 010 1.414L10.415 9l7.07 7.071a1 1 0 01-1.414 1.414L9 10.415l-7.071 7.07a1 1 0 01-1.414-1.414L7.585 9 .516 1.929A1 1 0 011.929.515L9 7.585l7.071-7.07a1 1 0 011.414 0z" fill="currentColor" fill-rule="evenodd"></path>\n\t\t\t\t</svg>\n\t\t\t\t<div class="page-preloader sprite" style="background-image: url(\'<%=icons.sprite%>\')"></div>\n\t\t\t</div>\n\t\t<% } %>\n\n\t\t<% if (common.embedMode) { %>\n\t\t\t<div class="embed-close-button <%=offscreenClass%>">Close</div>\n\t\t<% } %>\n\n\t</div>\n\n'],c||(c=o.slice(0)),n=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(c)}})))),s in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a)},1060:function(e,t,i){"use strict";i.d(t,{h:function(){return n}});var n=[{value:"AF",caption:"Afghanistan"},{value:"AX",caption:"Aland Islands"},{value:"AL",caption:"Albania"},{value:"DZ",caption:"Algeria"},{value:"AS",caption:"American Samoa"},{value:"AD",caption:"Andorra"},{value:"AO",caption:"Angola"},{value:"AI",caption:"Anguilla"},{value:"AQ",caption:"Antarctica"},{value:"AG",caption:"Antigua and Barbuda"},{value:"AR",caption:"Argentina"},{value:"AM",caption:"Armenia"},{value:"AW",caption:"Aruba"},{value:"AU",caption:"Australia"},{value:"AT",caption:"Austria"},{value:"AZ",caption:"Azerbaijan"},{value:"BS",caption:"Bahamas"},{value:"BH",caption:"Bahrain"},{value:"BD",caption:"Bangladesh"},{value:"BB",caption:"Barbados"},{value:"BY",caption:"Belarus"},{value:"BE",caption:"Belgium"},{value:"BZ",caption:"Belize"},{value:"BJ",caption:"Benin"},{value:"BM",caption:"Bermuda"},{value:"BT",caption:"Bhutan"},{value:"BO",caption:"Bolivia, Plurinational State of"},{value:"BQ",caption:"Bonaire, Sint Eustatius and Saba"},{value:"BA",caption:"Bosnia and Herzegovina"},{value:"BW",caption:"Botswana"},{value:"BV",caption:"Bouvet Island"},{value:"BR",caption:"Brazil"},{value:"IO",caption:"British Indian Ocean Territory"},{value:"BN",caption:"Brunei Darussalam"},{value:"BG",caption:"Bulgaria"},{value:"BF",caption:"Burkina Faso"},{value:"BI",caption:"Burundi"},{value:"KH",caption:"Cambodia"},{value:"CM",caption:"Cameroon"},{value:"CA",caption:"Canada"},{value:"CV",caption:"Cape Verde"},{value:"KY",caption:"Cayman Islands"},{value:"CF",caption:"Central African Republic"},{value:"TD",caption:"Chad"},{value:"CL",caption:"Chile"},{value:"CN",caption:"China"},{value:"CX",caption:"Christmas Island"},{value:"CC",caption:"Cocos (Keeling) Islands"},{value:"CO",caption:"Colombia"},{value:"KM",caption:"Comoros"},{value:"CG",caption:"Congo"},{value:"CD",caption:"Congo, the Democratic Republic of the"},{value:"CK",caption:"Cook Islands"},{value:"CR",caption:"Costa Rica"},{value:"CI",caption:"Côte d'Ivoire"},{value:"HR",caption:"Croatia"},{value:"CU",caption:"Cuba"},{value:"CW",caption:"Curaçao"},{value:"CY",caption:"Cyprus"},{value:"CZ",caption:"Czech Republic"},{value:"DK",caption:"Denmark"},{value:"DJ",caption:"Djibouti"},{value:"DM",caption:"Dominica"},{value:"DO",caption:"Dominican Republic"},{value:"EC",caption:"Ecuador"},{value:"EG",caption:"Egypt"},{value:"SV",caption:"El Salvador"},{value:"GQ",caption:"Equatorial Guinea"},{value:"ER",caption:"Eritrea"},{value:"EE",caption:"Estonia"},{value:"ET",caption:"Ethiopia"},{value:"FK",caption:"Falkland Islands (Malvinas)"},{value:"FO",caption:"Faroe Islands"},{value:"FJ",caption:"Fiji"},{value:"FI",caption:"Finland"},{value:"FR",caption:"France"},{value:"GF",caption:"French Guiana"},{value:"PF",caption:"French Polynesia"},{value:"TF",caption:"French Southern Territories"},{value:"GA",caption:"Gabon"},{value:"GM",caption:"Gambia"},{value:"GE",caption:"Georgia"},{value:"DE",caption:"Germany"},{value:"GH",caption:"Ghana"},{value:"GI",caption:"Gibraltar"},{value:"GR",caption:"Greece"},{value:"GL",caption:"Greenland"},{value:"GD",caption:"Grenada"},{value:"GP",caption:"Guadeloupe"},{value:"GU",caption:"Guam"},{value:"GT",caption:"Guatemala"},{value:"GG",caption:"Guernsey"},{value:"GN",caption:"Guinea"},{value:"GW",caption:"Guinea-Bissau"},{value:"GY",caption:"Guyana"},{value:"HT",caption:"Haiti"},{value:"HM",caption:"Heard Island and McDonald Islands"},{value:"VA",caption:"Holy See (Vatican City State)"},{value:"HN",caption:"Honduras"},{value:"HK",caption:"Hong Kong"},{value:"HU",caption:"Hungary"},{value:"IS",caption:"Iceland"},{value:"IN",caption:"India"},{value:"ID",caption:"Indonesia"},{value:"IR",caption:"Iran, Islamic Republic of"},{value:"IQ",caption:"Iraq"},{value:"IE",caption:"Ireland"},{value:"IM",caption:"Isle of Man"},{value:"IL",caption:"Israel"},{value:"IT",caption:"Italy"},{value:"JM",caption:"Jamaica"},{value:"JP",caption:"Japan"},{value:"JE",caption:"Jersey"},{value:"JO",caption:"Jordan"},{value:"KZ",caption:"Kazakhstan"},{value:"KE",caption:"Kenya"},{value:"KI",caption:"Kiribati"},{value:"KP",caption:"Korea, Democratic People's Republic of"},{value:"KR",caption:"Korea, Republic of"},{value:"KW",caption:"Kuwait"},{value:"KG",caption:"Kyrgyzstan"},{value:"LA",caption:"Lao People's Democratic Republic"},{value:"LV",caption:"Latvia"},{value:"LB",caption:"Lebanon"},{value:"LS",caption:"Lesotho"},{value:"LR",caption:"Liberia"},{value:"LY",caption:"Libya"},{value:"LI",caption:"Liechtenstein"},{value:"LT",caption:"Lithuania"},{value:"LU",caption:"Luxembourg"},{value:"MO",caption:"Macao"},{value:"MK",caption:"Macedonia, the Former Yugoslav Republic of"},{value:"MG",caption:"Madagascar"},{value:"MW",caption:"Malawi"},{value:"MY",caption:"Malaysia"},{value:"MV",caption:"Maldives"},{value:"ML",caption:"Mali"},{value:"MT",caption:"Malta"},{value:"MH",caption:"Marshall Islands"},{value:"MQ",caption:"Martinique"},{value:"MR",caption:"Mauritania"},{value:"MU",caption:"Mauritius"},{value:"YT",caption:"Mayotte"},{value:"MX",caption:"Mexico"},{value:"FM",caption:"Micronesia, Federated States of"},{value:"MD",caption:"Moldova, Republic of"},{value:"MC",caption:"Monaco"},{value:"MN",caption:"Mongolia"},{value:"ME",caption:"Montenegro"},{value:"MS",caption:"Montserrat"},{value:"MA",caption:"Morocco"},{value:"MZ",caption:"Mozambique"},{value:"MM",caption:"Myanmar"},{value:"NA",caption:"Namibia"},{value:"NR",caption:"Nauru"},{value:"NP",caption:"Nepal"},{value:"NL",caption:"Netherlands"},{value:"NC",caption:"New Caledonia"},{value:"NZ",caption:"New Zealand"},{value:"NI",caption:"Nicaragua"},{value:"NE",caption:"Niger"},{value:"NG",caption:"Nigeria"},{value:"NU",caption:"Niue"},{value:"NF",caption:"Norfolk Island"},{value:"MP",caption:"Northern Mariana Islands"},{value:"NO",caption:"Norway"},{value:"OM",caption:"Oman"},{value:"PK",caption:"Pakistan"},{value:"PW",caption:"Palau"},{value:"PS",caption:"Palestine, State of"},{value:"PA",caption:"Panama"},{value:"PG",caption:"Papua New Guinea"},{value:"PY",caption:"Paraguay"},{value:"PE",caption:"Peru"},{value:"PH",caption:"Philippines"},{value:"PN",caption:"Pitcairn"},{value:"PL",caption:"Poland"},{value:"PT",caption:"Portugal"},{value:"PR",caption:"Puerto Rico"},{value:"QA",caption:"Qatar"},{value:"RE",caption:"Réunion"},{value:"RO",caption:"Romania"},{value:"RU",caption:"Russian Federation"},{value:"RW",caption:"Rwanda"},{value:"BL",caption:"Saint Barthélemy"},{value:"SH",caption:"Saint Helena, Ascension and Tristan da Cunha"},{value:"KN",caption:"Saint Kitts and Nevis"},{value:"LC",caption:"Saint Lucia"},{value:"MF",caption:"Saint Martin (French part)"},{value:"PM",caption:"Saint Pierre and Miquelon"},{value:"VC",caption:"Saint Vincent and the Grenadines"},{value:"WS",caption:"Samoa"},{value:"SM",caption:"San Marino"},{value:"ST",caption:"Sao Tome and Principe"},{value:"SA",caption:"Saudi Arabia"},{value:"SN",caption:"Senegal"},{value:"RS",caption:"Serbia"},{value:"SC",caption:"Seychelles"},{value:"SL",caption:"Sierra Leone"},{value:"SG",caption:"Singapore"},{value:"SX",caption:"Sint Maarten (Dutch part)"},{value:"SK",caption:"Slovakia"},{value:"SI",caption:"Slovenia"},{value:"SB",caption:"Solomon Islands"},{value:"SO",caption:"Somalia"},{value:"ZA",caption:"South Africa"},{value:"GS",caption:"South Georgia and the South Sandwich Islands"},{value:"SS",caption:"South Sudan"},{value:"ES",caption:"Spain"},{value:"LK",caption:"Sri Lanka"},{value:"SD",caption:"Sudan"},{value:"SR",caption:"Suriname"},{value:"SJ",caption:"Svalbard and Jan Mayen"},{value:"SZ",caption:"Swaziland"},{value:"SE",caption:"Sweden"},{value:"CH",caption:"Switzerland"},{value:"SY",caption:"Syrian Arab Republic"},{value:"TW",caption:"Taiwan, Province of China"},{value:"TJ",caption:"Tajikistan"},{value:"TZ",caption:"Tanzania, United Republic of"},{value:"TH",caption:"Thailand"},{value:"TL",caption:"Timor-Leste"},{value:"TG",caption:"Togo"},{value:"TK",caption:"Tokelau"},{value:"TO",caption:"Tonga"},{value:"TT",caption:"Trinidad and Tobago"},{value:"TN",caption:"Tunisia"},{value:"TR",caption:"Turkey"},{value:"TM",caption:"Turkmenistan"},{value:"TC",caption:"Turks and Caicos Islands"},{value:"TV",caption:"Tuvalu"},{value:"UG",caption:"Uganda"},{value:"UA",caption:"Ukraine"},{value:"AE",caption:"United Arab Emirates"},{value:"GB",caption:"United Kingdom"},{value:"US",caption:"United States"},{value:"UM",caption:"United States Minor Outlying Islands"},{value:"UY",caption:"Uruguay"},{value:"UZ",caption:"Uzbekistan"},{value:"VU",caption:"Vanuatu"},{value:"VE",caption:"Venezuela, Bolivarian Republic of"},{value:"VN",caption:"Viet Nam"},{value:"VG",caption:"Virgin Islands, British"},{value:"VI",caption:"Virgin Islands, U.S."},{value:"WF",caption:"Wallis and Futuna"},{value:"EH",caption:"Western Sahara"},{value:"YE",caption:"Yemen"},{value:"ZM",caption:"Zambia"},{value:"ZW",caption:"Zimbabwe"}]},722:function(e,t,i){"use strict";var n=i(322),a=i(723),s=i(341),r=i(344),o={GLOBAL_UNIQUE_KEYS:["hidden","z"],GLOBAL_UNIQUE_KEY_PREFIX:"_",FADE_DURATION:200,getUniqueValue:function(e,t,i){var a=t[this.GLOBAL_UNIQUE_KEY_PREFIX+e]||[],s=n.Z.findWhere(a,{pid:i});return void 0===(s=s||n.Z.findWhere(a,{pid:"default"})||{}).value?t[e]:s.value},resetGlobalData:function(e,t){var i=this;return n.Z.each(r.ZP.viewport_listall,(function(a){n.Z.each(i.GLOBAL_UNIQUE_KEYS,(function(s){a==="viewport_"+t?e.set(i.GLOBAL_UNIQUE_KEY_PREFIX+s,[]):n.Z.isEmpty(e[a])||(e[a][i.GLOBAL_UNIQUE_KEY_PREFIX+s]=[])}))})),{}},isGlobalKey:function(e){return-1!==this.GLOBAL_UNIQUE_KEYS.indexOf(e)},getGlobalPrefixedKey:function(e){return this.isGlobalKey(e)?this.GLOBAL_UNIQUE_KEY_PREFIX+e:null},fillUniqueAttributeSets:function(e,t,i){var a={};return t.is_global?((0,n.Z)(this.GLOBAL_UNIQUE_KEYS).each(function(s){if(n.Z.has(e,s)&&void 0!==e[s]){var r=t[this.GLOBAL_UNIQUE_KEY_PREFIX+s]||[],o=n.Z.findWhere(r,{pid:i}),c=n.Z.findWhere(r,{pid:"default"});o?o.value=e[s]:r.push({pid:i,value:e[s]}),c||r.push({pid:"default",value:void 0===t[s]?null:t[s]}),a[this.GLOBAL_UNIQUE_KEY_PREFIX+s]=r}}.bind(this)),a):e},ensurePageDefRecord:function(e){(0,n.Z)(this.GLOBAL_UNIQUE_KEYS).each(function(t){var i=e[this.GLOBAL_UNIQUE_KEY_PREFIX+t]||[];n.Z.findWhere(i,{pid:"default"})||i.push({pid:"default",value:void 0===e[t]?null:e[t]}),e[this.GLOBAL_UNIQUE_KEY_PREFIX+t]=i}.bind(this))},fillUniqueValues:function(e,t,i){i=i||{},n.Z.each(e,(function(a,s){if(n.Z.contains(this.GLOBAL_UNIQUE_KEYS,s)&&(!i.props||n.Z.contains(i.props,s))){var r=this.getUniqueValue(s,e,t);e[s]=void 0===r?a:r}}),this)},isHidden:function(e,t,i){return this.getUniqueValue("hidden",e,t)||!i&&a.Z.hasExpired(e)},show:function(e,t){t=Boolean(t),e.$el.toggleClass("no-transition",t),e.$el.addClass("above-all-fade"),e.$el.hasClass("fade-in")&&!t||(e.cancelHide&&e.cancelHide(),e.show(),n.Z.delay((function(){e.$el.addClass("fade-in")}),50))},hide:function(e,t){return t=Boolean(t),e.$el.addClass("above-all-fade"),new window.Promise((function(i){e.$el.hasClass("fade-in")||t?(e.$el.toggleClass("no-transition",t),e.$el.removeClass("fade-in"),t?(e.hide(),i()):e.cancelHide=s.default.waitForTransitionEnd(e.$el,o.FADE_DURATION,"opacity",(function(){e.hide(),i()}))):i()}))}};t.Z=o},1061:function(e,t,i){"use strict";i.d(t,{x:function(){return n}});var n=function(e,t){return new Intl.NumberFormat(window.navigator.language||"en-US",{style:"currency",currency:t}).format(e)}},993:function(e,t){"use strict";var i=["DOMMouseScroll","mousewheel"];t.Z=function(e,t,n,a){e||(e=document),t||(t=window),"boolean"!=typeof n&&(n=!0);var s,r,o,c=function(e){!function(e,t,i,n){i&&(e.preventDefault?e.preventDefault():event.returnValue=!1);var a=e.detail||-e.wheelDelta/40;a*=19,"number"!=typeof n||isNaN(n)||(a*=n),t.scrollBy?t.scrollBy(0,a):t.scrollTop+=a}(e=e||window.event,t,n,a)};return(s=e.addEventListener)?(s.call(e,i[0],c,!1),s.call(e,i[1],c,!1)):(s=e.attachEvent)&&s.call(e,"on"+i[1],c),(r=e.removeEventListener)?o=function(){r.call(e,i[0],c,!1),r.call(e,i[1],c,!1)}:(r=e.detachEvent)&&(o=function(){r.call(e,"on"+i[1],c)}),{restore:o}}},1054:function(e,t,i){"use strict";var n=i(337),a=i.n(n),s=i(322),r=i(341),o=i(723),c=i(697),d=i(728),l=i(324);function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){p(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function g(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var v=a().View.extend({initialize:function(e){s.Z.bindAll(this),s.Z.extend(this,e);var t={};s.Z.each(this.widgets,s.Z.bind((function(e){if(e.hasAnimation()){var i=e.fixed_position||e.is_full_width||e.is_full_height||e.sticked?r.default.generateUUID():o.Z.getUuidHash(e.getAnimations())||r.default.generateUUID();t[i]=t[i]||[],t[i].push(e)}}),this)),this.animations=[];var i=!l.Z.isDesktop||!Modernizr.safari;s.Z.each(t,function(e){this.addAnimation(e,{allowAccelerate:i})}.bind(this)),this.start.__debounced=s.Z.debounce(this.start,300)},addAnimation:function(e,t){var i=this;t=t||{},e=s.Z.isArray(e)?e:[e];var n=["nonMove","moveOnly"].concat(g(o.Z.EVENT_TYPES)).reverse();g(e[0].getAnimations()).map((function(e){return o.Z.isMoveOnly(e)?u(u({},e),{},{effects:"moveOnly"}):o.Z.isNonMove(e)?u(u({},e),{},{effects:"nonMove"}):e})).sort((function(e,t){return n.indexOf(e.effects||e.type)-n.indexOf(t.effects||t.type)})).filter((function(e){return!o.Z.isEmpty(e)})).map((function(n){var a=n.type;if(l.Z.isDesktop||"hover"!==a||e[0].getAnimationTriggers(n.UUID).length){var s=e[0].animationObjects,r=Boolean(s&&s.length),o=new f[a]({page:i.page,widgets:e,rawAnimation:n,$container:r?s[s.length-1].$el:void 0,allowAccelerate:t.allowAccelerate,isNested:r,topmostAnimation:r?s[0]:void 0});i.animations.push(o)}}))},removeAnimation:function(e){this.animations=s.Z.without(this.animations,e),e&&e.destroy()},start:function(){s.Z.each(this.animations,(function(e){e.start()}))},stop:function(){s.Z.each(this.animations,(function(e){e.stop()}))},resetStarted:function(){s.Z.each(this.animations,(function(e){e.started=!1}))},onScroll:function(e){e=e||{},(this.page.mag.currentPage===this.page||e.forceApply)&&s.Z.each(this.animations,(function(t){t.onScroll&&t.onScroll(e)}))},onResize:function(e){s.Z.each(this.animations,(function(t){t.onResize(e)}))},updateTimelines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];s.Z.each(this.animations,(function(t){e.includes(t.animation.UUID)||t.createAnimationTimeline()}))},hasScaleUp:function(){return Boolean(s.Z.find(this.animations,(function(e){return o.Z.isScaleUp(e.animation)})))},destroy:function(){s.Z.each(this.animations,(function(e){e.destroy()})),delete this.animations}}),f={},b=a().View.extend({visibilityRatio:.2,className:"animation-container",scrolledToView:!1,useOnscrollBoundsFallback:!window.IntersectionObserver,initialize:function(e){s.Z.bindAll(this),s.Z.extend(this,e),s.Z.each(this.widgets,s.Z.bind((function(e){e.animationObj=this,e.animationObjects=[].concat(g(e.animationObjects||[]),[this])}),this)),this.isFixed=this.widgets[0].fixed_position,this.isFullwidth=this.widgets[0].is_full_width,this.isFullheight=this.widgets[0].is_full_height,this.isSticked=this.widgets[0].sticked,this.isAbove=this.widgets[0].is_above,this.playOnce=!this.page.mag.isPreview&&this.playOnce,this.$container=this.$container||(this.isFixed||this.isAbove?this.widgets[0].$fixedContainer:this.page.$content),this.$el.appendTo(this.$wrapper?this.$wrapper:this.$container),this.createAnimationTimeline(e),this.onResize({updateAll:!0})},createAnimationTimeline:function(e){e=e||{},this.timeline&&this.timeline.destroy(),this.animation=o.Z.getNormalizedAnimation(this.rawAnimation,this.isFixed,this.isFullwidth,this.isFullheight,this.page.scale,this.page.pageViewport,this.page.mag.getViewportWidth(this.page.pageViewport),this.page.mag.viewOpts),this.timeline=o.Z.createAnimationTimeline({el:this.$el,steps:this.animation.steps,type:this.animation.type,force3d:!1,animationTrigger:this.animation.trigger,selfTriggered:Boolean(s.Z.intersection(o.Z.normalizeAnimationTriggers(this.animation.trigger),this.widgets.map((function(e){return e._id}))).length),screenshotMode:!!RM.screenshot})},start:function(){this.timeline&&this.paused&&(this.paused=!1,this.timeline.resume())},stop:function(){this.timeline&&this.timeline.active&&(this.isAbove||(this.paused=!0,this.timeline.pause()))},getAnimationContainer:function(){return this.$el},modifyWidgetPosition:function(e){return this.isFixed?(e.dimensions.left="50%",e.dimensions.top="50%",e.dimensions.right="",e.dimensions.bottom="",e.dimensions["margin-left"]=-e.dimensions.width/2,e.dimensions["margin-top"]=-e.dimensions.height/2):(e.dimensions.left-=this.bbox_css.left+(this.isNested?this.topmostAnimation.bbox_css.left:0),e.dimensions.top-=this.bbox_css.top+(this.isNested?this.topmostAnimation.bbox_css.top:0)),e},onResize:function(e){if((e=e||{}).updateAll||this.isFixed&&this.prevPageScale!==this.page.scale||this.isFullwidth||this.isFullheight||this.isSticked){var t,i={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY,z:0};this.isFixed||this.isFullwidth||this.isFullheight||this.isSticked?this.bbox_css=u(u({},this.widgets[0].calcBoxStyle({calcBBox:!0}).dimensions),this.isNested?{left:0,top:0,"margin-left":0,"margin-top":0}:{}):(s.Z.each(this.widgets,(function(e){t=e.calcBoxStyle({calcBBox:!0}).dimensions,i.t=Math.min(i.t,t.top),i.l=Math.min(i.l,t.left),i.b=Math.max(i.b,t.top+t.height),i.r=Math.max(i.r,t.left+t.width),i.z=Math.max(i.z,t["z-index"])}),this),this.bbox_css={left:this.isNested?0:i.l,top:this.isNested?0:i.t,width:i.r-i.l,height:i.b-i.t,"z-index":i.z}),this.$el.css(this.bbox_css)}this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.prevPageScale=this.page.scale},withTriggerOrElement:function(e){var t=this,i=this.animation.trigger.filter((function(e){return e})).reduce((function(e,i){return e.concat(e,t.page.mag.getAllWidgetViewsById(i,t.page))}),[]),n=0;i.forEach((function(a){a.then((function(i){i.rendered?e(i.$el):t.listenToOnce(i,"rendered",(function(){return e(i.$el)}))})).catch((function(){++n===i.length&&e(t.$el)}))})),i.length||e(this.$el)},getBBScaleFactor:function(){return c.Z.isOnForRatio(this.page.pageViewport,this.page.scale,this.page.mag.viewOpts)&&c.Z.isCSSZoom()?this.page.scale:1},isInView:function(){var e=d.Z.getBoundingBoxOfElements(this.widgets.map((function(e){return e.$el[0]})),this.getBBScaleFactor());return d.Z.isBoxInView(e,this.visibilityRatio)},notifyWhenInOrOutOfView:function(){var e=this;window.requestAnimationFrame((function(){e.isInView()?(e.scrolledToView=!0,e.scrolledOutOfView=!1,e.trigger("scrolledToView")):(e.scrolledToView=!1,e.scrolledOutOfView=!0,e.trigger("scrolledOutOfView"))}))},whenInView:function(){return this.whenInOrOutOfView("in")},whenOutOfView:function(){var e=this;return this.isInView()?this.whenInOrOutOfView("out"):this.whenInOrOutOfView("in").then((function(){return e.whenInOrOutOfView("out")}))},whenInOrOutOfView:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in",i="in"===t,n="out"===t;if(this.useOnscrollBoundsFallback)return i&&this.isInView()||n&&!this.isInView()?window.Promise.resolve():new window.Promise((function(t){e.listenToOnce(e,n?"scrolledOutOfView":"scrolledToView",t)}));var a=this.widgets.map((function(e){return e.$el[0]})),s=d.Z.getBoundingBoxOfElements(a,this.getBBScaleFactor());return i?new window.Promise((function(t){var i=new window.IntersectionObserver((function(e){e.some((function(e){return e.isIntersecting}))&&(a.forEach((function(e){return i.unobserve(e)})),t())}),{rootMargin:"-".concat(s.height*e.visibilityRatio,"px 0px")});a.forEach((function(e){return i.observe(e)}))})):n?Promise.all(a.map((function(e){return new window.Promise((function(t){var i=new window.IntersectionObserver((function(n){n.every((function(e){return!e.isIntersecting}))&&(i.unobserve(e),t())}));i.observe(e)}))}))):void 0},destroy:function(){this.stop(),this.timeline&&this.timeline.destroy(),this.remove()}});f.scroll=b.extend({onScroll:function(e){if(e=e||{},this.timeline&&(this.page.mag.currentPage===this.page&&!this.isAbove||e.forceApply)){var t=this.isAbove?e.scroll:Math.max(0,this.page.visibleWidgetsCoords.scrollTop||0);if(this.isFixed)this.timeline.seek(t);else{var i=this.animation.steps[0].start_point||"bottom",n=this.bbox_css.top+(this.isNested?this.topmostAnimation.bbox_css.top:0)+this.innerContentTop,a=n-this.innerContainerHeight,s={top:1,center:.5,bottom:0}[i]*(n-a)+a+this.animation.steps[0].start_offset||0;s<=0?this.timeline.seek(t/this.page.scale):this.timeline.seek(Math.max(0,t-s*this.page.scale)/this.page.scale)}}},onResize:function(){b.prototype.onResize.apply(this,arguments),this.onScroll()}}),f.load=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments);var e=this.animation.steps;this.startWhenInView=e&&e.length&&e[0].startWhenInView,this.notifyWhenInOrOutOfView.__throttled=s.Z.throttle(this.notifyWhenInOrOutOfView,100)},start:function(){b.prototype.start.apply(this,arguments),this.isReady().then(function(){this.timeline.play(),this.started=!0}.bind(this)).catch((function(e){e&&console.log(e&&e.stack)}))},onScroll:function(){this.useOnscrollBoundsFallback&&this.notifyWhenInOrOutOfView.__throttled()},isReady:function(){var e,t=this;if(RM.screenshot||this.started||r.default.PageVisibilityManager.isPageHidden())e=window.Promise.reject();else{var i=this.widgets[0],n=[],a=window.Promise.all(this.widgets.map((function(e){return e.loaded?window.Promise.resolve():new window.Promise((function(i){return t.listenToOnce(e,"loaded",i)}))})));if(this.isAbove){var s=this.page.mag.aboveAnimationsReady?window.Promise.resolve():new window.Promise(function(e){this.listenToOnce(this.page.mag,"aboveAnimationsReady",e)}.bind(this)),o=i.rendered?window.Promise.resolve():new window.Promise(function(e){this.listenToOnce(i,"rendered",e)}.bind(this)),c=i.wasHidden?new window.Promise(function(e){this.listenToOnce(i,"shown",e)}.bind(this)):window.Promise.resolve();n=this.startWhenInView?[o,c,a]:[s,o,c,a]}else{var d=this.page.started?window.Promise.resolve():new window.Promise(function(e){this.listenToOnce(this.page,"started",e)}.bind(this)),l=this.page.loadAnimationsReady?window.Promise.resolve():new window.Promise(function(e){this.listenToOnce(this.page,"loadAnimationsReady",e)}.bind(this)),h=this.page.isCurrent()?window.Promise.resolve():new window.Promise(function(e){this.listenToOnce(this.page,"changedTo",e)}.bind(this)),u=this.startWhenInView?a.then((function(){return t.whenInView()})):window.Promise.resolve();n=this.startWhenInView?[d,h,u]:[l,d]}e=window.Promise.all(n)}return e}}),f.click=b.extend({resetWhenOutOfView:!1,initialize:function(){b.prototype.initialize.apply(this,arguments);var e=function(e){e.on("click",this.onClick),e.css("cursor","pointer")}.bind(this);this.willStopOnEnd=!1,this.lastTimeClick=0,this.withTriggerOrElement(e),this.notifyWhenInOrOutOfView.__throttled=s.Z.throttle(this.notifyWhenInOrOutOfView,100)},onClick:function(){var e=this,t=o.Z.getPermanentAnimationId(this.widgets[0],this.animation.UUID),i=this.timeline&&!this.timeline.active&&this.timeline.reversed&&o.Z.hasPlayed(t);this.timeline&&!i&&(+new Date-this.lastTimeClick<300||(this.lastTimeClick=+new Date,this.timeline.active?(this.willStopOnEnd?this.timeline.off("full-cycle-end",this.onCycleEnd):this.timeline.on("full-cycle-end",this.onCycleEnd),this.willStopOnEnd=!this.willStopOnEnd):(this.willStopOnEnd=!1,this.timeline.reversed?this.timeline.reverse():this.timeline.play(),this.animation.playOnce&&!o.Z.hasPlayed(t)&&o.Z.persistHasPlayed(t),this.animation.resetWhenOutOfView&&this.whenOutOfView().then((function(){e.timeline.stop(),e.timeline.applyStepState("initial"),e.timeline.reversed=!1})),s.Z.each(this.widgets,(function(t){"video"===t.type&&t.player&&(e.timeline.reversed?t.player.pause():t.player.play())})))))},onScroll:function(){this.useOnscrollBoundsFallback&&this.notifyWhenInOrOutOfView.__throttled()},onCycleEnd:function(){this.willStopOnEnd=!1,this.timeline.off("full-cycle-end",this.onCycleEnd),this.timeline.loop?this.timeline.isFullLoop?this.timeline.stop():this.timeline.reverse():this.timeline.reversed?this.timeline.reverse():this.timeline.play()},destroy:function(){var e=function(e){e.css("cursor","")};this.withTriggerOrElement(e),b.prototype.destroy.apply(this,arguments)}}),f.hover=b.extend({initialize:function(){if(b.prototype.initialize.apply(this,arguments),l.Z.isDesktop){var e=function(e){e.on("mouseenter",this.onMouseEnter),e.on("mouseleave",this.onMouseLeave)}.bind(this);s.Z.each(this.widgets,s.Z.bind((function(e){-1!==["text","shape","picture","button"].indexOf(e.type)&&(e.hasHoverAnimation=!0)}),this)),this.withTriggerOrElement(e)}},onMouseEnter:function(){this.timeline&&(this.timeline.active?!this.timeline.loop&&this.timeline.reversed?this.timeline.on("full-cycle-end",this.onCycleEnd):this.timeline.off("full-cycle-end",this.onCycleEnd):!this.timeline.reversed&&this.timeline.play())},onMouseLeave:function(){this.timeline&&(this.timeline.active?!this.timeline.loop&&this.timeline.reversed?this.timeline.off("full-cycle-end",this.onCycleEnd):this.timeline.on("full-cycle-end",this.onCycleEnd):!this.timeline.loop&&this.timeline.reversed&&this.timeline.reverse())},onCycleEnd:function(){this.timeline.off("full-cycle-end",this.onCycleEnd),this.timeline.loop?this.timeline.isFullLoop?this.timeline.stop():this.timeline.reverse():this.timeline.reversed?this.timeline.reverse():this.timeline.play()}}),t.Z=v},1071:function(e,t,i){"use strict";var n=i(337),a=i.n(n),s=i(322),r=i(1072),o=a().View.extend({template:r.Z["template-viewer-branding"],initialize:function(e){return s.Z.bindAll(this),s.Z.extend(this,e),this},render:function(){var e=this.mag&&this.mag.num_id,t=e?"utm_source=made_with_readymag&utm_medium=referral&utm_campaign=".concat(e):"";return this.setElement(this.template({utm_params:t})),this.$el.appendTo(this.$container),this.listenTo(this.mag,"pageChanged",this.onPageChange),s.Z.delay(function(){this.$el.removeClass("offscreen-initially")}.bind(this),800),this},onPageChange:function(e,t){},hide:function(){this.$el.stop().fadeOut(200)},show:function(){this.$el.stop().fadeIn(200)}});t.Z=o},1062:function(e,t,i){"use strict";var n=i(322),a=i(313),s=i(944),r=i.n(s),o=i(664),c=i(752),d=i.n(c),l=i(878),h=i.n(l),u=i(1058),p=i(1059),g=i(341),m=i(343),v=i(308),f=i(1061),b=i(348),w=i(999);function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function P(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){C(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var S=Backbone.View.extend({template:p.Z["template-viewer-cart-sidebar"],initialize:function(e){return n.Z.bindAll(this),this.mag=e,this.environment=this.mag.router.environment,this.rendered=!1,this.havePrices=!1,this.isHiddenSettings=!0,this.hoveredItem=null,this.render(),this},render:function(){if(!RM.screenshot){var e=w.Z.getPermissions();if(e&&e.can_use_e_commerce&&!this.mag.eCommerceManager.isConstructor()&&this.mag.eCommerceManager.haveEcommerceCartWidget&&this.mag.eCommerceManager.getConnectedProvider()&&!this.rendered){this.rendered=!0,this.provider=this.mag.eCommerceManager.getConnectedProvider(),document.querySelectorAll("#cart-sidebar").length&&document.querySelectorAll("#cart-sidebar").forEach((function(e){return e.parentNode.removeChild(e)})),this.setElement(this.template({isMobile:(0,u.isMobile)(),isViewer:this.environment===v.ZP.environment.viewer,imgPublicPath:b.folderImagesPath})),this.$el.appendTo((0,a.Z)("body")),this.$toolbar=(0,a.Z)(".toolbar.for-viewer"),this.$tabs=this.$el.find(".cart-sidebar-tabs"),this.$items=this.$el.find(".cart-items-list"),this.$closeButton=this.$el.find(".close-button"),this.$footer=this.$el.find(".sidebar-footer"),this.$calcTextContainer=this.$el.find(".text-size-calc-container"),this.$itemsTab=this.$tabs.find(".tab-items"),this.$checkOutButton=this.$itemsTab.find(".сheck-out-btn"),this.cartWidgetData=this.mag.eCommerceManager.getCartWidgetData(),this.environment===v.ZP.environment.preview&&(this.cartWidgetData&&this.cartWidgetData._id&&this.setupSettingsPanel(),window.RM.constructorRouter.on("previewClose",this.closeSideBar.bind(this)),this.bindTextInputsEvents());var t=this.$el.find(".svg");r()(t),this.$el.find("[data-alt]:not(.rmalttext)").RMAltText(),this.generateSidebarCSS(this.cartWidgetData);var i=this.mag.eCommerceManager.getEcommerceData();return(0,a.Z)('<div class="ec-cart-widget"></div><div><script data-cfasync="false" type="text/javascript" src="https://app.ecwid.com/script.js?'.concat(i.ecwid.serviceData.storeId,"&data_platform=code&data_date=").concat(d()(this.mag.published?this.mag.published:this.mag.creation_date).format("YYYY-MM-DD"),'" charset="utf-8"><\/script></div>')).appendTo(this.$el),this.renderSidebarTexts(),this.renderCartItems(),this.bindDomEvents(),m.Z.on("ecommerce:cartsidebar:visibility:changed",this.toggleSidebar),this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderCartItems),this}}},bindDomEvents:function(){this.$closeButton.on("click",this.closeSideBar.bind(this)),this.$checkOutButton.on("click",this.goToCheckout.bind(this)),(0,a.Z)(document).on("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),(0,a.Z)(document).on("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave),this.bindStaticTextFieldsHovers()},unbindDomEvents:function(){this.$closeButton.off("click",this.closeSideBar),this.$checkOutButton.off("click",this.goToCheckout.bind(this)),(0,a.Z)(document).off("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),(0,a.Z)(document).off("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},bindStaticTextFieldsHovers:function(){this.environment===v.ZP.environment.preview&&(this.$itemsTab.find(".cart-title-input, .empty-cart-title-input").on("mouseover",(function(e){(0,a.Z)(e.target).addClass("active")})),this.$itemsTab.find(".cart-title-input, .empty-cart-title-input").on("mouseleave",(function(e){(0,a.Z)(e.target).is(":focus")||(0,a.Z)(e.target).removeClass("active")})),this.$itemsTab.find(".сheck-out-btn").on("mouseover",(function(e){(0,a.Z)(e.target).find(".cart-checkout-input").addClass("active")})),this.$itemsTab.find(".сheck-out-btn").on("mouseleave",(function(e){var t=(0,a.Z)(e.target).find(".cart-checkout-input");t.is(":focus")||t.removeClass("active")})))},hideSidebar:function(){this.$el.removeClass("show"),(0,a.Z)("body").removeClass("cart-sidebar-shown"),(0,a.Z)("html").removeClass("cart-disable-scroll"),!this.isHiddenSettings&&this.settingsPanel&&(this.isHiddenSettings=!0,this.settingsPanel.isHidden=this.isHiddenSettings)},toggleSidebar:function(e){e?this.hideSidebar():(this.$el.addClass("show"),(0,a.Z)("body").addClass("cart-sidebar-shown"),(0,a.Z)("html").addClass("cart-disable-scroll"))},closeSideBar:function(){this.mag.eCommerceManager.isCartSidebarHidden||this.mag.eCommerceManager.changeCartSidebarVisibility()},generateSidebarCSS:function(e){this.stylesElementId="cart_sidebar_styles_".concat(e._id);var t=g.default.getRGBA(e["bar-color"],e["bar-color-opacity"]/100),i=g.default.getRGBA(e["bar-background-color"],e["bar-background-color-opacity"]/100),n=g.default.getRGBA(e["bar-color"],.45*e["bar-color-opacity"]/100),s=this.getAdditionalColor(i),r="    .cart-sidebar {\n\n      color: ".concat(t,";\n      background-color: ").concat(i,";\n      box-shadow: ").concat(e["bar-shadow"]?"0 0 4px rgba(124, 124, 125, 0.5)":"none",";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar textarea {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar input {\n\n      color: ").concat(t,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar input::placeholder {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .cart-title-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,t),";\n    }\n\n    .cart-sidebar .empty-cart-title-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,t),";\n    }\n\n    .cart-sidebar .cart-price-input.active, .cart-sidebar .cart-quantity-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.2,n),";\n    }\n\n    .cart-sidebar .cart-checkout-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,t),";\n    }\n\n    .cart-sidebar .cart-price-input {\n\n      color: ").concat(n,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar .cart-quantity-input {\n\n      color: ").concat(n,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar button {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar select {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar .sidebar-btn {\n\n      color: ").concat(t,";\n      border-color: ").concat(n,";\n    }\n\n    .cart-sidebar .preloader svg path {\n\n      stroke: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-btn path {\n\n      fill: ").concat(t,";\n    }\n\n    .cart-sidebar .expand-arrow svg path {\n\n      fill: ").concat(t,";\n    }\n\n    .cart-sidebar .cart-cancel-btn {\n\n      color: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block.hover {\n\n      background-color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-attributes {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-price {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-items-quantity {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-remove-btn-icon path {\n\n      fill: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-decrease-btn-icon rect {\n\n      fill: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-increase-btn-icon path {\n\n      fill: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-settings-container .settings-button path {\n\n      stroke: ").concat(t,";\n    }\n\n    .cart-sidebar .sidebar-settings-container .settings-button:hover path {\n\n      stroke: ").concat(n,";\n    }\n\n    .cart-sidebar.cart-is-mobile .sidebar-body .cart-item-block {\n\n      background-color: ").concat(s,";\n    }");(0,a.Z)("#".concat(this.stylesElementId)).remove();var c=document.createElement("style");c.type="text/css",c.id=this.stylesElementId,c.className="cart-sidebar-styles",c.appendChild(document.createTextNode(r)),document.querySelector("head").appendChild(c)},getAdditionalColor:function(e){return(0,o.getLuminance)(e)<.05&&(0,o.getContrast)("#fff",e)-(0,o.getContrast)("#000",e)>=8?(0,o.lighten)(.1,e):(0,o.darken)(.1,e)},renderCartItems:function(){var e=this.mag.eCommerceManager.getCartData();if(e){var t=Object.keys(e.prices);this.$items.empty(),this.havePrices=Boolean(t.length),this.havePrices?(this.$itemsTab.find(".сheck-out-btn").css("display","block"),this.$itemsTab.find(".empty-cart").css("display","none")):(this.$itemsTab.find(".сheck-out-btn").css("display","none"),this.$itemsTab.find(".empty-cart").css("display","flex")),this.renderPricesCartItems(t);var i=this.$items.find(".svg");r()(i),this.renderSidebarTexts(),this.unbindTextInputsEvents(!0),this.bindTextInputsEvents(!0)}},renderPricesCartItems:function(e){var t=this,i=this.mag.eCommerceManager.getCartData();e.forEach((function(e){var n=i.prices[e];n.active&&t.renderCartItem(n)}))},renderCartItem:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"price",s=this.mag.eCommerceManager.getCartItenKey(e),r=this.hoveredItem===s,o=(0,a.Z)("<div/>",{class:"cart-item-block".concat(r?" hover":"")});o.data("".concat(n,"-id"),s);var c=(null===(t=e.selectedCombination)||void 0===t?void 0:t.thumbnailUrl)||e.image||e.images&&e.images.length;if(c){var d=this.getProductImage(e);i=(0,a.Z)("<div/>",{class:"cart-item-image",css:{"background-position":"center center","background-size":"cover","background-repeat":"no-repeat","background-image":"url(".concat(d,")")}}),o.append(i)}var l=(0,a.Z)("<div/>",{class:i?"cart-item-title":"cart-item-title without-image"}).text(e.nameTranslated&&e.nameTranslated[this.mag.eCommerceManager.userLocale]?e.nameTranslated[this.mag.eCommerceManager.userLocale]:e.name),h=e.cart_count,u=this.getOneItemPrice(e),p=(0,f.x)(u,e.currency),g=(0,f.x)((u*h).toFixed(2),e.currency),m=(0,a.Z)("<div/>",{class:"cart-item-price"}),v=(0,a.Z)("<input/>",{type:"text",class:"cart-text-input cart-price-input",name:"price",placeholder:"Price",maxlength:"32",translate:"no",autocomplete:"no",autocorrect:"no",spellcheck:"false"});v.get(0).dataset.dynamicWidth=!0;var w=(0,a.Z)("<span/>").html(h>1?": ".concat(p," × ").concat(h," = ").concat(g):": ".concat(p));m.append(v).append(w);var y=this.getTranslatedOptions(e),P=(0,a.Z)("<div/>",{class:"cart-items-quantity"}),C=(0,a.Z)("<input/>",{type:"text",class:"cart-text-input cart-quantity-input",name:"quantity",placeholder:"Quantity",maxlength:"32",translate:"no",autocomplete:"no",autocorrect:"no",spellcheck:"false"});C.get(0).dataset.dynamicWidth=!0;var S=(0,a.Z)("<span/>").html(": ".concat(h));P.append(C).append(S);var k=(0,a.Z)("<div/>",{class:"cart-item-remove-btn",title:"remove"}).attr("data-".concat(n,"-id"),s),T=(0,a.Z)("<img/>",{class:"svg cart-item-remove-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-delete.svg")});k.append(T),k.on("click",this.onRemoveItem);var Z=(0,a.Z)("<div/>",{class:"cart-item-edit-group"}),x=(0,a.Z)("<div/>",{class:"cart-item-increase-btn"}).attr("data-".concat(n,"-id"),s),$=(0,a.Z)("<img/>",{class:"svg cart-item-increase-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-increase.svg")});if(x.append($),Z.append(x),this.mag.eCommerceManager.isOutOfStock(e)||(x.addClass("active"),x.on("click",this.onIncreaseItem)),h>1){var O=(0,a.Z)("<div/>",{class:"cart-item-decrease-btn decrease-btn-".concat(s)}).attr("data-".concat(n,"-id"),s),M=(0,a.Z)("<img/>",{class:"svg cart-item-decrease-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-decrease.svg")});O.append(M),Z.append(O),O.on("click",this.onDecreaseItem)}else{var _=this.$items.find("decrease-btn-".concat(s));_.off("click",this.onDecreaseItem),_.remove()}o.append(l).append(y).append(m).append(P).append(k).append(Z),this.$items.append(o)},getProductImage:function(e){var t;return null!==(t=e.selectedCombination)&&void 0!==t&&t.thumbnailUrl?e.selectedCombination.thumbnailUrl:e.image?e.image:e.images?e.images[0]:""},getTranslatedOptions:function(e){var t=this;if(e.selectedOptions){var i=(0,a.Z)("<div/>",{class:"cart-item-attributes"});return Object.keys(e.selectedOptions).forEach((function(n){var s=g.default.capitalize(n),r=e.selectedOptions[n],o=t.mag.eCommerceManager.userLocale,c=e.options.find((function(e){return e.name===n}));if(null!=c&&c.nameTranslated&&null!=c&&c.nameTranslated[o]&&(s=g.default.capitalize(c.nameTranslated[o])),null!=c&&c.choices){var d=c.choices.find((function(t){return t.text===e.selectedOptions[n]}));null!=d&&d.textTranslated&&null!=d&&d.textTranslated[o]&&(r=d.textTranslated[o])}var l=(0,a.Z)("<div/>",{class:"cart-item-attribute"}).html("".concat(s,": ").concat(r));i.append(l)})),i}},getOneItemPrice:function(e){var t,i=e.price;return null!==(t=e.selectedCombination)&&void 0!==t&&t.price&&(i=e.selectedCombination.price),e.selectedOptions&&Object.keys(e.selectedOptions).forEach((function(t){var n=e.options.find((function(e){return e.name===t})),a=n?n.choices.find((function(i){return i.text===e.selectedOptions[t]})):null;a&&a.priceModifier&&("ABSOLUTE"===a.priceModifierType?i+=a.priceModifier:"PERCENT"===a.priceModifierType&&(i+=e.price*(a.priceModifier/100).toFixed(2)))})),i},onRemoveItem:function(e){e.currentTarget.dataset.priceId&&this.mag.eCommerceManager.removeFromCart(e.currentTarget.dataset.priceId)},onIncreaseItem:function(e){e.currentTarget.dataset.priceId&&this.mag.eCommerceManager.increaseCartItem(e.currentTarget.dataset.priceId)},onDecreaseItem:function(e){e.currentTarget.dataset.priceId&&this.mag.eCommerceManager.decreaseCartItem(e.currentTarget.dataset.priceId)},goToCheckout:function(e){var t=this;if(!e.isDefaultPrevented()){var i=this.mag.eCommerceManager.getCartData(),n=window.Ecwid;if(n){n.init();var s=Object.keys(i.prices),r=[];n.Cart.clear(),s.forEach((function(e){var o={id:Number(i.prices[e].id),quantity:i.prices[e].cart_count,callback:function(i,o,c){var d;i&&(d=e,r.push(d)),s.length===r.length&&(n.OnOrderPlaced.add((function(){t.mag.eCommerceManager.clearCart(),t.mag.eCommerceManager.getProducts(t.mag.eCommerceManager.connectedProvider)})),n.Cart.gotoCheckout(),t.closeSideBar(),t.mag.eCommerceManager.getProducts(t.mag.eCommerceManager.connectedProvider).then((function(){t.mag.eCommerceManager.updateCartProductItems()})),(0,a.Z)("html, body").css({overflow:"auto"}),(0,a.Z)(".ecwid-popup-closeButton, .ecwid-overlay").on("mousedown",(function(){(0,a.Z)("html, body").css("overflow","")})),(0,a.Z)(".ecwid-popup").on("mousedown",(function(e){e.currentTarget===e.target&&(0,a.Z)("html, body").css("overflow","")})),n.OnOrderPlaced.add((function(e){setTimeout((function(){(0,a.Z)(".ec-confirmation__continue > .form-control--done > button").on("mousedown",(function(){(0,a.Z)("html, body").css("overflow","")}))}),300)})))}};i.prices[e].selectedOptions?o.options=P({},i.prices[e].selectedOptions):i.prices[e].options.length&&i.prices[e].options.forEach((function(e){e.required&&(o.options||(o.options={}),o.options[e.name]=e.choices[e.defaultChoice])})),n.Cart.addProduct(o)}))}else alert("No Ecwid")}},getTextFieldModelKey:function(e){return"bar-".concat(e)},getSidebarTextValue:function(e){var t=this.getTextFieldModelKey(e);return this.cartWidgetData&&this.cartWidgetData[t]?h()(this.cartWidgetData[t]):v.ZP.defaultSidebarTexts[e]?v.ZP.defaultSidebarTexts[e]:null},calcTextFieldSize:function(e){if(!e)return null;var t=getComputedStyle(e);this.$calcTextContainer.css({"font-family":t.fontFamily,"font-size":t.fontSize,"font-style":t.fontStyle,"font-weight":t.fontWeight,"letter-spacing":t.letterSpacing}),this.$calcTextContainer.text(e.value);var i=this.$calcTextContainer.width();return Math.ceil(i)},renderSidebarTexts:function(){var e=this;this.$itemsTab.find(".cart-text-input").each((function(t,i){var n=i.getAttribute("name"),a=e.getSidebarTextValue(n);if(a&&(i.value=a,i.dataset.dynamicWidth)){var s=e.calcTextFieldSize(i);s&&(i.style.width="".concat(s,"px"))}}))},bindTextInputsEvents:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$itemsTab.find(".cart-text-input"+(t?'[data-dynamic-width="true"]':"")).each((function(t,i){(0,a.Z)(i).on("click",e.onTextFieldClick),(0,a.Z)(i).on("input",e.onTextFieldChange),(0,a.Z)(i).on("blur",e.onTextFieldBlur)})),t&&this.environment===v.ZP.environment.preview&&(this.$itemsTab.find(".cart-item-block").on("mouseover",this.onDynamicMouseOver),this.$itemsTab.find(".cart-item-block").on("mouseleave",this.onDynamicMouseLeave))},unbindTextInputsEvents:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$itemsTab.find(".cart-text-input"+(t?'[data-dynamic-width="true"]':"")).each((function(t,i){(0,a.Z)(i).off("click",e.onTextFieldClick),(0,a.Z)(i).off("input",e.onTextFieldChange),(0,a.Z)(i).off("blur",e.onTextFieldBlur)})),t&&this.environment===v.ZP.environment.preview&&(this.$itemsTab.find(".cart-item-block").off("mouseover",this.onDynamicMouseOver),this.$itemsTab.find(".cart-item-block").off("mouseleave",this.onDynamicMouseLeave))},onDynamicMouseOver:function(e){(0,a.Z)(e.target).find(".cart-price-input, .cart-quantity-input").addClass("active")},onDynamicMouseLeave:function(e){(0,a.Z)(e.target).find(".cart-price-input, .cart-quantity-input").each((function(){(0,a.Z)(this).is(":focus")||(0,a.Z)(this).removeClass("active")}))},onTextFieldClick:function(e){e.preventDefault()},onTextFieldChange:function(e){if(e.target.dataset.dynamicWidth){var t=this.calcTextFieldSize(e.target);t&&(e.target.style.width="".concat(t,"px"))}},onTextFieldFocus:function(e){this.environment===v.ZP.environment.preview&&(0,a.Z)(e.target).addClass("active")},onTextFieldBlur:function(e){var t=this;this.environment===v.ZP.environment.preview&&(0,a.Z)(e.target).removeClass("active");var i=e.target.getAttribute("name"),n=this.getSidebarTextValue(i);if(n)if(e.target.value){if(this.cartWidgetModel){var s=C({},this.getTextFieldModelKey(i),e.target.value);this.updateCartWidgetData(s),this.cartWidgetModel.save(s,{toHistory:!1,skipHistory:!0,patch:!0}).then((function(){e.target.dataset.dynamicWidth&&t.renderSidebarTexts()}))}}else e.target.value=n},toogleSettings:function(){this.isHiddenSettings=!this.isHiddenSettings,this.settingsPanel&&(this.settingsPanel.isHidden=this.isHiddenSettings)},getSettingsData:function(){var e={};if(this.cartWidgetData){var t=n.Z.clone(this.cartWidgetData);e={"bar-color":t["bar-color"],"bar-color-opacity":t["bar-color-opacity"],"bar-background-color":t["bar-background-color"],"bar-background-color-opacity":t["bar-background-color-opacity"],"bar-shadow":t["bar-shadow"],"bar-font-family":t["bar-font-family"],"bar-font-style":t["bar-font-style"],"bar-font-weight":t["bar-font-weight"],"bar-letter-spacing":t["bar-letter-spacing"]}}return{isHidden:this.isHiddenSettings,model:e,onOverlayClick:this.onSettingsOverlayClick.bind(this)}},setupSettingsPanel:function(){},onSettingsOverlayClick:function(){this.toogleSettings()},onModelChange:function(e){this.saveModelChanges_debounced(e)},saveModelChanges:function(e){var t=this;this.updateCartWidgetData(e),this.generateSidebarCSS(this.cartWidgetData),this.cartWidgetModel&&this.cartWidgetModel.save(e,{toHistory:!1,skipHistory:!0,patch:!0}).then((function(){t.renderSidebarTexts()}))},updateCartWidgetData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.cartWidgetData=P(P({},this.cartWidgetData),e)},destroy:function(){if(this.rendered)return this.mag.eCommerceManager.events.off("ecommerce:cartsidebar:visibility:changed"),this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed"),this.$items.find(".cart-item-remove-btn").each((function(e,t){(0,a.Z)(t).off("click")})),this.unbindDomEvents(),this.settingsPanel&&(this.settingsPanel.$off("change",this.onModelChange),this.settingsPanel.$destroy()),this.$settingButton&&this.$settingButton.off("click",this.toogleSettings),this.environment===v.ZP.environment.preview&&this.unbindTextInputsEvents(),(0,a.Z)("#".concat(this.stylesElementId)).remove(),this.remove()},cartItemBlockHover:function(e){var t=(0,a.Z)(e.currentTarget);t&&t.length&&(t.addClass("hover").siblings().removeClass("hover"),this.hoveredItem=t.data("price-id")||t.data("sku-id"))},cartItemBlockLeave:function(e){var t=(0,a.Z)(e.currentTarget);t&&t.length&&(t.removeClass("hover"),(t.data("price-id")||t.data("sku-id"))===this.hoveredItem&&(this.hoveredItem=null))}});t.Z=S},1057:function(e,t,i){"use strict";var n=i(322),a=i(313),s=i(944),r=i.n(s),o=i(664),c=i(878),d=i.n(c),l=i(1058),h=i(1059),u=i(341),p=i(343),g=i(308),m=i(1061),v=i(1060),f=i(873),b=i(348),w=i(999);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,i,n,a,s,r){try{var o=e[s](r),c=o.value}catch(e){return void i(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function C(e){return function(){var t=this,i=arguments;return new Promise((function(n,a){var s=e.apply(t,i);function r(e){P(s,n,a,r,o,"next",e)}function o(e){P(s,n,a,r,o,"throw",e)}r(void 0)}))}}function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function k(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){T(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function T(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Z,x,$,O,M,_,I,E,D,F,L,A,W,V=g.ZP.stripe_live?g.ZP.STRIPE_LIVE_PUBLIC_KEY:g.ZP.STRIPE_TEST_PUBLIC_KEY,B=Backbone.View.extend({template:h.Z["template-viewer-cart-sidebar"],cardStyle:{base:{letterSpacing:"0.3px",color:"#0080FF",fontSize:"16px",fontFamily:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Ubuntu, 'Fira Sans', Roboto, 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif","::placeholder":{color:"#CFD7DF"},fontSmoothing:"antialiased"},invalid:{color:"#e5424d",":focus":{color:"#303238"}}},getRenderStatus:function(){return this.rendered},initialize:function(e){return n.Z.bindAll(this),this.mag=e,this.environment=this.mag.router.environment,this.rendered=!1,this.haveSkus=!1,this.havePrices=!1,this.checkoutCompete=!1,this.isHiddenSettings=!0,this.activeTab="tab-items",this.orderLoading=!1,this.paymentLoading=!1,this.hoveredItem=null,this.shippingForm={name:{value:null,error:null,validationRules:[{title:"required"}]},phone:{value:null,error:null,validationRules:[{title:"phoneNumber"}]},line1:{value:null,error:null,validationRules:[{title:"required"}]},line2:{value:null,error:null,validationRules:[]},city:{value:null,error:null,validationRules:[{title:"required"}]},state:{value:null,error:null,validationRules:[]},country:{value:"default",error:null,validationRules:[{title:"required",func:function(e,t){return"default"===t?"field is required":null}}]},postal_code:{value:null,error:null,validationRules:[]},email:{value:null,error:null,validationRules:[{title:"required"},{title:"email"}]},note:{value:null,error:null,validationRules:[]}},this.cardHolderNameValue=null,this.clearShippingFormField_debounced=n.Z.debounce(this.clearShippingFormField,200),this.render(),this},render:function(){if(!RM.screenshot){var e=w.Z.getPermissions();if(e&&e.can_use_e_commerce&&!this.mag.eCommerceManager.isConstructor()&&this.mag.eCommerceManager.haveEcommerceCartWidget&&this.mag.eCommerceManager.isMagConnectedTo("stripe")&&!this.rendered){this.rendered=!0,document.querySelectorAll("#cart-sidebar").length&&document.querySelectorAll("#cart-sidebar").forEach((function(e){return e.parentNode.removeChild(e)})),this.setElement(this.template({isMobile:(0,l.isMobile)(),isViewer:this.environment===g.ZP.environment.viewer,imgPublicPath:b.folderImagesPath})),this.$el.appendTo((0,a.Z)("body")),this.$toolbar=(0,a.Z)(".toolbar.for-viewer"),this.$tabs=this.$el.find(".cart-sidebar-tabs"),this.$items=this.$el.find(".cart-items-list"),this.$closeButton=this.$el.find(".close-button"),this.$footer=this.$el.find(".sidebar-footer"),this.$navButtons=this.$el.find(".sidebar-btn"),this.$calcTextContainer=this.$el.find(".text-size-calc-container"),this.$itemsTab=this.$tabs.find(".tab-items"),this.$shippingTab=this.$tabs.find(".tab-inputs"),this.$orderTab=this.$tabs.find(".tab-order"),this.$paymentTab=this.$tabs.find(".tab-checkout"),this.$goToPayment=this.$orderTab.find(".cart-pay-btn"),this.$orderDetails=this.$orderTab.find(".order-details"),this.$orderItems=this.$orderTab.find(".order-items-list"),this.$orderError=this.$orderTab.find(".order-error"),this.$orderShippingAddress=this.$orderTab.find(".order-shipping-address"),this.$orderShippingMethod=this.$orderTab.find(".order-shipping-method"),this.$orderShippingEmail=this.$orderTab.find(".order-shipping-email"),this.$orderTax=this.$orderTab.find(".order-tax"),this.$orderTotalPrice=this.$orderTab.find(".order-total-price"),this.$paymentSuccess=this.$tabs.find("#payment-success-msg"),this.$paymentFailed=this.$tabs.find("#payment-failed-msg"),this.cartWidgetData=this.mag.eCommerceManager.getCartWidgetData(),this.environment===g.ZP.environment.preview&&(this.cartWidgetData&&this.cartWidgetData._id&&this.setupSettingsPanel(),window.RM.constructorRouter.on("previewClose",this.closeSideBar.bind(this)),this.bindTextInputsEvents());var t=this.$el.find(".svg");return r()(t),this.$el.find("[data-alt]:not(.rmalttext)").RMAltText(),this.generateSidebarCSS(this.cartWidgetData),this.renderSidebarTexts(),this.renderCartItems(),this.renderShippingForm(),this.initNavigation(),this.bindDomEvents(),p.Z.on("ecommerce:cartsidebar:visibility:changed",this.toggleSidebar),this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderCartItems),this}}},bindDomEvents:function(){this.$closeButton.on("click",this.closeSideBar.bind(this)),this.$tabs.find(".cart-cancel-btn").on("click",this.cancelOrder.bind(this)),(0,a.Z)(document).on("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),(0,a.Z)(document).on("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave),this.bindStaticTextFieldsHovers()},unbindDomEvents:function(){this.$closeButton.off("click",this.closeSideBar),this.$tabs.find(".cart-cancel-btn").off("click",this.cancelOrder),(0,a.Z)(document).off("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),(0,a.Z)(document).off("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},bindStaticTextFieldsHovers:function(){this.environment===g.ZP.environment.preview&&(this.$itemsTab.find(".cart-title-input, .empty-cart-title-input").on("mouseover",(function(e){(0,a.Z)(e.target).addClass("active")})),this.$itemsTab.find(".cart-title-input, .empty-cart-title-input").on("mouseleave",(function(e){(0,a.Z)(e.target).is(":focus")||(0,a.Z)(e.target).removeClass("active")})),this.$itemsTab.find(".сheck-out-btn").on("mouseover",(function(e){(0,a.Z)(e.target).find(".cart-checkout-input").addClass("active")})),this.$itemsTab.find(".сheck-out-btn").on("mouseleave",(function(e){var t=(0,a.Z)(e.target).find(".cart-checkout-input");t.is(":focus")||t.removeClass("active")})))},hideSidebar:function(){this.$el.removeClass("show"),(0,a.Z)("body").removeClass("cart-sidebar-shown"),(0,a.Z)("html").removeClass("cart-disable-scroll"),!this.isHiddenSettings&&this.settingsPanel&&(this.isHiddenSettings=!0,this.settingsPanel.isHidden=this.isHiddenSettings)},toggleSidebar:function(e){e?(this.hideSidebar(),this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.clearOrderError()):(this.$el.addClass("show"),(0,a.Z)("body").addClass("cart-sidebar-shown"),(0,a.Z)("html").addClass("cart-disable-scroll"))},closeSideBar:function(){this.mag.eCommerceManager.isCartSidebarHidden||this.mag.eCommerceManager.changeCartSidebarVisibility()},initNavigation:function(){this.$tabs.find("[data-tab^='tab-']").each(function(e,t){(0,a.Z)(t).on("click",function(e){if(!e.isDefaultPrevented())if(this.haveSkus&&this.havePrices)window.alert("You can't buy all these products, try separately");else if(this.haveSkus||this.havePrices){if("tab-inputs"===t.dataset.tab&&(this.updateShippingForm(),RM.analytics&&RM.analytics.sendEvent("Checkout 1st step completed")),"tab-order"===t.dataset.tab){if(!this.validateShippingForm())return void this.renderShippingFormErrors();this.clearShippingFormErrors(),RM.analytics&&RM.analytics.sendEvent("Checkout 2nd step completed");var i,a,s=this.mag.eCommerceManager.getShippingForm();s&&(i=n.Z.mapObject(s,(function(e){return{value:e.value}})),a=n.Z.mapObject(this.shippingForm,(function(e){return{value:e.value}}))),(!s||s&&!n.Z.isEqual(i,a))&&(this.mag.eCommerceManager.setShippingForm(this.shippingForm),this.havePrices&&(this.needForUpdateCustomer=!0)),this.haveSkus&&this.renderOrderTab(),this.havePrices&&this.renderOrderTabForPrices()}"tab-checkout"===t.dataset.tab&&(RM.analytics&&RM.analytics.sendEvent("Checkout 3rd step completed"),this.haveSkus&&this.renderCheckoutForm(),this.havePrices&&this.renderCheckoutFormPaymentIntent()),this.goToTabByClassname("."+t.dataset.tab)}}.bind(this))}.bind(this))},goToTabByClassname:function(e){this.$tabs.find(".cart-sidebar-tab").each((function(e,t){(0,a.Z)(t).removeClass("active")})),this.$tabs.find(e).addClass("active"),this.activeTab=e.slice(1)},goToInitialTab:function(){this.goToTabByClassname(".tab-items")},generateSidebarCSS:function(e){var t="cart_sidebar_styles_".concat(e._id),i=u.default.getRGBA(e["bar-color"],e["bar-color-opacity"]/100),n=u.default.getRGBA(e["bar-background-color"],e["bar-background-color-opacity"]/100),s=u.default.getRGBA(e["bar-color"],.45*e["bar-color-opacity"]/100),r=this.getAdditionalColor(n);this.cardStyle=k(k({},this.cardStyle),{},{base:k(k({},this.cardStyle.base),{},{color:i,fontWeight:e["bar-font-weight"],"::placeholder":{color:s}}),invalid:k(k({},this.cardStyle.invalid),{},{color:s,fontWeight:e["bar-font-weight"],":focus":{color:i},"::placeholder":{color:s}})});var c="    .cart-sidebar {\n\n      color: ".concat(i,";\n      background-color: ").concat(n,";\n      box-shadow: ").concat(e["bar-shadow"]?"0 0 4px rgba(124, 124, 125, 0.5)":"none",";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar textarea {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar input {\n\n      color: ").concat(i,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar input::placeholder {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .cart-title-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,i),";\n    }\n\n    .cart-sidebar .empty-cart-title-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,i),";\n    }\n\n    .cart-sidebar .cart-price-input.active, .cart-sidebar .cart-quantity-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.2,s),";\n    }\n\n    .cart-sidebar .cart-checkout-input.active {\n\n      border-color: ").concat((0,o.transparentize)(.8,i),";\n    }\n\n    .cart-sidebar .cart-price-input {\n\n      color: ").concat(s,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar .cart-quantity-input {\n\n      color: ").concat(s,";\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar button {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar select {\n\n      font-family: ").concat(e["bar-font-family"],";\n      font-weight: ").concat(e["bar-font-weight"],";\n      font-style: ").concat(e["bar-font-style"],";\n    }\n\n    .cart-sidebar .sidebar-btn {\n\n      color: ").concat(i,";\n      border-color: ").concat(s,";\n    }\n\n    .cart-sidebar .preloader svg path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-btn path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .expand-arrow svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .cart-cancel-btn {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block.hover {\n\n      background-color: ").concat(r,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-attributes {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-price {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-items-quantity {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-remove-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-decrease-btn-icon rect {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-increase-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form, .cart-sidebar .sidebar-body .order-details-form .form-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-input::placeholder {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select.selected {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-title {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .form-error {\n\n      background-color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-select-popup {\n\n      background-color: ").concat(r,";\n    }\n\n    .cart-sidebar .tab-order .order-details .order-title-row {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .tab-order .order-details .rm-native-fake-select {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input::placeholder {\n\n      color: ").concat(s,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon {\n\n      border-color: ").concat(s,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon svg g {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-settings-container .settings-button path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-settings-container .settings-button:hover path {\n\n      stroke: ").concat(s,";\n    }\n\n    .cart-sidebar.cart-is-mobile .sidebar-body .cart-item-block {\n\n      background-color: ").concat(r,";\n    }");(0,a.Z)("#".concat(t)).remove();var d=document.createElement("style");d.type="text/css",d.id=t,d.className="cart-sidebar-styles",d.appendChild(document.createTextNode(c)),document.querySelector("head").appendChild(d)},getAdditionalColor:function(e){return(0,o.getLuminance)(e)<.05&&(0,o.getContrast)("#fff",e)-(0,o.getContrast)("#000",e)>=8?(0,o.lighten)(.1,e):(0,o.darken)(.1,e)},renderCartItems:function(){var e=this.mag.eCommerceManager.getCartData();if(e&&e.skus){var t=Object.keys(e.skus),i=Object.keys(e.prices);this.$items.empty(),this.haveSkus=!!t.length,this.havePrices=!!i.length,this.haveSkus||this.havePrices?(this.$itemsTab.find(".сheck-out-btn").css("display","block"),this.$itemsTab.find(".empty-cart").css("display","none")):(this.$itemsTab.find(".сheck-out-btn").css("display","none"),this.$itemsTab.find(".empty-cart").css("display","flex")),this.renderPricesCartItems(i),this.renderSkusCartItems(t);var n=this.$items.find(".svg");r()(n),this.renderSidebarTexts(),this.unbindTextInputsEvents(!0),this.bindTextInputsEvents(!0)}},renderCartItem:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"price",n=this.hoveredItem===e.id,s=(0,a.Z)("<div/>",{class:"cart-item-block".concat(n?" hover":"")});s.data("".concat(i,"-id"),e.id);var r=e.image||e.productObject.images&&e.productObject.images.length;if(r){var o=e.image?e.image:e.productObject.images?e.productObject.images[0]:"";t=(0,a.Z)("<div/>",{class:"cart-item-image",css:{"background-position":"center center","background-size":"cover","background-repeat":"no-repeat","background-image":"url(".concat(o,")")}}),s.append(t)}var c=(0,a.Z)("<div/>",{class:t?"cart-item-title":"cart-item-title without-image"}).text(e.productObject.name),d=e.cart_count,l=(("price"===i?e.unit_amount:e.price)/100).toFixed(2),h=(0,m.x)(l,e.currency),p=(0,m.x)((l*d).toFixed(2),e.currency),g=(0,a.Z)("<div/>",{class:"cart-item-price"}),v=(0,a.Z)("<input/>",{type:"text",class:"cart-text-input cart-price-input",name:"price",placeholder:"Price",maxlength:"32",translate:"no",autocomplete:"no",autocorrect:"no",spellcheck:"false"});v.get(0).dataset.dynamicWidth=!0;var f,w=(0,a.Z)("<span/>").html(d>1?": ".concat(h," × ").concat(d," = ").concat(p):": ".concat(h));if(g.append(v).append(w),"sku"===i){f=(0,a.Z)("<div/>",{class:"cart-item-attributes"});var y=e.attributes;for(var P in y){var C=(0,a.Z)("<div/>",{class:"cart-item-attribute"}).html("".concat(u.default.capitalize(P),": ").concat(y[P]));f.append(C)}}var S=(0,a.Z)("<div/>",{class:"cart-items-quantity"}),k=(0,a.Z)("<input/>",{type:"text",class:"cart-text-input cart-quantity-input",name:"quantity",placeholder:"Quantity",maxlength:"32",translate:"no",autocomplete:"no",autocorrect:"no",spellcheck:"false"});k.get(0).dataset.dynamicWidth=!0;var T=(0,a.Z)("<span/>").html(": ".concat(d));S.append(k).append(T);var Z=(0,a.Z)("<div/>",{class:"cart-item-remove-btn",title:"remove"}).attr("data-".concat(i,"-id"),e.id),x=(0,a.Z)("<img/>",{class:"svg cart-item-remove-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-delete.svg")});Z.append(x),Z.on("click",this.onRemoveItem);var $=(0,a.Z)("<div/>",{class:"cart-item-edit-group"}),O=(0,a.Z)("<div/>",{class:"cart-item-increase-btn"}).attr("data-".concat(i,"-id"),e.id),M=(0,a.Z)("<img/>",{class:"svg cart-item-increase-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-increase.svg")});if(O.append(M),$.append(O),("price"===i||this.mag.eCommerceManager.checkItemQuantity(e.id))&&(O.addClass("active"),O.on("click",this.onIncreaseItem)),d>1){var _=(0,a.Z)("<div/>",{class:"cart-item-decrease-btn decrease-btn-".concat(e.id)}).attr("data-".concat(i,"-id"),e.id),I=(0,a.Z)("<img/>",{class:"svg cart-item-decrease-btn-icon",src:(0,b.findImagePath)("./viewer/cart-sidebar/cart-item-decrease.svg")});_.append(I),$.append(_),_.on("click",this.onDecreaseItem)}else{var E=this.$items.find("decrease-btn-".concat(e.id));E.off("click",this.onDecreaseItem),E.remove()}"price"===i?s.append(c).append(g).append(S).append(Z).append($):s.append(c).append(f).append(g).append(S).append(Z).append($),this.$items.append(s)},renderPricesCartItems:function(e){var t=this,i=this.mag.eCommerceManager.getCartData();e.forEach((function(e){var n=i.prices[e];n.active&&t.renderCartItem(n)}))},renderSkusCartItems:function(e){var t=this,i=this.mag.eCommerceManager.getCartData();e.forEach((function(e){var n=i.skus[e];n.active&&t.renderCartItem(n,"sku")}))},onRemoveItem:function(e){e.currentTarget.dataset.priceId?this.mag.eCommerceManager.removeFromCart(e.currentTarget.dataset.priceId):e.currentTarget.dataset.skuId&&this.mag.eCommerceManager.removeSkuFromCart(e.currentTarget.dataset.skuId)},onIncreaseItem:function(e){e.currentTarget.dataset.priceId?this.mag.eCommerceManager.increaseCartItem(e.currentTarget.dataset.priceId):e.currentTarget.dataset.skuId&&this.mag.eCommerceManager.increaseSkuCartItem(e.currentTarget.dataset.skuId)},onDecreaseItem:function(e){e.currentTarget.dataset.priceId?this.mag.eCommerceManager.decreaseCartItem(e.currentTarget.dataset.priceId):e.currentTarget.dataset.skuId&&this.mag.eCommerceManager.decreaseSkuCartItem(e.currentTarget.dataset.skuId)},getTextFieldModelKey:function(e){return"bar-".concat(e)},getSidebarTextValue:function(e){var t=this.getTextFieldModelKey(e);return this.cartWidgetData&&this.cartWidgetData[t]?d()(this.cartWidgetData[t]):g.ZP.defaultSidebarTexts[e]?g.ZP.defaultSidebarTexts[e]:null},calcTextFieldSize:function(e){if(!e)return null;var t=getComputedStyle(e);this.$calcTextContainer.css({"font-family":t.fontFamily,"font-size":t.fontSize,"font-style":t.fontStyle,"font-weight":t.fontWeight,"letter-spacing":t.letterSpacing}),this.$calcTextContainer.text(e.value);var i=this.$calcTextContainer.width();return Math.ceil(i)},renderSidebarTexts:function(){var e=this;this.$itemsTab.find(".cart-text-input").each((function(t,i){var n=i.getAttribute("name"),a=e.getSidebarTextValue(n);if(a&&(i.value=a,i.dataset.dynamicWidth)){var s=e.calcTextFieldSize(i);s&&(i.style.width="".concat(s,"px"))}}))},bindTextInputsEvents:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$itemsTab.find(".cart-text-input"+(t?'[data-dynamic-width="true"]':"")).each((function(t,i){(0,a.Z)(i).on("click",e.onTextFieldClick),(0,a.Z)(i).on("input",e.onTextFieldChange),(0,a.Z)(i).on("focus",e.onTextFieldFocus),(0,a.Z)(i).on("blur",e.onTextFieldBlur)})),t&&this.environment===g.ZP.environment.preview&&(this.$itemsTab.find(".cart-item-block").on("mouseover",this.onDynamicMouseOver),this.$itemsTab.find(".cart-item-block").on("mouseleave",this.onDynamicMouseLeave))},unbindTextInputsEvents:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$itemsTab.find(".cart-text-input"+(t?'[data-dynamic-width="true"]':"")).each((function(t,i){(0,a.Z)(i).off("click",e.onTextFieldClick),(0,a.Z)(i).off("input",e.onTextFieldChange),(0,a.Z)(i).off("focus",e.onTextFieldFocus),(0,a.Z)(i).off("blur",e.onTextFieldBlur)})),t&&this.environment===g.ZP.environment.preview&&(this.$itemsTab.find(".cart-item-block").off("mouseover",this.onDynamicMouseOver),this.$itemsTab.find(".cart-item-block").off("mouseleave",this.onDynamicMouseLeave))},onDynamicMouseOver:function(e){(0,a.Z)(e.target).find(".cart-price-input, .cart-quantity-input").addClass("active")},onDynamicMouseLeave:function(e){(0,a.Z)(e.target).find(".cart-price-input, .cart-quantity-input").each((function(){(0,a.Z)(this).is(":focus")||(0,a.Z)(this).removeClass("active")}))},onTextFieldClick:function(e){e.preventDefault()},onTextFieldChange:function(e){if(e.target.dataset.dynamicWidth){var t=this.calcTextFieldSize(e.target);t&&(e.target.style.width="".concat(t,"px"))}},onTextFieldFocus:function(e){this.environment===g.ZP.environment.preview&&(0,a.Z)(e.target).addClass("active")},onTextFieldBlur:function(e){var t=this;this.environment===g.ZP.environment.preview&&(0,a.Z)(e.target).removeClass("active");var i=e.target.getAttribute("name"),n=this.getSidebarTextValue(i);if(n)if(e.target.value){if(this.cartWidgetModel){var s=T({},this.getTextFieldModelKey(i),e.target.value);this.updateCartWidgetData(s),this.cartWidgetModel.save(s,{toHistory:!1,skipHistory:!0,patch:!0}).then((function(){e.target.dataset.dynamicWidth&&t.renderSidebarTexts()}))}}else e.target.value=n},renderShippingForm:(W=C(regeneratorRuntime.mark((function e(){var t,s,r,o,c,d,l,h,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=n.Z.clone(v.h)).unshift({value:"default",caption:"Country"}),s=this.mag.eCommerceManager.getCartData(),(r=s.shippingForm)&&"object"===y(r)&&(this.shippingForm=r),e.next=7,i.e(31).then(i.bind(i,1133));case 7:return o=e.sent,c=o.default,e.next=11,Promise.resolve().then(i.bind(i,345));case 11:d=e.sent,l=d.default,h=l.extend(c),this.countrySelect=new h({el:this.$tabs.find(".countries-select").get(0),propsData:{options:function(){return t},value:this.shippingForm.country.value,isDesktop:!1,callback:this.onCountryChange}}),this.mag.eCommerceManager.hasShippableProducts()?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden"),this.$tabs.find(".order-details-form .form-input").each((function(e,t){var i=t.getAttribute("name");u.shippingForm[i]&&(t.value=u.shippingForm[i].value),(0,a.Z)(t).on("input",u.onShippingFormChange)}));case 17:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)}),updateShippingForm:function(){var e=this.mag.eCommerceManager.getShippingForm();e&&"object"===y(e)&&(this.shippingForm=e),this.mag.eCommerceManager.hasShippableProducts()?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden")},onCountryChange:function(e){this.shippingForm.country.value=e,this.countrySelect.value=e,this.clearShippingFormField_debounced("country")},onShippingFormChange:function(e){var t=e.target.getAttribute("name");void 0!==this.shippingForm[t]&&"object"===y(this.shippingForm[t])&&(this.shippingForm[t].value=e.target.value,this.clearShippingFormField_debounced(t))},renderShippingFormErrors:function(){var e=this;Object.keys(this.shippingForm).forEach((function(t){e.shippingForm[t].error&&e.$shippingTab.find(".form-error.".concat(t,"-error")).removeClass("hidden")}))},clearShippingFormErrors:function(){var e=this;Object.keys(this.shippingForm).forEach((function(t){e.$tabs.find(".form-error.".concat(t,"-error")).addClass("hidden")}))},clearShippingFormField:function(e){if(void 0!==this.shippingForm[e]&&this.shippingForm[e].error){var t=this.validateShippingFormField(e);t&&t.success&&(this.$tabs.find(".form-error.".concat(e,"-error")).addClass("hidden"),this.shippingForm[e].error=null)}},validateShippingFormField:function(e){var t=this,i=[];if(void 0!==this.shippingForm[e])return this.shippingForm[e].validationRules.length?(this.shippingForm[e].validationRules.forEach((function(n){if("function"==typeof n.func){var a=n.func(e,t.shippingForm[e].value);a&&i.push(a)}else{var s=t["".concat(n.title,"Validation")](e,t.shippingForm[e].value);s&&i.push(s)}})),i.length?{success:!1,error:!0,errorMessages:i}:{success:!0}):{success:!0}},requiredValidation:function(e,t){return t?null:"field is required"},emailValidation:function(e,t){return t?u.default.isValidEmail(t)?null:"it's not email":null},phoneNumberValidation:function(e,t){return t?u.default.isValidPhoneNumber(t)?null:"it's not  phone number":null},validateShippingForm:function(){var e=!1;if(this.mag.eCommerceManager.hasShippableProducts())for(var t in this.shippingForm){var i=this.validateShippingFormField(t);i&&(i.success?this.shippingForm[t].error=null:(this.shippingForm[t].error=i.errorMessages,e=!0))}else{var n=this.validateShippingFormField("email");n&&(n.success?this.shippingForm.email.error=null:(this.shippingForm.email.error=n.errorMessages,e=!0))}return!e},renderOrderTab:function(){var e=this;this.clearOrderError();var t=this.mag.eCommerceManager.getCartData(),i=t.order;if(i&&i.created<Math.floor(Date.parse(t.changed)/1e3))return this.showOrderLoader(),void this.mag.eCommerceManager.cancelOrder().then((function(t){t.data&&"canceled"===t.data.status&&(e.mag.eCommerceManager.deleteOrder(),e.createOrder())})).catch((function(t){e.hideOrderLoader(),e.renderOrderError(t&&t.message?t.message:""),e.mag.eCommerceManager.deleteOrder()}));i?this.renderOrderDetails():this.createOrder()},renderOrderTabForPrices:(A=C(regeneratorRuntime.mark((function e(){var t,i,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearOrderError(),this.showOrderLoader(),e.next=4,this.getCustomer();case 4:if(!(t=e.sent)){e.next=42;break}return e.next=8,this.getInvoiceItemsForCustomer(t.id);case 8:if(!e.sent){e.next=42;break}return e.next=12,this.getInvoiceForCustomer(t.id);case 12:if(!(i=e.sent)){e.next=42;break}if(!(i.created<Math.floor(Date.parse(this.mag.eCommerceManager.getCartData().changed)/1e3))){e.next=41;break}if(!this.needForUpdateCustomer){e.next=19;break}return e.next=18,this.updateOrCreateCustomer();case 18:this.needForUpdateCustomer=!1;case 19:return e.prev=19,e.next=22,this.cancelInvoice(i);case 22:e.next=29;break;case 24:return e.prev=24,e.t0=e.catch(19),this.renderOrderError("can't cancel old order"),this.hideOrderLoader(),e.abrupt("return");case 29:return e.prev=29,e.next=32,this.createInvoiceWithItems();case 32:(n=e.sent)&&this.renderInvoiceDetails(n),e.next=39;break;case 36:e.prev=36,e.t1=e.catch(29),this.renderOrderError("can't create order");case 39:e.next=42;break;case 41:this.renderInvoiceDetails(i);case 42:this.hideOrderLoader();case 43:case"end":return e.stop()}}),e,this,[[19,24],[29,36]])}))),function(){return A.apply(this,arguments)}),renderInvoiceDetails:(L=C(regeneratorRuntime.mark((function e(t){var i,n,s,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$orderItems.empty(),this.$orderShippingAddress.empty(),this.$orderShippingMethod.empty(),this.$orderShippingEmail.empty(),this.$orderTax.empty(),this.$orderTotalPrice.empty(),t.lines.data.forEach((function(e){var t=(0,a.Z)("<div/>",{class:"order-item"}).html(e.quantity+" × "+e.description),i=(0,a.Z)("<div/>",{class:"order-item-price"}).text((0,m.x)((e.amount/100).toFixed(2),e.currency));t.append(i),r.$orderItems.append(t)})),t.customer_shipping&&t.customer_shipping.address&&(i=function(e){return e?" ".concat(e):""},n=t.customer_shipping.address,s="".concat(n.line1).concat(i(n.line2)," ").concat(n.city,",").concat(i(n.state)).concat(i(n.postal_code)," ").concat(n.country),this.$orderShippingAddress.text(s),this.$tabs.find(".shipping-details").removeClass("hidden")),this.$orderShippingMethod.parent(".shipping-method.order-row").addClass("hidden"),this.$orderDetails.find(".order-id").text(String(t.id).slice(0,20)+"..."),this.$orderShippingEmail.text(t.customer_email),this.$orderDetails.find(".shipping-email").removeClass("hidden"),t.customer_phone?(this.$orderDetails.find(".order-shipping-phone").text(t.customer_phone),this.$orderDetails.find(".shipping-phone").removeClass("hidden")):this.$orderDetails.find(".shipping-phone").addClass("hidden"),t.tax?(this.$orderTax.parent(".shipping-tax-size.order-row").removeClass("hidden"),this.$orderTax.text((0,m.x)((t.tax/100).toFixed(2),t.currency))):this.$orderTax.parent(".shipping-tax-size.order-row").addClass("hidden"),this.$orderTotalPrice.text((0,m.x)((t.total/100).toFixed(2),t.currency)),this.$goToPayment.removeClass("hidden");case 16:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)}),getCustomer:(F=C(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.mag.eCommerceManager.getCartData()).customer){e.next=17;break}return e.prev=2,e.next=5,this.mag.eCommerceManager.createOrUpdateCustomer(this.mag.num_id,this.generateCustomerDataFromShippingForm(t.shippingForm));case 5:if(!(i=e.sent)||!i.data){e.next=9;break}return this.mag.eCommerceManager.setCustomer(i.data),e.abrupt("return",i.data);case 9:e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(2),console.error(e.t0),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",t.customer);case 18:case"end":return e.stop()}}),e,this,[[2,11]])}))),function(){return F.apply(this,arguments)}),updateOrCreateCustomer:(D=C(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mag.eCommerceManager.getCartData(),e.next=3,this.mag.eCommerceManager.createOrUpdateCustomer(this.mag.num_id,this.generateCustomerDataFromShippingForm(t.shippingForm));case 3:if(!(i=e.sent)||!i.data){e.next=7;break}return this.mag.eCommerceManager.setCustomer(i.data),e.abrupt("return",i.data);case 7:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)}),generateCustomerDataFromShippingForm:function(e){var t={email:e.email.value,name:e.name.value,shipping:{address:{country:e.country.value,city:e.city.value,line1:e.line1.value},name:e.name.value}};return e.phone.value&&(t.phone=e.phone.value,t.shipping.phone=e.phone.value),e.line2.value&&(t.shipping.address.line2=e.line2.value),e.postal_code.value&&(t.shipping.address.postal_code=e.postal_code.value),e.state.value&&(t.shipping.address.state=e.state.value),t},getInvoiceItemsForCustomer:(E=C(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=this.mag.eCommerceManager.getCartData()).invoiceItems&&i.invoiceItems.length>0)){e.next=5;break}return e.abrupt("return",i.invoiceItems);case 5:return e.next=7,this.createInvoiceItemsForCustomer(t);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)}),createInvoiceItemsForCustomer:(I=C(regeneratorRuntime.mark((function e(t){var i,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.mag.eCommerceManager.getCartData(),n=Object.keys(i.prices).map((function(e){return{price:i.prices[e].id,quantity:i.prices[e].cart_count}})),e.prev=2,e.next=5,this.mag.eCommerceManager.createInvoiceItems(this.mag.num_id,t,n);case 5:if(!((a=e.sent)&&a.data&&a.data.length)){e.next=9;break}return this.mag.eCommerceManager.setInvoiceItems(a.data),e.abrupt("return",a.data);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,11]])}))),function(e){return I.apply(this,arguments)}),getInvoiceForCustomer:(_=C(regeneratorRuntime.mark((function e(t){var i,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=this.mag.eCommerceManager.getCartData()).invoice||!i.invoice.id){e.next=15;break}return e.next=4,this.mag.eCommerceManager.getInvoice(this.mag.num_id,i.invoice.id);case 4:if(!(n=e.sent)||"draft"!==n.status&&"open"!==n.status){e.next=10;break}return this.mag.eCommerceManager.setInvoice(n),e.abrupt("return",n);case 10:return e.next=12,this.createInvoiceForCustomer(t);case 12:return e.abrupt("return",e.sent);case 13:e.next=18;break;case 15:return e.next=17,this.createInvoiceForCustomer(t);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)}),createInvoiceForCustomer:(M=C(regeneratorRuntime.mark((function e(t){var i,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.mag.eCommerceManager.getCartData(),n={customer:t,collection_method:"charge_automatically",auto_advance:!1},i.shippingForm&&i.shippingForm.note.value&&(n.metadata={customer_note:i.shippingForm.note.value}),e.prev=3,e.next=6,this.mag.eCommerceManager.createInvoice(this.mag.num_id,n);case 6:if(!(a=e.sent)||!a.data){e.next=10;break}return this.mag.eCommerceManager.setInvoice(a.data),e.abrupt("return",a.data);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),e.t0&&e.t0.type===f.Kq.nothingToInvoice&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab());case 15:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return M.apply(this,arguments)}),createInvoiceWithItems:(O=C(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCustomer();case 2:return t=e.sent,e.next=5,this.createInvoiceItemsForCustomer(t.id);case 5:return e.next=7,this.createInvoiceForCustomer(t.id);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)}),cancelInvoice:($=C(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("draft"!==t.status){e.next=5;break}return e.next=3,this.mag.eCommerceManager.deleteDraftInvoice(this.mag.num_id,t.id);case 3:e.next=8;break;case 5:if("open"!==t.status&&"uncollectible"!==t.status){e.next=8;break}return e.next=8,this.mag.eCommerceManager.voidDraftInvoice(this.mag.num_id,t.id);case 8:this.mag.eCommerceManager.unsetInvoiceItems(),this.mag.eCommerceManager.unsetInvoice();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)}),createOrder:function(){this.showOrderLoader(),this.mag.eCommerceManager.updateCartData().then(function(){var e=this,t=this.generateOrderRequestData();t&&t instanceof Error?this.renderOrderError(t.message):t&&t.currency&&a.Z.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){e.hideOrderLoader(),t&&t.data&&(e.mag.eCommerceManager.setOrder(t.data),e.renderOrderDetails())},error:function(t){var i=JSON.parse(t.responseText);e.hideOrderLoader(),e.renderOrderError(i.message)}})}.bind(this)).catch(function(e){this.hideOrderLoader(),e&&e.message&&this.renderOrderError(e.message)}.bind(this))},showOrderLoader:function(){this.orderLoading||(this.orderLoading=!0,this.$goToPayment.hasClass("hidden")||this.$goToPayment.addClass("hidden"),this.$orderTab.find(".preloader").addClass("show"),this.$orderDetails.addClass("hidden"))},hideOrderLoader:function(){this.orderLoading&&(this.orderLoading=!1,this.$goToPayment.hasClass("hidden")&&this.$goToPayment.removeClass("hidden"),this.$orderTab.find(".preloader").removeClass("show"),this.$orderDetails.removeClass("hidden"))},renderOrderDetails:(x=C(regeneratorRuntime.mark((function e(){var t,n,s,r,o,c,d,l,h,u,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.mag.eCommerceManager.getOrder(),this.$orderItems.empty(),this.$orderShippingAddress.empty(),this.$orderShippingMethod.empty(),this.$orderShippingEmail.empty(),this.$orderTax.empty(),this.$orderTotalPrice.empty(),t.items.forEach(function(e){if("tax"===e.type)n=e;else if("shipping"===e.type)s=e;else{var t=(0,a.Z)("<div/>",{class:"order-item"}).html(e.quantity+" × "+e.description),i=(0,a.Z)("<div/>",{class:"order-item-price"}).text((0,m.x)((e.amount/100).toFixed(2),e.currency));t.append(i),this.$orderItems.append(t)}}.bind(this)),t.shipping?(r=function(e){return e?" ".concat(e):""},o=t.shipping.address,c="".concat(o.line1).concat(r(o.line2)," ").concat(o.city,",").concat(r(o.state)).concat(r(o.postal_code)," ").concat(o.country),this.$orderShippingAddress.text(c),this.$tabs.find(".shipping-details").removeClass("hidden")):this.$tabs.find(".shipping-details").addClass("hidden"),!(t.shipping_methods.length>1)){e.next=23;break}return d=this.shippingMethodsOptions(t.shipping_methods),e.next=13,i.e(31).then(i.bind(i,1133));case 13:return l=e.sent,h=l.default,e.next=17,Promise.resolve().then(i.bind(i,345));case 17:u=e.sent,p=u.default,g=p.extend(h),this.shippingMethodSelect?(this.shippingMethodSelect.options=function(){return d},this.shippingMethodSelect.value=s.parent):this.shippingMethodSelect=new g({el:this.$orderShippingMethod.get(0),propsData:{options:function(){return d},value:s.parent,isDesktop:!1,callback:this.onShippingMethodChange}}),e.next=25;break;case 23:this.$orderShippingMethod.parent(".shipping-method.order-row").removeClass("hidden"),this.$orderShippingMethod.text(s.description+" "+(0,m.x)((s.amount/100).toFixed(2),s.currency));case 25:this.$orderDetails.find(".order-id").text(String(t.id).slice(0,20)+"..."),t.email?(this.$orderShippingEmail.text(t.email),this.$orderDetails.find(".shipping-email").removeClass("hidden")):this.$orderDetails.find(".shipping-email").addClass("hidden"),t.phone?(this.$orderDetails.find(".order-shipping-phone").text(t.phone),this.$orderDetails.find(".shipping-phone").removeClass("hidden")):this.$orderDetails.find(".shipping-phone").addClass("hidden"),n&&(this.$orderTax.parent(".shipping-tax-size.order-row").removeClass("hidden"),this.$orderTax.text(n.description+" "+(0,m.x)((n.amount/100).toFixed(2),n.currency))),this.$orderTotalPrice.text((0,m.x)((t.amount/100).toFixed(2),t.currency)),this.$goToPayment.removeClass("hidden");case 31:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),shippingMethodsOptions:function(e){return e.map((function(e){return{value:e.id,caption:e.description+" "+(0,m.x)((e.amount/100).toFixed(2),e.currency)}}))},onShippingMethodChange:function(e){var t=this;this.shippingMethodSelect.value=e,this.showOrderLoader(),this.mag.eCommerceManager.changeShippingMethod(e).then((function(e){t.hideOrderLoader(),e.data&&(t.mag.eCommerceManager.setOrder(e.data),t.renderOrderDetails())})).catch((function(){t.hideOrderLoader()}))},renderOrderError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$orderError.find(".order-error-message").text(e),this.$orderError.removeClass("hidden"),this.$orderDetails.addClass("hidden"),this.$goToPayment.addClass("hidden")},clearOrderError:function(){this.$orderError.addClass("hidden"),this.$orderDetails.removeClass("hidden"),this.$goToPayment.removeClass("hidden")},transformShippingFormToOrderRequest:function(){var e=this.checkShippableInCart(),t={currency:"usd",email:this.shippingForm.email.value,items:[]};return this.shippingForm.note.value&&(t.metadata={note:this.shippingForm.note.value}),e?(t.shipping={name:this.shippingForm.name.value,phone:this.shippingForm.phone.value,address:{line1:this.shippingForm.line1.value,line2:this.shippingForm.line2.value,city:this.shippingForm.city.value,state:this.shippingForm.state.value,country:this.shippingForm.country.value,postal_code:this.shippingForm.postal_code.value}},t):t},generateOrderRequestData:function(){var e=this.mag.eCommerceManager.getCartData();if(!e||!e.skus)return new Error("Empty cart");var t=[],i=this.transformShippingFormToOrderRequest();for(var n in e.skus)e.skus[n].active&&(i.items.push({type:e.skus[n].object,parent:n,currency:e.skus[n].currency,quantity:e.skus[n].cart_count}),-1===t.indexOf(e.skus[n].currency)&&t.push(e.skus[n].currency));return t.length>1?new Error("mixed currencies"):(i.currency=t.pop(),i)},cancelOrder:function(){var e=this;if(this.showPaymentLoader(),this.havePrices){var t=this.mag.eCommerceManager.getCartData();t.invoice&&this.cancelInvoice(t.invoice).then((function(){e.hidePaymentLoader(),e.goToTabByClassname(".tab-items")})).catch((function(){e.hidePaymentLoader()}))}else this.mag.eCommerceManager.cancelOrder().then((function(t){e.hidePaymentLoader(),t.data&&"canceled"===t.data.status&&(e.mag.eCommerceManager.deleteOrder(),e.goToTabByClassname(".tab-items"))})).catch((function(){e.hidePaymentLoader()}))},renderCheckoutFormPaymentIntent:(Z=C(regeneratorRuntime.mark((function e(){var t,i,n,a,s,r,o,c,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.mag.eCommerceManager.getCustomer()){e.next=4;break}return this.$paymentFailed.text("Customer not found"),e.abrupt("return");case 4:return e.next=6,this.getInvoiceForCustomer(t.id);case 6:if(i=e.sent){e.next=10;break}return this.$paymentFailed.text("Invoice not found"),e.abrupt("return");case 10:if(n=this.mag.eCommerceManager.getCartData(),this.showPaymentLoader(),"draft"!==i.status){e.next=27;break}return e.next=15,this.mag.eCommerceManager.finalizeInvoice(this.mag.num_id,i.id);case 15:return a=e.sent,this.mag.eCommerceManager.setInvoice(a),e.next=19,this.mag.eCommerceManager.getPaymentIntent(this.mag.num_id,a.payment_intent);case 19:if((s=e.sent).receipt_email){e.next=23;break}return e.next=23,this.mag.eCommerceManager.updatePaymentIntent(this.mag.num_id,s.id,{receipt_email:n.shippingForm.email.value});case 23:this.clientSecret=s.client_secret,this.hidePaymentLoader(),e.next=36;break;case 27:if("open"!==i.status){e.next=36;break}return e.next=30,this.mag.eCommerceManager.getPaymentIntent(this.mag.num_id,i.payment_intent);case 30:if((r=e.sent).receipt_email){e.next=34;break}return e.next=34,this.mag.eCommerceManager.updatePaymentIntent(this.mag.num_id,r.id,{receipt_email:n.shippingForm.email.value});case 34:this.clientSecret=r.client_secret,this.hidePaymentLoader();case 36:o=this.mag.eCommerceManager.getStripeConnectedUserId(),this.stripe||(this.stripe=Stripe(V,{stripeAccount:o})),c=this.stripe.elements(),this.cardNumber||(this.cardNumber=c.create("cardNumber",{style:this.cardStyle,placeholder:"Card number"}),this.cardNumber.mount("#card-number-element"),this.cardNumber.addEventListener("change",(function(e){var t=d.$paymentTab.find(".card-number-error");e.error?t.removeClass("hidden"):t.addClass("hidden")})),this.cardNumber.addEventListener("ready",(function(e){d.renderCartHolderInput()}))),this.cardExpiry||(this.cardExpiry=c.create("cardExpiry",{style:this.cardStyle,placeholder:"M/Y"}),this.cardExpiry.mount("#card-expiry-element"),this.cardExpiry.addEventListener("change",(function(e){var t=d.$paymentTab.find(".card-expiry-error");e.error?t.removeClass("hidden"):t.addClass("hidden")}))),this.cardCvc||(this.cardCvc=c.create("cardCvc",{style:this.cardStyle,placeholder:"Security code"}),this.cardCvc.mount("#card-cvc-element"),this.cardCvc.addEventListener("change",(function(e){var t=d.$paymentTab.find(".card-cvc-error");e.error?t.removeClass("hidden"):t.addClass("hidden")}))),this.form||(this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",this.onPaymentFormSubmit.bind(this)));case 43:case"end":return e.stop()}}),e,this)}))),function(){return Z.apply(this,arguments)}),renderCheckoutForm:function(){var e=this,t=this.mag.eCommerceManager.getStripeConnectedUserId();this.stripe||(this.stripe=Stripe(V,{stripeAccount:t}));var i=this.stripe.elements();this.cardNumber||(this.cardNumber=i.create("cardNumber",{style:this.cardStyle,placeholder:"Card number"}),this.cardNumber.mount("#card-number-element"),this.cardNumber.addEventListener("change",(function(t){var i=e.$paymentTab.find(".card-number-error");t.error?i.removeClass("hidden"):i.addClass("hidden")})),this.cardNumber.addEventListener("ready",(function(t){e.renderCartHolderInput()}))),this.cardExpiry||(this.cardExpiry=i.create("cardExpiry",{style:this.cardStyle,placeholder:"M/Y"}),this.cardExpiry.mount("#card-expiry-element"),this.cardExpiry.addEventListener("change",(function(t){var i=e.$paymentTab.find(".card-expiry-error");t.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.cardCvc||(this.cardCvc=i.create("cardCvc",{style:this.cardStyle,placeholder:"Security code"}),this.cardCvc.mount("#card-cvc-element"),this.cardCvc.addEventListener("change",(function(t){var i=e.$paymentTab.find(".card-cvc-error");t.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.form||(this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",this.onPaymentFormSubmit.bind(this)))},renderCartHolderInput:function(){this.cardHolderName||(this.cardHolderName=this.$paymentTab.find(".card-name-input"),this.cardHolderName.removeClass("hidden"),this.cardHolderName.on("input",this.onCardHolderNameChange))},onCardHolderNameChange:function(e){this.cardHolderNameValue=e.target.value,this.cardHolderNameValue?this.$paymentTab.find(".card-name-error").hasClass("hidden")||this.$paymentTab.find(".card-name-error").addClass("hidden"):this.$paymentTab.find(".card-name-error").hasClass("hidden")&&this.$paymentTab.find(".card-name-error").removeClass("hidden")},onPaymentFormSubmit:function(e){e.preventDefault(),this.cardHolderNameValue?(this.$paymentTab.find(".card-name-error").addClass("hidden"),this.haveSkus?this.onSkuPaymentFormSubmit():this.havePrices&&this.onPricesPaymentFormSubmit()):this.$paymentTab.find(".card-name-error").removeClass("hidden")},onSkuPaymentFormSubmit:function(){var e=this;this.stripe.createToken(this.cardNumber,{name:this.cardHolderNameValue}).then((function(t){t.error||e.stripeTokenHandler(t.token)}))},onPricesPaymentFormSubmit:function(){var e=this;this.clientSecret?(this.hideErrorPaymentMessage(),this.showPaymentLoader(),this.stripe.confirmCardPayment(this.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.cardHolderNameValue}}}).then((function(t){t.error?(e.hidePaymentLoader(),e.showErrorPaymentMessage("Payment Failed on confirmCardPayment"),e.checkoutCompete=!0):(e.hidePaymentLoader(),"succeeded"===t.paymentIntent.status&&(e.showSuccessPaymentMessage(),RM.analytics&&RM.analytics.sendEvent("Checkout success")),e.checkoutCompete=!0)}))):this.showErrorPaymentMessage("Not client secret")},stripeTokenHandler:function(e,t){var i=this.mag.eCommerceManager.getOrder();if(i){var n=i.email;n?(this.hideErrorPaymentMessage(),this.showPaymentLoader(),a.Z.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/"+i.id+"/pay/",data:JSON.stringify({stripe_token:e.id,email:n}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){this.hidePaymentLoader(),e&&e.data&&("paid"===e.data.status&&(RM.analytics&&RM.analytics.sendEvent("Checkout success"),this.showSuccessPaymentMessage(),"function"==typeof t&&t({status:"success"})),this.checkoutCompete=!0)}.bind(this),error:function(){this.hidePaymentLoader(),this.showErrorPaymentMessage("Payment Failed"),"function"==typeof t&&t({status:"fail"}),this.checkoutCompete=!0}.bind(this)})):this.showErrorPaymentMessage("Email is required")}else this.showErrorPaymentMessage("Order not found")},showPaymentLoader:function(){this.paymentLoading||(this.paymentLoading=!0,this.$paymentTab.find(".preloader").addClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","none"),this.$paymentTab.find(".cart-cancel-btn").css("display","none"))},hidePaymentLoader:function(){this.paymentLoading&&(this.paymentLoading=!1,this.$paymentTab.find(".preloader").removeClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","block"),this.$paymentTab.find(".cart-cancel-btn").css("display","block"))},showErrorPaymentMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$paymentFailed.find(".error-message").text(e),this.$paymentFailed.addClass("show")},hideErrorPaymentMessage:function(){this.$paymentFailed.find(".error-message").empty(),this.$paymentFailed.removeClass("show")},showSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","none"),this.$paymentTab.find(".sidebar-body").css("display","none"),this.$paymentSuccess.addClass("show")},hideSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","block"),this.$paymentTab.find(".sidebar-body").css("display","block"),this.$paymentSuccess.removeClass("show")},toogleSettings:function(){this.isHiddenSettings=!this.isHiddenSettings,this.settingsPanel&&(this.settingsPanel.isHidden=this.isHiddenSettings)},getSettingsData:function(){var e={};if(this.cartWidgetData){var t=n.Z.clone(this.cartWidgetData);e={"bar-color":t["bar-color"],"bar-color-opacity":t["bar-color-opacity"],"bar-background-color":t["bar-background-color"],"bar-background-color-opacity":t["bar-background-color-opacity"],"bar-shadow":t["bar-shadow"],"bar-font-family":t["bar-font-family"],"bar-font-style":t["bar-font-style"],"bar-font-weight":t["bar-font-weight"],"bar-letter-spacing":t["bar-letter-spacing"]}}return{isHidden:this.isHiddenSettings,model:e,onOverlayClick:this.onSettingsOverlayClick.bind(this)}},setupSettingsPanel:function(){},onSettingsOverlayClick:function(){this.toogleSettings()},onModelChange:function(e){this.saveModelChanges_debounced(e)},saveModelChanges:function(e){var t=this;this.updateCartWidgetData(e),this.generateSidebarCSS(this.cartWidgetData),this.cartWidgetModel&&this.cartWidgetModel.save(e,{toHistory:!1,skipHistory:!0,patch:!0}).then((function(){t.renderSidebarTexts()}))},updateCartWidgetData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.cartWidgetData=k(k({},this.cartWidgetData),e)},checkShippableInCart:function(){var e=this.mag.eCommerceManager.getCartData();for(var t in e.skus)if(e.skus[t].productObject.shippable)return!0;return!1},destroy:function(){var e=this;if(this.rendered)return this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.mag.eCommerceManager.events.off("ecommerce:cartsidebar:visibility:changed"),this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed"),this.form&&this.form.removeEventListener("submit",this.onPaymentFormSubmit),this.cardHolderName&&this.cardHolderName.off("input",this.onCardHolderNameChange),this.$tabs.find("[data-tab^='tab-']").each((function(e,t){(0,a.Z)(t).off("click")})),this.$items.find(".cart-item-remove-btn").each((function(e,t){(0,a.Z)(t).off("click")})),this.$tabs.find(".order-details-form .form-input").each((function(t,i){(0,a.Z)(i).off("input",e.onShippingFormChange)})),this.unbindDomEvents(),this.settingsPanel&&(this.settingsPanel.$off("change",this.onModelChange),this.settingsPanel.$destroy()),this.$settingButton&&this.$settingButton.off("click",this.toogleSettings),this.environment===g.ZP.environment.preview&&this.unbindTextInputsEvents(),this.remove()},cartItemBlockHover:function(e){var t=(0,a.Z)(e.currentTarget);t&&t.length&&(t.addClass("hover").siblings().removeClass("hover"),this.hoveredItem=t.data("price-id")||t.data("sku-id"))},cartItemBlockLeave:function(e){var t=(0,a.Z)(e.currentTarget);t&&t.length&&(t.removeClass("hover"),(t.data("price-id")||t.data("sku-id"))===this.hoveredItem&&(this.hoveredItem=null))}});t.Z=B},1069:function(e,t,i){"use strict";var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(1070),c=i(324),d=i(348),l=i(343),h=s().View.extend({template:o.Z["template-viewer-mag-menu"],events:{"click .page":"onPageClick"},initialize:function(e){return r.Z.bindAll(this),r.Z.extend(this,e),this.IMG_STUB=(0,d.findImagePath)("./spacer.gif"),c.Z.isPhone?"horizontal"===this.viewerType?(this.PAGE_WIDTH=140,this.PAGE_HEIGHT=92):(this.PAGE_WIDTH=240,this.PAGE_HEIGHT=158):(this.PAGE_WIDTH="vertical"===this.viewerType?240:280,this.PAGE_HEIGHT="vertical"===this.viewerType?158:184),this.loadVisibleScreenshots.__debounced=r.Z.debounce(this.loadVisibleScreenshots,500),this.unloadInvisibleScreenshots.__debounced=r.Z.debounce(this.unloadInvisibleScreenshots,3e3),this},render:function(){this.setElement(this.template({mag:this.mag,pages:this.pages,width:this.PAGE_WIDTH,height:this.PAGE_HEIGHT,stub:this.IMG_STUB,viewerType:this.viewerType,publishDate:this.publishDate,hasProjectInfo:this.hasProjectInfo,common:RM.common})),this.$el.appendTo(this.$container),this.$pagesWrapper=this.$(".pages-wrapper");var e=this.$(".page");if("horizontal"==this.viewerType?(this.$(".pages").css("width",e.length*this.PAGE_WIDTH),this.$pagesWrapper.scrollLeft(99999)):(this.$(".pages").css("height",e.length*this.PAGE_HEIGHT),this.$pagesWrapper.scrollTop(99999)),c.Z.isDesktop&&(this.scroll=this.$(".scroll-wrapper").RMScroll({$container:this.$pagesWrapper,$content:this.$(".pages"),$handle:this.$(".scroll"),wheelScrollSpeed:1.3,gap_start:8,gap_end:8,maxHandleSize:136,dragScroll:!0,tp:this.viewerType}).data("scroll")),this.$pagesWrapper.bind("scroll",this.onScroll),this.cacheSize(),this.cacheScroll(),this.cachePagesPos(),this.loadedScreenshots={},this.showInitially&&(this.loadVisibleScreenshots(),this.show(!0)),"horizontal"==this.viewerType&&c.Z.isPhone||(0,n.Z)(".menu-info .mag-title").dotdotdot({height:c.Z.isPhone?48:68,wrap:"letter",callback:r.Z.bind((function(e,t){e&&this.$(".menu-info .mag-title").attr("title",this.mag.title)}),this)}),!c.Z.isDesktop){var t="horizontal"==this.viewerType?this.$el.height():this.$el.width(),i=this.$el.add(this.$toolbar);"horizontal"==this.viewerType&&this.mag.navigation&&(i=i.add(this.mag.navigation.$bottom)),this.menuSwipe=i.RMSwipe({$scrollElements:this.$pagesWrapper,minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,getCurrentConstraints:r.Z.bind((function(){var e={};return e.$referenceItem=this.$el,e="horizontal"==this.viewerType?this.shown?{up:{max:0,noTrigger:!0},down:{max:t}}:{up:{max:t},down:{max:0,noTrigger:!0}}:this.shown?{left:{max:0,noTrigger:!0},right:{max:t}}:{left:{max:t},right:{max:0,noTrigger:!0}}}),this),callback:r.Z.bind((function(e){this.shown?this.hide():this.show()}),this)}).data("swipe")}return this.isPreview&&this.listenTo(RM.constructorRouter,"renewScreenshot",this.renewScreenshot),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+n.Z.keycodes.m,this.toggle),this.listenTo(this.mag,"keypress-"+n.Z.keycodes.esc,this.hide),l.Z.on("constructorSettings:open",this.show),l.Z.on("constructorSettings:close",this.hide),(0,n.Z)(window).on("resize",this.onResize),this.$el.bind("mousewheel",this.onMouseWheel),this},show:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.shown||(this.shown=!0,t&&this.$el.css({transition:"none"}),this.mag.$el.addClass("viewer-mag-menu-shown"),(0,n.Z)("html").addClass("mag-menu-shown"),this.mag.$el.toggleClass("viewer-mag-menu-no-project-info",!this.hasProjectInfo),this.loadOtherScreenshots(),this.mag.trigger("menuShown"),l.Z.trigger("magMenu:open"),t&&setTimeout((function(){return e.$el.css({transition:""})}))),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.mag.$el.removeClass("viewer-mag-menu-shown viewer-mag-menu-no-project-info"),(0,n.Z)("html").removeClass("mag-menu-shown"),this.clearLoadOtherTimeout(),this.mag.focusCurrentPage(),this.shown=!1,this.mag.trigger("menuHidden"),l.Z.trigger("magMenu:close")),this},destroy:function(){return(0,n.Z)(window).off("resize",this.onResize),(0,n.Z)("html").removeClass("mag-menu-shown"),l.Z.trigger("magMenu:close"),this.$el.unbind("mousewheel",this.onMouseWheel),this.menuSwipe&&this.menuSwipe.destroy(),this.$pagesWrapper.unbind("scroll",this.onScroll),l.Z.off("constructorSettings:open",this.show),l.Z.off("constructorSettings:close",this.hide),this.remove()},onMouseWheel:function(e){e.preventDefault()},onResize:function(){this.cacheSize(),this.scroll&&this.scroll.recalc(),this.mag.currentPage&&this.shiftToPage(this.mag.currentPage.num,!1)},onScroll:function(){this.cacheScroll()},cacheSize:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollSize="horizontal"==this.viewerType?this.$pagesWrapper.width():this.$pagesWrapper.height()},cacheScroll:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollPos="horizontal"==this.viewerType?this.$pagesWrapper.scrollLeft():this.$pagesWrapper.scrollTop()},cachePagesPos:function(){this.cachedData=this.cachedData||{},this.cachedData.pagesPos={};var e=this.cachedData.pagesPos,t=this.viewerType,i=this.PAGE_WIDTH,n=this.PAGE_HEIGHT;r.Z.each(this.pages,(function(a,s){e[a.num]=s*("horizontal"==t?i:n)}))},onPageChange:function(e,t){this.shown||(this.loadVisibleScreenshots.__debounced(),!c.Z.isDesktop&&this.unloadInvisibleScreenshots.__debounced()),this.shiftToPage(e.num,this.shown),r.Z.isEmpty(this.loadedScreenshots)&&this.loadVisibleScreenshots()},shiftToPage:function(e,t){var i,n=this.$('.page[data-num="'+e+'"]'),a=this.cachedData.scrollSize,s=this.cachedData.scrollPos,r="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT,o=this.cachedData.pagesPos[e],c=s+r/2,d=s+a-r/2;if(this.$(".page.active").removeClass("active"),n.addClass("active"),o<c)i=o-c;else{if(!(o+r>d))return;i=o+r-d}var l={};l["horizontal"==this.viewerType?"scrollLeft":"scrollTop"]=s+i,this.$pagesWrapper.stop().animate(l,t?300:0)},onPageClick:function(e){if(!this.scroll||!this.scroll.wasContentDrag){var t=(0,n.Z)(e.currentTarget).data("num");this.mag.currentPage&&t==this.mag.currentPage.num||this.mag.showPage(t,{animation:!1})}},renewScreenshot:function(e){var t=this.$(".page").filter((function(){return(0,n.Z)(this).data("id")==e})),i=RM.constructorRouter.mag.pages.find((function(t){return t.id==e})),a=i&&i.getScreenshot(this.PAGE_WIDTH);t.attr("data-src")?t.attr("data-src",a):t.find(".screenshot").prop("src",a)},getVisibleScreenshotRange:function(){var e=this.cachedData.scrollSize,t=this.cachedData.scrollPos,i="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT;return{min:Math.max(0,Math.floor(t/i)),max:Math.min(this.mag.getPagesCount()-1,Math.floor((t+e)/i))}},loadVisibleScreenshots:function(){if(this.mag.pages&&this.mag.pages.length){var e=this.getVisibleScreenshotRange(),t=this;this.$(".page").each((function(i){var a,s=(a=(0,n.Z)(this)).attr("data-src");i>=e.min&&i<=e.max&&s&&!t.loadedScreenshots[i]&&((a=(0,n.Z)(this)).find(".screenshot").prop("src",s),a.removeAttr("data-src"),t.loadedScreenshots[i]=!0)}))}},unloadInvisibleScreenshots:function(){if(!this.shown){var e=this.getVisibleScreenshotRange(),t=this;this.$(".page").each((function(i){var a,s=(a=(0,n.Z)(this)).attr("data-src");(i<e.min||i>e.max)&&!s&&t.loadedScreenshots[i]&&((a=(0,n.Z)(this)).attr("data-src",a.find(".screenshot").prop("src")),a.find(".screenshot").prop("src",t.IMG_STUB),delete t.loadedScreenshots[i])}))}},loadOtherScreenshots:function(){this.clearLoadOtherTimeout(),this.loadOtherSafeTimeout=500,this.loadNextScreenshot()},loadNextScreenshot:function(){var e,t,i,n=this.getVisibleScreenshotRange(),a=Math.floor((n.min+n.max)/2),s=this.loadedScreenshots,r=this.mag.getPagesCount()-1;for(e=a;e<=r&&s[e];e++);for(t=a;t>=0&&s[t];t--);if(!(t<0&&e>r)){s[i=e>r?t:t<0?e:e-a>a-t?t:e]=!0;var o=this.$(".page").eq(i),c=o.find(".screenshot"),d=this;c.one("load error",(function(e){clearTimeout(d.$curLoadingTimeout),d.loadNextScreenshot()})),this.$curLoadingTimeout=setTimeout((function(){c.off(),d.loadOtherSafeTimeout*=1.1,d.loadNextScreenshot()}),this.loadOtherSafeTimeout),c.prop("src",o.attr("data-src")),o.removeAttr("data-src"),this.$curLoadingScreenshot=c}},clearLoadOtherTimeout:function(){this.$curLoadingScreenshot&&this.$curLoadingScreenshot.off(),clearTimeout(this.$curLoadingTimeout)}});t.Z=h},1050:function(e,t,i){"use strict";i.r(t);var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(1051),c=i(347),d=i(341),l=i(308),h=i(349),u=i(342),p=i(854),g=i(722),m=i(723),v=i(697),f=i(1052),b=i(344),w=i(1055),y=i(1054),P=i(714),C=i.n(P),S=i(324),k=i(309),T=i(873),Z=i(1057),x=i(1062),$=i(1063),O=i(1065),M=i(1071),_=i(348),I=i(1028),E=i.n(I),D=i(728);function F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?F(Object(i),!0).forEach((function(t){A(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function A(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var W=s().View.extend({TYPEKIT_PREVIEW_API_LINK:"//use.typekit.net/previewkits/pk-v1.js",PRELOAD_COUNT_HORIZONTAL:{backward:(0,k._)("viewer.turnOffHorizontalPreload")?0:1,forward:(0,k._)("viewer.turnOffHorizontalPreload")?0:S.Z.isDesktop?5:S.Z.isPhone?3:2},PRELOAD_COUNT_VERTICAL:{backward:S.Z.isDesktop?2e3:(S.Z.isPhone,1e3),forward:S.Z.isDesktop?3e3:(S.Z.isPhone,2e3)},SCROLLABLE_TRESHOLD:100,SCROLL_SNAP:0,template:o.Z["template-viewer-mag"],initialize:function(e,t){var i=this;r.Z.bindAll(this),e||(e={}),r.Z.defaults(e,{pages:[]}),this.hasWidgetsWithVerticalOnscrollAnimation=!1;var a=(0,r.Z)(e.pages).chain().reduce((function(e,t){return e.concat(t.wids||[])}),[]).each((function(e){m.Z.normalizeAnimations(e.animation).find((function(e){return"scroll"===e.type&&e.steps&&e.steps.find((function(e){return e.dy}))}))&&(i.hasWidgetsWithVerticalOnscrollAnimation=!0)})).filter({is_global:!0}).value();this.staticGlobalWidgetsData=(0,r.Z)(a).filter((function(e){return!e.is_above})),this.aboveGlobalWidgetsData=(0,r.Z)(a).filter((function(e){return e.is_above}));var s=r.Z.pluck(this.aboveGlobalWidgetsData,"_id");return e.pages.forEach((function(e){e.pagePath=e.pagePath||e.uri||e.num.toString()})),e.pages.forEach((function(e){e.uri=e.pagePath})),(0,r.Z)(e.pages).each(function(e){e.wids=(e.wids||[]).concat(r.Z.reject(this.staticGlobalWidgetsData,(function(t){return t.pid===e._id}))),e.wids=r.Z.unique(e.wids,(function(e){return e._id||Math.random()})),e.wids=(0,r.Z)(e.wids).filter((function(e){return!r.Z.contains(s,e._id)}))}.bind(this)),r.Z.extend(this,e),this.model=new c.w(e,{parse:!0}),this.router=t,this.eCommerceManager=new T.ZP(this.router,this,this.router.environment),this.setupEcommerceSidebar(),this.isPreview=t.isPreview,this.$container=t.$mags_container||(0,n.Z)("#root"),S.Z.isDesktop&&(0,n.Z)("<div>").bind("mousewheel",(function(){})),this.setViewerOptions(this.getMagViewport()),this.continueLoading.__debounced=r.Z.debounce(this.continueLoading,200),this.loadPages.__debounced=r.Z.debounce(this.loadPages,700),this.onResize.__debounced=r.Z.debounce(this.onResize,300),this.redrawAboveGlobalWidgets.__debounced=r.Z.debounce(this.redrawAboveGlobalWidgets,500,!0),this.widgetPackCount=0,this.getAboveGlobalBoxMemoized=r.Z.memoize(this.getAboveGlobalBox,(function(e,t,i){return e+" "+(t&&t.num)+" "+(t&&t.pageViewport)+" "+(i&&i.width)+" "+(i&&i.height)})),this},setViewerOptions:function(e){var t={arrows:!0,menubutton:!0,projectinfo:!0,sharebutton:!0,pagecounter:!0,controlsontop:!1,viewertype:"vertical",slidein:!1,scalewidth:3600,lqip:!1};(t=r.Z.extend(t,this.model.get("opts"))).viewertype=RM.screenshot?"horizontal":t.viewertype,(!S.Z.isDesktop||this.isPreview&&"default"!==e)&&(t.slidein=!1),"vertical"===t.viewertype&&(S.Z.isDesktop?this.isStickyVerticalViewer=!t.slidein&&!this.isPreview&&!this.hasWidgetsWithVerticalOnscrollAnimation:(this.isStickyVerticalViewer=Modernizr.csspositionsticky,this.isStickyVerticalViewer||(t.viewertype="horizontal",this.pages.length>1&&(t.arrows=!0)))),t.sharebutton=t.sharebutton&&!this.isPreview&&!!this.published&&!this.is_private,t.pagecounter=t.pagecounter&&!this.isPreview&&this.pages.length>1,t.branding=(r.Z.isUndefined(t.branding)?t.endpage:t.branding)&&!this.isPreview,this.model.user&&this.model.user.get&&"540dc7a3a5c9259a383b910b"==this.model.user.get("_id")&&(t=r.Z.extend(t,{arrows:!0,menubutton:this.isPreview,sharebutton:!1,pagecounter:!1,branding:!1})),this.viewOpts=t,this.PRELOAD_COUNT="horizontal"==this.viewOpts.viewertype?this.PRELOAD_COUNT_HORIZONTAL:this.PRELOAD_COUNT_VERTICAL},setViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").addClass("viewer-type-"+this.viewOpts.viewertype).removeClass("pages-pos-normal pages-pos-overlap").addClass("pages-pos-"+(this.viewOpts.slidein?"overlap":"normal")),"vertical"==this.viewOpts.viewertype&&((0,n.Z)("html").addClass("overflow-on-vertical-view"),this.isStickyVerticalViewer&&(this.$el.addClass("viewer-type-vertical-sticky"),(0,n.Z)("body").addClass("overflow-on-vertical-view"))),this.viewOpts.controlsontop&&(0,n.Z)("html").addClass("controls-on-top"),(0,n.Z)("html").addClass("new-settings")},unsetViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").removeClass("pages-pos-normal pages-pos-overlap"),"vertical"==this.viewOpts.viewertype&&((0,n.Z)("html").removeClass("overflow-on-vertical-view"),this.$magScrollSizer.css("height",""),this.isStickyVerticalViewer&&(this.$el.removeClass("viewer-type-vertical-sticky"),(0,n.Z)("body").removeClass("overflow-on-vertical-view"))),(0,n.Z)("html").removeClass("controls-on-top")},render:function(){if(!this.active){this.title=this.title||"Project",this.magOpenTime=new Date,document.documentElement.style.setProperty("--min-desktop-width","".concat(b.ZP.dictionary[b.sJ.Default].min_scale_width,"px")),this.setElement(this.template({hasStandaloneBottomArrow:!this.isPreview&&"vertical"==this.viewOpts.viewertype&&this.viewOpts.arrows,isPreview:!!this.isPreview,icons:{sprite:(0,_.findImagePath)("./common/navigation/sprite".concat(_.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.setViewerClasses(),(0,n.Z)("body").on("click","a.external-link",this.toExternalLink).on("click",".maglink.back-to-top",this.backToTopCurrentPage).on("click",".maglink",this.maglink).on("click",".goback-link",this.onGobackLinkClick).on("click",".mailchimp-link",this.onMailchimpLinkClick).on("click",".anchor-link",this.onAnchorLinkClick).on("click",".share-link",this.onShareLinkClick),this.$mag_container=this.$(".mag-pages-container"),this.$mag_container.on("scroll",this.fixFocusScroll),this.$mag_viewport_device=this.$(".mag-pages-viewport-device"),this.$pages_container=this.$(".mag-pages-container .container"),this.$pages_blackout=this.$pages_container.find(".blackout"),this.$aboveWidgetsContainer=this.$(".above-pages-container"),"vertical"==this.viewOpts.viewertype&&(this.$magScrollContainer=(0,n.Z)(window),this.$magScrollSizer=(0,n.Z)("body"),this.isStickyVerticalViewer&&(this.$magScrollSizer=(0,n.Z)("body").add(this.$el)),this.$magScrollHandler=(0,n.Z)(window),this.$magScrollAnimate=(0,n.Z)("body, html")),"vertical"==this.viewOpts.viewertype&&(this.$bottomArrow=this.$(".navigation-arrow.bottom"),this.$bottomArrow.one("click",this.scrollMagALittle)),this.active=!0;var e=this.pages;this.pages=null,this.viewport=null,this.switchToViewport(this.getMagViewport()),this.onResize(),S.Z.isDesktop||setTimeout(this.onResize,1500),this.pages=(0,r.Z)(e).chain().sortBy((function(e){return e.num})).map(r.Z.bind((function(t){var i="";try{i=new f.Z({mag:this,router:this.router,totalPages:e.length,pageData:t,viewerType:this.viewOpts.viewertype,isStickyVerticalViewer:this.isStickyVerticalViewer,$container:this.$pages_container,viewOpts:this.viewOpts}).render()}catch(e){console.log("Error page rendering.",e)}return i}),this)).filter((function(e){return!!e})).value();var t=this.getPage(this.getPagesCount());if(t&&t.markAsLast(),"horizontal"==this.viewOpts.viewertype&&this.setPagesTransitions(),!RM.screenshot){"horizontal"==this.viewOpts.viewertype&&this.viewOpts.arrows&&(this.navigation=new $.Z({mag:this,router:this.router,$container:this.$el,isPreview:this.isPreview,viewerType:this.viewOpts.viewertype}).render());var i=(this.must_show_branding||this.viewOpts.branding)&&!(RM.common.embedMode&&!S.Z.isDesktop),a=i&&S.Z.isDesktop&&!this.viewOpts.controlsontop&&!this.isPreview;this.toolbar=new O.Z({mag:this,pages:this.pages,router:this.router,$container:this.$el,isPreview:this.isPreview,hasMenu:this.viewOpts.menubutton,hasProjectInfo:this.viewOpts.projectinfo,hasShare:this.viewOpts.sharebutton&&!l.ZP.IS_FILE_PROTOCOL,hasPageCounter:this.viewOpts.pagecounter,controlsOnTop:this.viewOpts.controlsontop,brandingInToolbar:a,viewerType:this.viewOpts.viewertype,publishDate:this.published?C()(new Date(this.published),"mmm dd, yyyy"):"unpublished",isSettingsOpened:this.isSettingsOpened}).render(),i&&(this.branding=new M.Z({mag:this,$container:a?this.toolbar.$el.find(".toolbar-branding"):this.$el}).render())}"vertical"==this.viewOpts.viewertype&&(this.onResize(),S.Z.isDesktop&&this.getPage(1)&&this.getPage(1).$content.focus(),(0,n.Z)("body").on("keydown",this.onVerticalViewKeyDown)),S.Z.isDesktop?((0,n.Z)(window).on("mousedown",this.onMouseDown),(0,n.Z)(window).on("mouseup",this.onMouseUp),(0,n.Z)(window).on("mousewheel",this.onMouseWheel)):((0,n.Z)(window).on("touchstart",this.onDragStart),(0,n.Z)(window).on("touchmove",this.onDragMove),(0,n.Z)(window).on("touchend touchcancel",this.onDragEnd),(0,n.Z)(window).on("pageshow",this.onResize)),d.default.PageVisibilityManager.addEventListener(this.onPageVisibilityChange),this.listenTo(s(),"form:focus",this.onFormFocus),this.listenTo(s(),"form:blur",this.onFormBlur),(0,n.Z)(window).on("resize",this.onResize),this.isPreview&&this.listenTo(this.model,"change:opts",this.onOptsChange),S.Z.isDesktop||(0,n.Z)(window).on("orientationchange",this.onResize),(0,n.Z)(window).on("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.on("scroll",this.onMagScroll),(0,n.Z)("body").on("keyup",this.onKeyup),h.Z.generateCSS("paragraph","viewer",document,this.edit_params&&this.edit_params.paragraph_styles),h.Z.generateCSS("link","viewer",document,this.edit_params&&this.edit_params.link_styles),RM.screenshot&&"true"==d.default.queryUrlGetParam("pdf")||this.isPreview||h.Z.setShortList(h.Z.getVeryShortList(this.edit_params&&this.edit_params.fonts));var o=!this.isPreview&&this.model.get("is_published")?"published":"edit",c=this;return"edit"!=o||window.TypekitPreview?u():n.Z.getScript(this.TYPEKIT_PREVIEW_API_LINK,(function(e,t,i){u()})),this}function u(){h.Z.appendFontsCssToDocument({version:o,fonts:c.edit_params&&c.edit_params.fonts,typekit_url:c.typekit_url})}},destroy:function(){var e=this;return r.Z.each(this.pages,(function(e){e.destroy()})),this.pages=null,(0,n.Z)("body").off("click","a.external-link",this.toExternalLink).off("click",".maglink.back-to-top",this.backToTopCurrentPage).off("click",".maglink",this.maglink).off("click",".goback-link",this.onGobackLinkClick).off("click",".mailchimp-link",this.onMailchimpLinkClick).off("click",".anchor-link",this.onAnchorLinkClick).off("keydown",this.onVerticalViewKeyDown).off("click",".share-link",this.onShareLinkClick),this.toolbar&&this.toolbar.destroy(),this.navigation&&this.navigation.destroy(),this.cartSidebar&&setTimeout((function(){e.cartSidebar.destroy()}),320),S.Z.isDesktop?((0,n.Z)(window).off("mousedown",this.onMouseDown),(0,n.Z)(window).off("mouseup",this.onMouseUp),(0,n.Z)(window).off("mousewheel",this.onMouseWheel)):((0,n.Z)(window).off("touchstart",this.onDragStart),(0,n.Z)(window).off("touchmove",this.onDragMove),(0,n.Z)(window).off("touchend touchcancel",this.onDragEnd),(0,n.Z)(window).off("pageshow")),this.unsetViewerClasses(),d.default.PageVisibilityManager.removeEventListener(this.onPageVisibilityChange),(0,n.Z)(window).off("resize",this.onResize),(0,n.Z)(window).off("orientationchange",this.onResize),(0,n.Z)(window).off("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.off("scroll",this.onMagScroll),(0,n.Z)("body").off("keyup",this.onKeyup),this.active=!1,this.trigger("destroyed"),this.remove()},getUrl:function(){return RM.common.isDomainViewer?window.location.protocol+"//"+window.location.hostname+"/"+(RM.common.customDomainProfile?this.num_id+"/":""):window.location.protocol+"//"+window.location.hostname+"/"+this.num_id+"/"},getPage:function(e){return parseInt(e,10)==e&&(e=parseInt(e,10)),r.Z.isNumber(e)?this.pages[e-1]:(0,r.Z)(this.pages).find((function(t){return t.uri==e}))},getPageByPath:function(e){return"1"===e.toString()?this.pages[0]:this.pages.find((function(t){return t.pagePath===e}))},getPagesCount:function(){return this.pages&&this.pages.length},isFirstPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num-1)},isLastPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num+1)},getPageId:function(e){var t=r.Z.find(this.pages,(function(t){return t.num_id===e}));return t&&t._id},getPageNum:function(e){var t=r.Z.find(this.pages,(function(t){return t._id==e}));return t&&t.num},getPageUri:function(e){var t=r.Z.find(this.pages,(function(t){return t._id==e}));if(!t)return null;var i=t.uri?t.uri+"/":1==t.num?"":t.num+"/";return this.router.getMagUri(this)+i},getPageTransitionTime:function(){var e=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),t=this.getContainerSizeCached().height;return S.Z.isDesktop?550:S.Z.isTablet?e>t?550:470:e>t?520:370},onPageVisibilityChange:function(){var e=this;if(this.currentPage)if(clearTimeout(this.visibilityHandlerTimeout),d.default.PageVisibilityManager.isPageHidden())this.visibilityHandlerTimeout=setTimeout((function(){e.currentPage.stop({widgetTypes:["video","background","iframe"]});var t=e.getPage(e.currentPage.num+1);t&&t.started&&(t.stop({widgetTypes:["video","background","iframe"]}),e.restartNextPage=!0)}),700);else{this.currentPage.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0});var t=this.getPage(this.currentPage.num+1);t&&this.restartNextPage&&(t.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0}),delete this.restartNextPage)}},updateArrowsColor:function(e){if(e){var t=e.arrows_color||"white";this.$el.removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+t+"-arrows")}},onFormFocus:function(){if(Modernizr.safari&&!S.Z.isDesktop&&"vertical"===this.viewOpts.viewertype){var e=this.getScroll();r.Z.each(this.pages,(function(t){t.trigger("form:focus",e)})),this.$magScrollContainer&&this.$magScrollContainer.on("scroll",this.onScrollWithFormInFocus)}},onFormBlur:function(){(Modernizr.safari||!S.Z.isDesktop)&&"vertical"===this.viewOpts.viewertype&&(r.Z.each(this.pages,(function(e){e.trigger("form:blur")})),this.$magScrollContainer&&this.$magScrollContainer.off("scroll",this.onScrollWithFormInFocus))},onScrollWithFormInFocus:function(){if((Modernizr.safari||!S.Z.isDesktop)&&"vertical"===this.viewOpts.viewertype){var e=this.getScroll();r.Z.each(this.pages,(function(t){t.trigger("page:scrollWithFormInFocus",e)}))}},onDragStart:function(e){clearTimeout(this.touchInProgressTimeout),this.pauseLoading("touch");var t=e.originalEvent.targetTouches[0];this.globalTouchObject={$target:(0,n.Z)(e.target).closest(".has-horizontal-scroll, .has-vertical-scroll"),x:t.screenX,y:t.screenY,startTime:+new Date}},onDragMove:function(e){var t=this.globalTouchObject;if(!(e.originalEvent.touches.length>1)&&t){if("horizontal"==this.viewOpts.viewertype)this.currentPage&&this.currentPage.hasFixedWidgets&&(0,n.Z)(e.target).closest(this.$mag_container).length&&!t.$target.length&&(t.$target=this.currentPage.$scrollWrapper);else t.$target.length||(t.$target=this.$magScrollContainer);if(t.$target.length){if(!d.default.isPageNativelyScaled()){var i=e.originalEvent.targetTouches[0],a=(i.screenX,t.x,i.screenY-t.y);if(Math.abs(a)>5&&t.$target.hasClass("has-vertical-scroll")){var s=t.$target[0].scrollHeight,r=t.$target.outerHeight();a>0&&t.$target.scrollTop()<=0&&e.preventDefault(),a<0&&t.$target.scrollTop()>=s-r&&e.preventDefault()}t.$target.hasClass("has-horizontal-scroll")}}else e.preventDefault()}},onDragEnd:function(e){this.checkDoubleTap(e),this.touchInProgressTimeout=setTimeout(r.Z.bind((function(){this.continueLoading("touch")}),this),400);var t=this.globalTouchObject;if(t){var i=e.originalEvent.changedTouches[0],a=i.screenX-t.x,s=i.screenY-t.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(a)<3&&Math.abs(s)<3&&+new Date-t.startTime<500&&!d.default.isPageNativelyScaled()&&(0,n.Z)(e.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalTouchObject},checkDoubleTap:function(e){if(!(e.originalEvent.touches.length>0)){var t=+new Date,i=t-(this.lastTouchEndTime||t+1);if(this.lastTouchEndTime=t,i<500&&i>0&&d.default.isPageNativelyScaled()){var a=(0,n.Z)('meta[name="viewport"]');if(a.length){var s=a.attr("content"),o=s.replace(/maximum\-scale\=[0-9\.]*/,"maximum-scale=1.0");if(a.attr("content",o),Modernizr.android){var c=(0,n.Z)("<div>").appendTo("body");r.Z.delay((function(){c.remove()}),500),setTimeout(r.Z.bind((function(){a.attr("content",s);var e=(0,n.Z)("<div>").appendTo("body");r.Z.delay((function(){e.remove()}),500)}),this),1e3)}else a.attr("content",s);this.lastTouchEndTime=0,r.Z.delay((function(){(0,n.Z)(window).trigger("gesturechange")}),300),r.Z.delay((function(){(0,n.Z)(window).trigger("gesturechange")}),1e3)}}}},onMouseDown:function(e){this.globalMouseObject={x:e.screenX,y:e.screenY,startTime:+new Date}},onMouseUp:function(e){var t=this.globalMouseObject;if(t){var i=e.screenX-t.x,a=e.screenY-t.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(i)<3&&Math.abs(a)<3&&+new Date-t.startTime<500&&(0,n.Z)(e.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalMouseObject},onMouseWheel:function(e){e.originalEvent.deltaX<0&&Math.abs(e.originalEvent.deltaY)<2&&e.cancelable&&e.preventDefault()},onKeyup:function(e){var t;if("input"!=e.target.tagName.toLowerCase()&&("textarea"!=e.target.tagName.toLowerCase()||"copyhack"==e.target.className)&&r.Z.isEmpty(RM.common.disableShortcuts)&&!this.isInPresentationMode){var i=String.fromCharCode(e.keyCode),a=null===(t=this.currentPage.viewport_tablet_portrait)||void 0===t?void 0:t.enabled,s="1"===i?b.ZP.viewports[0]:"2"===i&&a?b.ZP.viewports[1]:"2"===i&&!a||"3"===i&&a?b.ZP.viewports[2]:void 0;s&&this.isPreview&&this.switchToViewport(s.name);r.Z.find(n.Z.keycodes,(function(t,i){var a=n.Z.keycodes[i]===e.keyCode;return a&&i,a}))&&this.trigger("keypress-"+e.keyCode,e)}},onKeydown:function(e){if("input"!=e.target.tagName.toLowerCase()&&("textarea"!=e.target.tagName.toLowerCase()||"copyhack"==e.target.className)&&r.Z.isEmpty(RM.common.disableShortcuts)&&this.isInPresentationMode&&!(e.altKey||e.ctrlKey||e.metaKey))switch(e.which){case 8:case 33:case 80:case 37:case 72:case 38:case 75:e.preventDefault(),this.goPrevPage({animation:!0});break;case 13:case 34:case 78:case 39:case 76:case 40:case 74:e.preventDefault(),this.goNextPage({animation:!0});break;case 36:e.preventDefault(),this.goFirstPage();break;case 35:e.preventDefault(),this.goLastPage();break;case 9:case 32:e.preventDefault(),e.shiftKey?this.goPrevPage({animation:!0}):this.goNextPage({animation:!0});break;case 77:e.preventDefault(),this.trigger("keypress-"+e.keyCode,e)}},onVerticalViewKeyDown:function(e){var t;if(!this.isInPresentationMode&&"vertical"===this.viewOpts.viewertype&&(e.which===n.Z.keycodes.down||e.which===n.Z.keycodes.up)){if(e.preventDefault(),this.arrowKeyLastScrollAt&&new Date-this.arrowKeyLastScrollAt<400)return;var i=e.which===n.Z.keycodes.down;this.arrowKeyLastScrollAt=+new Date;var a,s,o=window.innerHeight,c=this.getScroll(),d=this.getScrollPosition(),l=Math.round(o/4),h=function(e){return e&&e<=l},u=r.Z.bind((function(){var e=this.magPagesPos[this.currentPage.num];return Math.abs(c-e.y)}),this),p=this.currentPage.pageHeight,g=0===d&&!this.isFirstPage();if(i)h(a=p-d-o)?s=p-d:s=(t=a)>l&&t<o?a:o,g&&this.viewOpts.slidein&&(s+=u());else{if(g){var m=this.magPagesPos[this.currentPage.num-1];d=m?m.h:0}s=h(a=d-o)||d<o?-d:-o,g&&this.viewOpts.slidein&&(s-=this.SCROLL_SNAP-u())}this.setScrollPosition({delta:s,animate:!0})}},togglePresentationMode:function(e){!!this.isInPresentationMode!=e&&S.Z.isDesktop&&(this.isPreview||(e?((0,n.Z)("body").on("keydown",this.onKeydown),this.trigger("presentationModeOn")):((0,n.Z)("body").off("keydown",this.onKeydown),this.trigger("presentationModeOff")),this.isInPresentationMode=e))},recalcBottomArrowState:function(e){this.currentPage&&e===this.currentPage&&this.navigation&&this.navigation.recalcBottomArrowState(e)},setScrollPosition:function(e){var t;this.currentPage&&("vertical"==this.viewOpts.viewertype?(t=void 0!==e.offset?this.magPagesPos[this.currentPage.num].y+e.offset:this.getScroll()+e.delta,e.animate?this.$magScrollAnimate.animate({scrollTop:t},500):this.setScroll(t)):(t=void 0!==e.offset?e.offset:this.currentPage.$scrollWrapper.scrollTop()+e.delta,e.animate?this.currentPage.$scrollWrapper.animate({scrollTop:t},500):this.currentPage.$scrollWrapper.scrollTop(t)))},getScrollPosition:function(){if(!this.currentPage)return 0;return"vertical"==this.viewOpts.viewertype?Math.max(this.getScroll()-this.magPagesPos[this.currentPage.num].y,0):this.currentPage.$scrollWrapper.scrollTop()},getScroll:function(){return this.$magScrollContainer&&this.$magScrollContainer.scrollTop()},setScroll:function(e){this.$magScrollContainer&&this.$magScrollContainer.scrollTop(e)},onMagScroll:function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement||this.hadPlayingVideoOnResize)this.hadPlayingVideoOnResize=!1;else{r.Z.isFunction(this._resetUrlStringTimeoutFunc)&&this._resetUrlStringTimeoutFunc(),this.pauseWidgetsLoadingOnScroll();var e=this.findPageOnCurrentMagScroll({pageStartsOnBottom:!(0,k._)("viewer.offPageStartOnBottom")&&this.isStickyVerticalViewer&&!S.Z.isDesktop}),t=this.getScrollParams(e);if(this.lastPageScroll=t.pageScroll,this.lastPageScrollPercent=t.pageScrollPercent,this.showPage(e.page.num,t),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!0,scroll:this.getScroll()}),this.trigger("mag scroll",this.getScroll()),this.$bottomArrow&&+this.magOpenTime+2e3<+new Date){this.$bottomArrow.addClass("offscreen");var i=this.$bottomArrow;delete this.$bottomArrow,setTimeout((function(){i.remove()}),400)}}},scrollMagALittle:function(){this.$magScrollAnimate.animate({scrollTop:this.getScroll()+this.getContainerSizeCached().height},500)},findPageOnCurrentMagScroll:function(e){e=e||{};var t,i,n,a,s=this.getScroll(),r=this.getContainerSizeCached(),o=(s=Math.min(Math.max(s,0),this.magHeight-r.height),this.pages.length),c=s+(e.pageStartsOnBottom?r.height-50-16-16:0);for(t=0;t<o;t++){if(i=this.pages[t],n=this.magPagesPos[i.num],c>=(a?a.y+a.h:n.y)&&c<n.y+n.h||t==o-1)return{page:i,scroll:s,pos:n};a=n}},getScrollParams:function(e){var t=Math.max(e.scroll-e.pos.y,0),i={initiator:"scroll",pageScroll:t,pageScrollPercent:t/e.page.pageHeight};if(this.viewOpts.slidein?(i.nextPageScroll=0,i.slideInNextPageScroll=e.pos.h-i.pageScroll):i.nextPageScroll=i.pageScroll-e.pos.h,i.nextPageVisible=e.pos.h-i.pageScroll<this.getContainerSizeCached().height,this.viewOpts.slidein){var n=(e.pos.h-i.pageScroll)/this.getContainerSizeCached().height;i.nextPageBlackout=Math.min(Math.max(n,0),1)}return i},onCurrentPageScroll:function(e,t){this.pauseWidgetsLoadingOnScroll(),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!this.isStickyVerticalViewer,scroll:t}),this.lastPageScroll=t,this.lastPageScrollPercent=this.lastPageScroll/e.pageHeight,this.loadPages.__debounced()},scrollCurrentPageALittle:function(){this.currentPage&&this.currentPage.scrollPageALittle()},focusCurrentPage:function(){this.currentPage&&this.currentPage.focusPage()},backToTopCurrentPage:function(){if("vertical"==this.viewOpts.viewertype){var e=this.findPageOnCurrentMagScroll();this.getScroll()!==e.pos.y&&this.$magScrollAnimate.animate({scrollTop:e.pos.y},500)}else this.currentPage&&this.currentPage.backToTop();RM.analytics&&RM.analytics.sendEvent("Scroll Top Link")},scrollPageToPos:function(e,t){var i,n,a=this.getPage(e),s=this.getContainerSizeCached();t=t||0,t*=a.scale,t+=a.contentPosition.top,"vertical"==this.viewOpts.viewertype?(i=this.magPagesPos[a.num],n=Math.max(0,i.y+t),n=Math.min(n,i.y+i.h-s.height),this.$magScrollAnimate.animate({scrollTop:n},500)):(this.currentPage!=a&&this.showPage(a.num),n=Math.max(0,t),a.scrollTo(n))},pauseWidgetsLoadingOnScroll:function(){},toExternalLink:function(e){var t=(0,n.Z)(e.target).closest("a").attr("href");RM.analytics&&RM.analytics.sendEvent("External Link",t)},maglink:function(e){if(2!=e.which&&!e.metaKey&&!e.ctrlKey){var t=(0,n.Z)(e.currentTarget).data("link")||(0,n.Z)(e.currentTarget).attr("href");if(!t)return!1;if(e.preventDefault(),(0,n.Z)(e.currentTarget).hasClass("back-to-top"))return this.backToTopCurrentPage();this.router.navigate(t,{trigger:!0})}},onGobackLinkClick:function(e){this.router.goBack()},onMailchimpLinkClick:function(e){var t,i=(0,n.Z)(e.currentTarget);if(!i.hasClass("disabled")){i.flashClass("disabled",3e3);try{t=JSON.parse(i.attr("data-mailchimp"))}catch(e){t=null}t&&u.Z.initMailchimpAPI((function(e){d.default.deleteCookie("MCEvilPopupClosed"),e.start(t)}))}},onAnchorLinkClick:function(e){var t=(0,n.Z)(e.currentTarget),i=parseInt(t.attr("data-anchor-link-pos"),10)||0,a=t.attr("data-page-id"),s=t.attr("data-page-uri");if(a){var r=this.pages.find((function(e){return e._id===a}));r&&(s=r.num)}i&&s&&(this.scrollPageToPos(s,i),RM.analytics&&RM.analytics.sendEvent("Anchor Link",i))},onShareLinkClick:function(e){p.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:(0,n.Z)(e.currentTarget).attr("data-share-provider"),source:"mag links",page:this.currentPage||this.pages[0],mag:r.Z.extend(this.model.toJSON(),{user:this.user}),forProject:"mag"==(0,n.Z)(e.currentTarget).attr("data-share-type"),customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!=RM.common.embedDomainType),analytics:this.router.analytics})},showPageCounter:function(e){if(this.toolbar){var t=1;this.currentPage&&(t=this.currentPage.num+(e?"left"==e?1:-1:0),t=Math.max(Math.min(t,this.getPagesCount()),1)),this.toolbar.showPageCounter(this.getPage(t),{showPageCounter:!0})}},showPage:function(e,t){t=t||{},this.active||this.render();var i=this.getPage(e),n=this.currentPage,a=i&&this.getPage(i.num+1),s=this;i&&!this.aboveGlobalWidgetsRendered&&this.renderAboveGlobalWidgets(i),this.isStickyVerticalViewer?this.redrawAboveGlobalWidgets():t.nextPageVisible||"horizontal"===this.viewOpts.viewertype?this.redrawAboveGlobalWidgets(i,a,t.slideInNextPageScroll||t.nextPageScroll,t.animation):i?this.redrawAboveGlobalWidgets(i):n&&this.redrawAboveGlobalWidgets.__debounced(),"vertical"==this.viewOpts.viewertype&&(t.animation=!1,i&&i.scrollOnVerticalMode(t.pageScroll||0),i&&a&&null!=t.nextPageScroll&&(a.scrollOnVerticalMode(t.nextPageScroll),(S.Z.isDesktop||(0,k._)("viewer.offPageStartOnBottom"))&&(t.nextPageVisible?a.start():a.stop())),i&&void 0!==t.nextPageBlackout&&this.$pages_blackout.css({display:a?"block":"none",opacity:t.nextPageBlackout,"z-index":i.getPageZIndex()}));var r=!this.currentPage;if(!r&&e===this.currentPage.num)return!1;if(!i)return 1!==e&&this.router.onError(),!1;if(n)if("horizontal"==this.viewOpts.viewertype||this.isStickyVerticalViewer)n.stop();else{a==n&&t.nextPageVisible||n.stop();var o=n&&this.getPage(n.num+1);o&&!(o==i||o==a&&t.nextPageVisible)&&o.stop()}else t.animation=!1;this.pauseLoading("page-change-animation"),this.currentPage=i,n&&n.resetWaitForAnimationEnd(),clearInterval(this.showPageCompleteInterval),this.$pages_container.toggleClass("disable-transitions",!t.animation),t.animation&&(this.viewOpts.slidein&&n&&n.num>i.num?n.waitForAnimationEnd(u):i.waitForAnimationEnd(u)),this.direction=!n||n.num<i.num?"forward":"backward";var c=i.num-this.getPreloadPageCount(i.num-1,"forward"===this.direction?"backward":"forward"),d=i.num+this.getPreloadPageCount(i.num-1,this.direction);"horizontal"!=this.opts.viewertype||this.opts.arrows||(c=d=i.num);for(var l=0;l<this.pages.length;l++){var h=this.pages[l];h.num<i.num?h.setPosition("prev",h.num+1==i.num):h.num>i.num?h.setPosition("next",h.num-1==i.num):h.setPosition("center",h.num==i.num),h.num>=c&&h.num<=d&&h.show(),"vertical"==this.viewOpts.viewertype&&(h.num<i.num||h.num>i.num+1)&&h.resetScrollOnVerticalMode()}function u(){function e(){for(var e=0;e<s.pages.length;e++){var t=s.pages[e];(t.num<c||t.num>d)&&t.hide()}i.start(),s.loadPages()}t.animation||r||window.requestAnimationFrame((function(){s.$pages_container.removeClass("disable-transitions")})),s.continueLoading("page-change-animation"),"vertical"==s.viewOpts.viewertype&&"scroll"!=t.initiator&&s.setScroll(s.magPagesPos[i.num].y),s.isPreview&&s.$el.scrollTop(0),clearInterval(s.showPageCompleteInterval),s.loadingPaused?s.showPageCompleteInterval=setInterval((function(){s.loadingPaused||(clearInterval(s.showPageCompleteInterval),e())}),17):e()}!t.animation&&u(),this.scheduleSetUrlString({replace:!r,skipInternalHistory:t.skipInternalHistory}),this.router.setTitle(),this.trigger("pageChanged",i,{showPageCounter:t.animation||t.bySwipe||r||"scroll"==t.initiator,initial:r}),i.trigger("changedTo"),"vertical"==this.viewOpts.viewertype&&this.updateArrowsColor(i)},scheduleSetUrlString:function(){if(!Modernizr.chrome)return this.router.setUrlString.apply(this.router,arguments),void(this._resetUrlStringTimeoutFunc=!1);var e=arguments;this._resetUrlStringTimeoutFunc=function(){clearTimeout(this._urlStrigScheduleTimeout),this._urlStrigScheduleTimeout=setTimeout(function(){this._resetUrlStringTimeoutFunc=null,this.router.setUrlString.apply(this.router,e)}.bind(this),100)}.bind(this),this._resetUrlStringTimeoutFunc()},goNextPage:function(e){this.isLastPage()||this.currentPage&&this.router.go(this.currentPage.num+1,L(L({},e),{},{isPageNum:!0}))},goPrevPage:function(e){this.isFirstPage()||this.currentPage&&this.router.go(this.currentPage.num-1,L(L({},e),{},{isPageNum:!0}))},goFirstPage:function(){this.router.go(1,{isPageNum:!0})},goLastPage:function(){this.router.go(this.getPagesCount(),{isPageNum:!0})},pauseLoading:function(e){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[e]=!0,this.loadingPaused=!0},continueLoading:function(e){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[e]=!1,this.loadingPaused=!r.Z.every(r.Z.values(this.pauseReasons),(function(e){return!e}))},loadPages:function(){if(window.RM.timing[l.qK.LoadPagesStart]=Date.now(),this.pages&&this.pages.length){var e=this.getPagesLoadOrder();if(e&&e.length){var t,i,n=[],a=[];for(t=0;t<e.length;t++){var s=(i=this.pages[e[t]]).getWidgetsPacks();s.length&&n.push(s),a=a.concat(i.getImmediatePack())}if(n.length){var r=[];for(t=0;t<n.length;t++){0==t&&c(t,0),c(t+1,0);for(var o=1;o<n[t].length;o++)c(t,o)}r.unshift(a),this.widgetsPacksLoadQueue=r,this.stopPagesLoad(),this.loadNextWidgetsPack()}}}function c(e,t){e<0||e>=n.length||t<0||t>=n[e].length||r.push(n[e][t])}},stopPagesLoad:function(){clearTimeout(this.loadNextWidgetsTimer)},loadNextWidgetsPack:function(){if(!this.widgetsPacksLoadQueue.length)return window.RM.timing[l.qK.LoadPagesEnd]=Date.now(),void s().trigger("widgetsQueue:empty",this.num_id);if(this.loadingPaused)this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,50);else{var e=this.widgetsPacksLoadQueue.shift();if(e.length){var t=r.Z.uniq(r.Z.map(e,"page")),i=t[0];if(1!==t.length||i.shown&&!i.loaded){this.widgetPackCount;i.loadWidgetsPack(e,r.Z.bind((function(){this.widgetPackCount++,this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}),this))}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}},getPreloadPageCount:function(e,t){if("horizontal"==this.viewOpts.viewertype)return this.PRELOAD_COUNT[t];for(var i=1,n=0,a="forward"==t?1:-1;n<this.PRELOAD_COUNT[t]&&i*a+e<this.pages.length&&i*a+e>=0;)n+=this.pages[i*a+e].height,i++;return i},getPagesLoadOrder:function(){var e=this.currentPage;if(e){var t,i=e.num-1,n=this.pages.length,a=[],s=this,r=e.num-this.getPreloadPageCount(i,"forward"==this.direction?"backward":"forward"),o=e.num+this.getPreloadPageCount(i,this.direction);if(c(i),"backward"==this.direction){for(c(i-1),c(i+1),t=i-2;t>=r;t--)c(t);for(t=i+2;t<=o;t++)c(t)}else{for(c(i+1),c(i-1),t=i+2;t<=o;t++)c(t);for(t=i-2;t>=r;t--)c(t)}return a}function c(e){e<0||e>=n||!s.pages[e].shown||s.pages[e].loaded||a.push(e)}},onGestureChange:function(){this.onResize.__debounced()},checkFullscreen:function(){this.fullscreenCheckCounter=5,clearInterval(this.fullscreenCheckTimer),this.fullscreenCheckTimer=setInterval(r.Z.bind((function(){var e=window.fullScreen||window.innerWidth==screen.width&&window.innerHeight>=screen.height-1;this.togglePresentationMode(e),this.fullscreenCheckCounter--,this.fullscreenCheckCounter||clearInterval(this.fullscreenCheckTimer)}),this),500)},onResize:function(e){var t=this;if(this.checkFullscreen(),!S.Z.isDesktop&&"horizontal"==this.viewOpts.viewertype||"vertical"==this.viewOpts.viewertype&&!this.isStickyVerticalViewer){var i="horizontal"==this.viewOpts.viewertype?(0,n.Z)("html, body").add(this.$el):this.$el,a=d.default.isPageNativelyScaled(),s=window.innerHeight;337==s&&414==(0,n.Z)(window).height()&&s++,i.height(a?"100%":s),!a&&i.scrollTop(0)}var o=this.getContainerSize(),c=this.isPortrait()?"portrait":"landscape",l=!1;if(!S.Z.isDesktop&&this.prevOrientation&&this.prevOrientation!==c){var h=this.getPage(this.currentPage.num-1),u=f.Z.findPlayingVideo(this.currentPage.widgets)||f.Z.findPlayingVideo(null==h?void 0:h.widgets),p=!!u&&D.Z.doBoundingBoxesIntersect(u.$el[0].getBoundingClientRect(),{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth});u&&p?(this.hadPlayingVideoOnResize=!0,setTimeout((function(){u.page.num===t.currentPage.num&&t.setScrollPosition({offset:u.y*t.getScale(t.currentPage.pageViewport)})}),500)):(this.hadPlayingVideoOnResize=!1,this.switchToViewport(this.getMagViewport()),this.setPagesTransitions(),this.stopPagesLoad(),setTimeout(this.onResize,300),setTimeout(this.onResize,1500)),l=!0}if(this.prevOrientation=c,this.isPreview&&"default"!=this.viewport){var g=Math.round((this.$el.width()-o.width)/2),m=Math.round((this.$el.height()-o.height)/2);this.$mag_container.add(this.$mag_viewport_device).css({top:Math.max(m,0),left:Math.max(g,0),width:o.width,height:o.height})}else this.$mag_container.add(this.$mag_viewport_device).css({top:"",left:"",width:"",height:""});this.$mag_viewport_device.attr("data-viewport",this.viewport),this.setNewPagesWidths(o.width,o.height),this.magHeight=0,this.magPagesPos=[];var v=this.pages&&this.pages.length;if(r.Z.each(this.pages,r.Z.bind((function(e,t){var i=e.onResize({absolutePosition:this.magHeight}),n=0;t<v-1&&this.viewOpts.slidein&&(n=this.SCROLL_SNAP),this.magPagesPos[e.num]={y:this.magHeight,h:i,dh:n},this.magHeight+=i+n}),this)),"vertical"===this.viewOpts.viewertype&&this.magHeight){var b=this.$magScrollSizer.width(),w=0;if(this.isPreview&&"default"!==this.viewport&&(w=Math.max(this.$el.height()-this.getViewportSetting("min_height"),0)),this.$magScrollSizer.css("height",this.magHeight+w),b!=this.$magScrollSizer.width()&&S.Z.isDesktop&&this.onResize(),this.currentPage)if(this.isStickyVerticalViewer||this.hadPlayingVideoOnResize){if(l&&!this.hadPlayingVideoOnResize){var y=this.getScrollPosForNewSize();setTimeout(r.Z.bind((function(){this.setScroll(y)}),this),0)}}else this.setScroll(this.getScrollPosForNewSize()),this.onMagScroll();this.$bottomArrow&&this.$bottomArrow.toggleClass("offscreen",this.getScroll()+o.height+this.SCROLLABLE_TRESHOLD>this.magHeight)}if("horizontal"==this.viewOpts.viewertype&&this.currentPage&&l&&!this.hadPlayingVideoOnResize){y=this.getScrollPosForNewSize();setTimeout(r.Z.bind((function(){this.currentPage.$scrollWrapper.scrollTop(y)}),this),0),this.aboveGlobalWidgetsRendered||setTimeout(r.Z.bind((function(){this.aboveGlobalWidgetsRendered||this.renderAboveGlobalWidgets(this.currentPage)}),this),40)}this.currentPage&&this.loadPages.__debounced()},onOptsChange:function(){window.dispatchEvent(new Event("resize"))},getScrollPosForNewSize:function(){return this.currentPage?"vertical"==this.viewOpts.viewertype?this.magPagesPos[this.currentPage.num].y+(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:0},setNewPagesWidths:function(e,t){var i=this.$el.find("#page-position-style"),a=S.Z.isDesktop?"":" translateZ(0)",s="        .mag .mag-pages-container .container {\n          left: 0px;\n          width: "+e+"px;\n        }\n        .mag .mag-pages-container .container .page {\n          left: 0px;\n          width: "+e+"px;\n        }\n",r="";if("horizontal"==this.viewOpts.viewertype)r="          .mag .mag-pages-container .container .page.prev-page {\n            -webkit-transform: translateX("+(this.viewOpts.slidein?0:-e)+"px) "+a+";\n            transform: translateX("+(this.viewOpts.slidein?0:-e)+"px) "+a+";\n          }\n          .mag .mag-pages-container .container .page.center-page {\n            -webkit-transform: translateX(0) "+a+";\n            transform: translateX(0) "+a+";\n          }\n          .mag .mag-pages-container .container .page.next-page {\n            -webkit-transform: translateX("+e+"px) "+a+";\n            transform: translateX("+e+"px) "+a+";\n          }";else if(this.isStickyVerticalViewer){var o=this.getContainerSizeCached().height;r="            .mag .mag-pages-container .container .page .page-fixed-bg-container,            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top {              height: "+o+"px;            }\n            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top,            .mag .mag-pages-container .container .page:not(.hide-sticky) .content-scroll-wrapper {              margin-top: "+-o+"px;            }\n"}else r="            .mag .mag-pages-container .container .page.prev-page {\n              top: "+(-t-1)+"px;            }\n            .mag .mag-pages-container .container .page.next-page {\n              top: "+(t+1)+"px;            }\n";i.length||(i=(0,n.Z)('<style id="page-position-style" type="text/css">')).appendTo(this.$el),"horizontal"==this.viewOpts.viewertype?(this.$pages_container.addClass("disable-transitions-on-resize"),i.text(s+r),this.$pages_container.height(),this.$pages_container.removeClass("disable-transitions-on-resize")):i.text(s+r)},setPagesTransitions:function(){var e=this.$el.find("#page-transition-style"),t=this.getPageTransitionTime(),i="cubic-bezier(0.40, 0.24, 0.40, 1)",a="        .mag .mag-pages-container .container .page {\n          -webkit-transition:\tall "+t+"ms "+i+";          transition: all "+t+"ms "+i+";        }\n        .mag .mag-pages-container .container .page.center-page {\n          -webkit-transition:\tall "+(t-5)+"ms "+i+";          transition: all "+(t-5)+"ms "+i+";        }\n        ";e.length||(e=(0,n.Z)('<style id="page-transition-style" type="text/css">')).appendTo(this.$el),e.text(a)},switchToViewport:function(e){if(this.viewport!=e){var t=this.viewport;this.containerSize=null,this.viewport=e,this.trigger("change:viewport",{viewport:this.viewport,oldViewport:t}),this.aboveGlobalWidgetsRendered=!1,this.aboveGlobalWidgets&&this.aboveGlobalWidgets.forEach((function(e){e.destroy(),e.off()})),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.destroy(),this.aboveGlobalWidgets=[],r.Z.each(this.pages,(function(e){e.updateViewport()}))}},getContainerSize:function(){var e,t,i=this;return this.isPreview&&"default"!=this.viewport?(e=this.getViewportWidth(this.viewport),t=Math.min(this.getViewportSetting("min_height"),this.$el.height())):(e=RM.screenshot?(0,n.Z)(window).width():this.$el.width(),t=RM.screenshot?window.innerHeight:this.isStickyVerticalViewer&&(Modernizr.safari||Modernizr.android)&&!S.Z.isDesktop?i.isPortrait()?Math.max(window.innerHeight,screen.height-20-20+1):Math.min(screen.width,screen.height):this.isStickyVerticalViewer?window.innerHeight:this.$el.height()||window.innerHeight),this.containerSize={width:e,height:t},this.containerSize},getContainerSizeCached:function(){return this.containerSize||this.getContainerSize()},getViewportWidth:function(e){return e&&e!==b.sJ.Default?e===b.sJ.PhonePortrait?this.phoneWidth||b.ZP.dictionary[b.sJ.PhonePortrait].width:b.ZP.dictionary[e].width:this.desktopWidth||b.ZP.dictionary[b.sJ.Default].width},isPortrait:function(){return window.screen?window.screen.orientation&&window.screen.orientation.type?!!window.screen.orientation.type.match(/portrait/i):0===window.orientation||90!==window.orientation&&-90!==window.orientation&&window.innerWidth<window.innerHeight:window.innerWidth<window.innerHeight},getMagViewport:function(){var e=this.isPortrait();if(this.isPreview)return this.constructorViewport||"default";var t=b.sJ.Default,i=window.innerWidth;if(Modernizr.retina||!S.Z.isDesktop||Modernizr.ismobile){if(screen&&screen.width&&(i=e?Math.min(screen.width,screen.height):Math.max(screen.width,screen.height)),e)return i<600?b.sJ.PhonePortrait:i>=600&&i<=1024?b.sJ.TabletPortrait:b.sJ.Default;if(i>980)return b.sJ.Default}if(Modernizr.isipad)return e?b.sJ.TabletPortrait:b.sJ.Default;if(!S.Z.isDesktop){var n=i,a=r.Z.reduce(b.ZP.viewports,(function(e,t,i){return Math.abs(t.width-n)<=Math.abs(b.ZP.viewports[e].width-n)?i:e}),0);t=b.ZP.viewports[a].name}return t},getViewportSetting:function(e,t){return(b.ZP.dictionary[t||this.viewport]||{})[e]},log:function(){for(var e="",t=0;t<arguments.length;t++)e+=arguments[t]+" ";var i=(0,n.Z)("#log");i.length||(i=(0,n.Z)('<div id="log">').css({position:"fixed",background:"rgba(0, 0, 0, 0.7)",color:"#fff",width:200,height:300,left:10,top:10,"z-index":999999,overflow:"auto"}).appendTo("body"));var a=i.html(),s=a.split("<br>");i.html(s.slice(-17).join("<br/>")+"<br/>"+e),i.scrollTop(999999)},fixFocusScroll:function(){this.$mag_container.scrollTop(0),this.$mag_container.scrollLeft(0)},matchSameDomainLink:function(e){var t=e.match(new RegExp("//"+d.default.escapeSpecial(window.location.hostname)+"/(.*)")),i=t&&t[1];if(i){var n=this.getPageByPath(i);if(n)return n._id}return e},getScale:function(e){if(RM.screenshot)return 1;var t=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),i=this.getViewportWidth(e),n=t/i;return v.Z.normalize(n,void 0,this.viewport,i,this.opts)},getAllWidgetViewsById:function(e,t){var i,n=this,a=t?null===(i=t.getWidgetDataById)||void 0===i?void 0:i.call(t,e):void 0,s=a&&a.is_global,r=Boolean(this.aboveGlobalWidgetsData&&this.aboveGlobalWidgetsData.find((function(t){return t._id===e})));return!s&&a||r?[this.getWidgetById(e)]:this.pages.filter((function(t){var i;return null===(i=t.getWidgetDataById)||void 0===i?void 0:i.call(t,e)})).map((function(t){return n.getWidgetById(e,t)}))},getWidgetById:function(e,t){var i,n,a=t&&t.getWidgetDataById(e)?t:r.Z.find(this.pages,(function(t){return t.getWidgetDataById&&t.getWidgetDataById(e)}));return a?(n=a.getWidgetById(e))?i=window.Promise.resolve(n):a.loaded||(i=new window.Promise(function(t,i){this.listenToOnce(a,"loaded"+e,(function(){var n=a.getWidgetById(e);n?t(n):i()}))}.bind(this))):r.Z.find(this.aboveGlobalWidgetsData,{_id:e})&&((n=r.Z.find(this.aboveGlobalWidgets,{_id:e}))?i=window.Promise.resolve(n):this.aboveGlobalWidgetsRendered||(i=new window.Promise(function(t,i){this.listenToOnce(this,"aboveGlobalWidgetsRendered",(function(){var n=r.Z.find(this.aboveGlobalWidgets,{_id:e});n?t(n):i()}))}.bind(this)))),i||window.Promise.reject()},renderAboveGlobalWidgets:function(e){var t=[],i=e.pageViewport;r.Z.each(this.aboveGlobalWidgetsData,function(n){var a,s=r.Z.find(this.aboveGlobalWidgets,{_id:n._id});if(s&&(s.destroy(),s.off()),n){var o=e.getWidgetViewportData(n,i),c=!this.isPreview&&m.Z.hasExpired(o);w.Widgets[o.type]&&!c&&((a=new w.Widgets[o.type](o,e)).$fixedContainer=this.$aboveWidgetsContainer,a.isValid()&&t.push(a))}}.bind(this)),this.aboveGlobalAnimations=this.initializeAboveGlobalAnimation(t,e),r.Z.each(t,(function(t){t.render(),t.hidden||e.isPasswordProtected()?g.Z.hide(t,!0):g.Z.show(t,!0)})),this.aboveGlobalWidgets=r.Z.sortBy(t,"y"),this.aboveGlobalWidgetsRendered=!0,this.trigger("aboveGlobalWidgetsRendered")},initializeAboveGlobalAnimation:function(e,t){e=r.Z.isArray(e)?e:[e],t.scale=this.getScale(t.pageViewport);var i=new y.Z({page:t,widgets:e}),n=[];return r.Z.each(e,(function(e){var t=new window.Promise((function(t){e.loaded?t(e):e.on("loaded",t.bind(null,e))}));n.push(t)})),window.Promise.all(n).then(function(){this.aboveAnimationsReady=!0,this.trigger("aboveAnimationsReady")}.bind(this)),this.listenTo(t,"resize",(function(e){r.Z.isUndefined(e.prevScale)||e.prevScale===e.scale||i.updateTimelines(),i.onResize({updateAll:!0})})),i},updateAboveGlobalViewport:function(e,t){var i=r.Z.find(this.aboveGlobalWidgetsData,{_id:e._id}),n=t.getWidgetViewportData(i,t.pageViewport);if(e.animationObj&&this.aboveGlobalAnimations.removeAnimation(e.animationObj),e.destroy(),e.initialize(n,t),e.hasAnimation()){var a=this.aboveGlobalAnimations.addAnimation(e);a&&a.start()}e.render(),g.Z.hide(e,!0)},getAboveGlobalBox:function(e,t,i){var n=r.Z.find(this.aboveGlobalWidgetsData,{_id:e}),a=t.getWidgetViewportData(n,t.pageViewport);return d.default.getFixedPositionBox(a.fixed_position,r.Z.pick(a,["x","y","w","h"]),t.scale,i)},redrawAboveGlobalWidgets:function(e,t,i,n){if(!e){var a=r.Z.isUndefined(this.getScroll())?void 0:this.findPageOnCurrentMagScroll(),s=a&&a.page.num,o=a&&this.getScrollParams(a);e=s&&this.getPage(s),t=e&&this.getPage(e.num+1),i=o&&(o.slideInNextPageScroll||o.nextPageScroll),n=o&&o.animation}i=r.Z.isUndefined(i)?void 0:Math.abs(i);var c={width:Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),height:this.getContainerSizeCached().height},l=function(e,t){return!e.page||t&&e.page.pageViewport!==t.pageViewport};if(r.Z.isUndefined(i)){var h=this.getPageTransitionTime();r.Z.each(this.aboveGlobalWidgets,function(t){var i=e._id&&!g.Z.isHidden(t,e._id,this.isPreview)&&!e.isPasswordProtected(),a=e._id&&l(t,e);e._id&&t.updatePage(e),a&&this.updateAboveGlobalViewport(t,e),i?n?t.wasHidden&&d.default.waitForTransitionEnd(e.$el,h,"transform",g.Z.show.bind(null,t)):t.wasHidden&&g.Z.show(t):!t.wasHidden&&g.Z.hide(t)}.bind(this))}else{var u=Math.abs(i);r.Z.each(this.aboveGlobalWidgets,function(i){var n=!g.Z.isHidden(i,e._id,this.isPreview)&&!e.isPasswordProtected(),a=t&&!g.Z.isHidden(i,t._id,this.isPreview)&&!t.isPasswordProtected(),s=n&&a&&e.pageViewport===t.pageViewport,r=this.getAboveGlobalBoxMemoized(i._id,e,c),o=this.getAboveGlobalBoxMemoized(i._id,t||e,c),d=n&&u>r.top+r.height,h=t&&a&&o.top>u;if(d||h||s||!t&&n){var p=d?e:h?t:i.page,m=l(i,p);i.updatePage(p),m?(i.rendered=!1,g.Z.hide(i).then(function(){this.updateAboveGlobalViewport(i,p),g.Z.show(i)}.bind(this))):i.wasHidden&&g.Z.show(i)}else!i.wasHidden&&g.Z.hide(i)}.bind(this))}},getUsedFonts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h.Z.getUsedFontsFromWidgetsModels(L(L({},e),{},{models:this.pages.reduce((function(e,t){return t.widgets.reduce((function(e,t){return e.push(t)&&e}),e)}),[]),customList:e.includeCustom?r.Z.filter(this.edit_params&&this.edit_params.fonts,{provider:"custom"}):[]}))},hasCodeInjection:function(){var e=this;if(r.Z.any(["ci_head","ci_body_top","ci_body_bottom","ci_css"],(function(t){return!!e[t]})))return!0;var t=!1;return r.Z.each(this.pages,(function(e){r.Z.each(e.widgetsData,(function(e){var i=!("iframe"!==e.type||!e.code);if(i&&!e.use_iframe){var n="codeinjection"===E()(e.code,e);if(n){var a=!(!r.Z.all(b.ZP.viewport_listall,(function(t){var i=e[t];return i&&i.hidden||!i}))||!e.hidden);i&&n&&!a&&(t=!0)}}}))})),t},setupEcommerceSidebar:function(){"ecwid"===this.eCommerceManager.getConnectedProvider()?this.cartSidebar=new x.Z(this):this.cartSidebar=new Z.Z(this)}});t.default=W},1063:function(e,t,i){"use strict";var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(341),c=i(1064),d=i(324),l=i(348),h=i(697),u=s().View.extend({ARROWS_SHOW_DELAY:1e3,BOTTOM_SHOW_DELAY:1e3,BOTTOM_HIDE_DELAY:0,template:c.Z["template-viewer-navigation"],events:{"click .navigation-arrow.left":"goPrevPage","click .navigation-arrow.right":"goNextPage","click .navigation-arrow.bottom":"scrollCurrentPage"},initialize:function(e){return r.Z.bindAll(this),r.Z.extend(this,e),this.updateScaleState.__debounced=r.Z.debounce(this.updateScaleState,100),this},render:function(){return this.setElement(this.template({icons:{sprite:(0,l.findImagePath)("./common/navigation/sprite".concat(l.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.$prev=this.$(".navigation-arrow.left"),this.$next=this.$(".navigation-arrow.right"),this.$bottom=this.$(".navigation-arrow.bottom"),r.Z.delay(r.Z.bind((function(){this.$prev.removeClass("offscreen"),this.$next.removeClass("offscreen")}),this),this.ARROWS_SHOW_DELAY),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+n.Z.keycodes.left,this.goPrevPage),this.listenTo(this.mag,"keypress-"+n.Z.keycodes.right,this.goNextPage),d.Z.isDesktop&&(0,n.Z)(window).bind("mousewheel",this.onMouseWheel),d.Z.isDesktop||((0,n.Z)(window).bind("gesturechange",this.updateScaleState.__debounced),this.updateScaleState(),this.mag.getPagesCount()>1&&this.setSwipeAction()),this},destroy:function(){return d.Z.isDesktop&&(0,n.Z)(window).unbind("mousewheel",this.onMouseWheel),d.Z.isDesktop||((0,n.Z)(window).unbind("gesturechange",this.updateScaleState.__debounced),this.pagesSwipe&&this.pagesSwipe.destroy()),this.remove()},onMouseWheel:function(e,t,i,n){this.preventTrackpadSwipeTill&&+new Date<this.preventTrackpadSwipeTill||Math.abs(i)>40&&Math.abs(i)>Math.abs(n)&&(i>0&&this.goPrevPage(),i<0&&this.goNextPage(),this.preventTrackpadSwipeTill=+new Date+1e3)},setSwipeAction:function(){this.pagesSwipe=this.mag.$mag_container.RMSwipe({$scrollElements:this.mag.$mag_container,getMaxTransitionSpeed:r.Z.bind((function(){return this.mag.getPageTransitionTime()}),this),customMoveCheck:r.Z.bind((function(e,t){return!(e.hasClass("prev-page")&&t<0)&&!(e.hasClass("next-page")&&t>0)}),this),beforeAutoAnimation:r.Z.bind((function(e,t){return this.mag.showPageCounter(e),{autoAnimate:!0,immediateCallback:!1}}),this),onSwipeStart:r.Z.bind((function(){this.mag.showPageCounter()}),this),getCurrentConstraints:r.Z.bind((function(e){var t={},i=this.mag.$mag_container.width(),n=e.closest(".page, .final-page");return n.length||(n=this.mag.currentPage.$el),t.$moveItems=n.add(n.prev()).add(n.next()),t.$referenceItem=t.$moveItems.filter(":not(.center-page)").first(),this.mag.isLastPage()?t.left={max:0,noTrigger:!0}:t.left={max:i},this.mag.isFirstPage()?t.right={max:0,noTrigger:!0}:t.right={max:i},t}),this),callback:r.Z.bind((function(e){"right"===e&&this.mag.goPrevPage({animation:!1,bySwipe:!0}),"left"===e&&this.mag.goNextPage({animation:!1,bySwipe:!0})}),this)}).data("swipe")},onPageChange:function(e,t){this.$next.toggleClass("hidden",!!this.mag.isLastPage()),this.recalcBottomArrowState(e),this.$prev.toggleClass("hidden",this.mag.isFirstPage()),this.mag.updateArrowsColor(e)},recalcBottomArrowState:function(e){clearTimeout(this.bottomArrowTimeout);var t=e.isBottomArrowVisible();"horizontal"===this.viewerType&&h.Z.isScaleLayout(this.mag.viewOpts)&&(t=!1),this.isPreview&&"default"!==this.mag.viewport&&(t=!1),this.bottomArrowTimeout=setTimeout(r.Z.bind((function(){this.$bottom.toggleClass("offscreen",!t)}),this),t?this.BOTTOM_SHOW_DELAY:this.BOTTOM_HIDE_DELAY)},goPrevPage:function(e){this.mag.goPrevPage({animation:!0})},goNextPage:function(e){this.mag.goNextPage({animation:!0})},scrollCurrentPage:function(e){this.mag.scrollCurrentPageALittle()},updateScaleState:function(){Modernizr.android||this.$prev.add(this.$next).add(this.$bottom).toggleClass("scaled-offscreen",o.default.isPageNativelyScaled())}});t.Z=u},1052:function(e,t,i){"use strict";var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(1053),c=i(1005),d=i(341),l=i(922),h=i(697),u=i(723),p=i(1054),g=i(349),m=i(931),v=i(344),f=i(722),b=i(993),w=i(1055),y=i(324),P=i(309);function C(e,t,i,n,a,s,r){try{var o=e[s](r),c=o.value}catch(e){return void i(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function S(e){return function(){var t=this,i=arguments;return new Promise((function(n,a){var s=e.apply(t,i);function r(e){C(s,n,a,r,o,"next",e)}function o(e){C(s,n,a,r,o,"throw",e)}r(void 0)}))}}function k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?k(Object(i),!0).forEach((function(t){Z(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Z(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var x,$=T(T({},o.Z),c.Z),O=s().View.extend({template:$["template-viewer-page"],initialize:function(e){return r.Z.bindAll(this),this.mag=e.mag,this.router=e.router,this.$container=e.$container,this.viewerType=e.viewerType,this.totalPages=e.totalPages,this.isStickyVerticalViewer=e.isStickyVerticalViewer,this.widgetsData=e.pageData.wids,this.viewOpts=e.viewOpts,r.Z.defaults(e.pageData,{title:"",width:this.mag.getViewportWidth(e.mag.viewport),height:this.mag.getViewportSetting("min_height")}),r.Z.extend(this,r.Z.omit(e.pageData,["wids","widgets"])),this.contentPosition={left:0,top:0},this},render:function(){return this.setElement(this.template({isStickyVerticalViewer:this.isStickyVerticalViewer,pageNum:this.num})),this.$el.appendTo(this.$container),RM.screenshot||Modernizr.csspositionsticky||(0,n.Z)(".polyfill-sticky").Stickyfill(),this.zIndex=this.totalPages-this.num+2,"vertical"===this.viewerType&&this.$el.css("z-index",this.zIndex),this.$content=this.$(".page-content-container"),this.$scrollWrapper=this.$(".content-scroll-wrapper"),this.$scrollWrapper.one("scroll",this.fixSafariScroll),this.$fixedBgContainer=this.$(".page-fixed-bg-container"),this.$fixedPositionContainer=this.$(".fixed-position-container"),this.$fixedPositionContainerTop=this.$(".fixed-position-container-top"),this.$contentBounds=this.$(".content-bounds"),this.$pagePasswordContainer=this.$(".page-password-container"),this.pageViewport=this.getPageViewport(),"horizontal"===this.viewerType&&this.$scrollWrapper.bind("scroll",this.onScroll),this.createLQBackground(),RM.screenshot===this._id&&(this.$el.css({overflow:"hidden",height:Math.max(this.height,672),width:this.mag.getViewportWidth(v.sJ.Default),position:"relative"}),"true"===d.default.queryUrlGetParam("pdf")&&(this.$fixedPositionContainer.css({height:"100%"}),this.$fixedPositionContainerTop.css({height:"100%"})),this.onResize(),this.on("pageLoaded",(function(){this.mag.router.sendReadyEvent({page:this})}),this)),this},show:function(){if(!this.shown){if(this.$el.removeClass("hidden"),this.shown=!0,this.isPasswordProtected()&&!this.passwordFormShown)return this.showPagePasswordForm(),this.passwordFormShown=!0,this;"horizontal"===this.viewerType&&this.onResize(),this.widgets&&this.lastViewportUsedForWidgetsCreation===this.pageViewport||this.createWidgetsForCurrentViewport()}return this},start:function(e){if(!this.started||e&&e.forceStart)return this.started=!0,this.trigger("started"),e=e||{},r.Z.each(this.widgets,(function(t){(!e||!e.widgetTypes||r.Z.indexOf(e.widgetTypes,t.type)>=0)&&t.start()})),this.focusPage(),this.$scrollWrapper.addClass("accelerated-scroll"),this.animations&&this.animations.start(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.start(),this},stop:function(e){if(this.started)return e=e||{},this.started=!1,this.trigger("stopped"),this.$scrollWrapper.removeClass("accelerated-scroll"),r.Z.each(this.widgets,(function(t){(!e||!e.widgetTypes||r.Z.indexOf(e.widgetTypes,t.type)>=0)&&t.stop()})),this.animations&&this.animations.stop(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.stop(),this},getUrl:function(){return window.location.protocol+"//"+window.location.hostname+"/p"+this.num_id+"/"},setPosition:function(e,t){this.lastPosition==e&&this.lastNeighbour==t||(this.$el.removeClass("center-page prev-page next-page neighbour").addClass(e+"-page "+(t?"neighbour":"")),this.lastPosition=e,this.lastNeighbour=t)},getScroll:function(){return this.visibleWidgetsCoords.scrollTop},scrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode=!0;var t,i,n=this.pageHeight-this.pageBgHeight;e<0?(t=-e,i=0):n>=e?(t=0,i=-e):(t=n-e,i=-n),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=-i,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.trigger("page scroll",this.getScroll()),this.isStickyVerticalViewer||(this.$el.css("top",0),d.default.applyTransform(this.$el,t?"translateY("+t+"px) translateZ(0)":""),this.hasFixedWidgets?this.$contentBounds.css("top",i):d.default.applyTransform(this.$contentBounds,i?"translateY("+i+"px)":""))},resetScrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=0,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",""),d.default.applyTransform(this.$el,""),this.hasFixedWidgets?this.$contentBounds.css("top",0):d.default.applyTransform(this.$contentBounds,"")))},hide:function(){return this.shown&&(this.$el.addClass("hidden"),this.shown=!1),this},destroyAllWidgets:function(e){this.loaded=!1,this.videoBGStarted=!1,r.Z.each(this.widgets,function(t,i){var n=this.widgetsData.some((function(e){var i=u.Z.normalizeAnimations(e.animation),n=e._id===t._id&&Boolean(i.find((function(e){return!u.Z.isEmpty(e)}))),a=e._id===t._id&&(e.viewport_default&&e.viewport_default.hidden||e.viewport_tablet_portrait&&e.viewport_tablet_portrait.hidden||e.viewport_phone_portrait&&e.viewport_phone_portrait.hidden||e.hidden);return n||a}));e&&e.includes(t.type)&&!n||(t.destroy(),t.off(),delete this.widgets[i])}.bind(this)),this.animations&&this.animations.destroy(),delete this.animations,clearTimeout(this.fireReadyTimeout)},destroy:function(){return this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.resetWaitForAnimationEnd(),this.destroyLQBackground({animate:!1}),this.destroyAllWidgets(),this.remove()},onFormFocus:function(e){!Modernizr.safari&&y.Z.isDesktop||(e=r.Z.isUndefined(e)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():e,this.$fixedBgContainer.css({top:e}))},onFormBlur:function(){!Modernizr.safari&&y.Z.isDesktop||this.$fixedBgContainer.css({top:0})},onScrollWithFormInFocus:function(e){!Modernizr.safari&&y.Z.isDesktop||(e=r.Z.isUndefined(e)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():e,this.$fixedBgContainer.css({top:e}))},isSwipeInProgress:function(){return this.$el.hasClass("swiping")},getPageZIndex:function(){return this.zIndex||1},getImmediatePack:function(){return r.Z.filter(this.widgets,(function(e){return e.canRenderImmediately()&&!e.rendered}))},getWidgetsPacks:function(){if(!this.widgets)return[];var e,t,i,n=this.visibleWidgetsCoords,a=(n.top+(n.scrollTop||0))/n.scale,s=(n.bottom+(n.scrollTop||0))/n.scale-a,r=[],o=[];if(!this.BGWidget||this.BGWidget.rendered||this.BGWidget.loaded||o.push(this.BGWidget),this.fixedWidgets&&this.fixedWidgets.length)for(e=0;e<this.fixedWidgets.length;e++)(i=this.fixedWidgets[e]).rendered||i.loaded||i.canRenderImmediately()||o.push(i);var c,d,l=[],h=99999,u=-99999,p=!1;for(e=0;e<this.widgets.length;e++)(t=this.widgets[e]).rendered||t.loaded||"background"==t.type||t.fixed_position||(c=(d=O.getScreenIndex(t,a,s,!0)).index,h=Math.min(d.start,h),u=Math.max(d.end,u),t.screenIndex=c,c!==1/0&&(l[c]=l[c]||[],l[c].push(t)),p=!0);if(p){for(l[0]&&r.push(l[0]),l[1]&&r.push(l[1]),l[-1]&&r.push(l[-1]),e=2;e<=u;e++)l[e]&&r.push(l[e]);for(e=-2;e>=h;e--)l[e]&&r.push(l[e])}return o.length&&(r.length?r[0]=o.concat(r[0]):r=[o]),r},loadWidgetsPack:function(e,t){var i,n=0,a=0,s=0;for(i=0;i<e.length;i++){var r=e[i];r.rendered||r.loaded||r.destroyed||(r.canRenderImmediately()||(n++,r.on("loaded destroyed",o,r)),s++,r.render())}function o(){a++,n==a&&t()}s||t(),n==a&&t()},loadForScreenshotMode:function(){r.Z.each(this.widgets,function(){var e=S(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:e.sent.start();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},createWidgetsForCurrentViewport:function(){this.destroyAllWidgets(["video"]),this.BGWidget=null,this.fixedWidgets=[];var e=this.pageViewport,t=[],i=[],n=99999,a=this,s=this;r.Z.each(this.widgetsData,function(t){var a=s.getWidgetViewportData(t,e),r=!this.mag.isPreview&&u.Z.hasExpired(a);!w.Widgets[a.type]||a.hidden||r||(!a.fixed_position&&a.z&&"background"!=a.type&&(n=Math.min(n,a.z)),i.push(a))}.bind(this)),99999==n&&(n=0),r.Z.each(i,function(i){var r=h.Z.isOn(e,this.mag.getViewportWidth(e),this.mag.viewOpts)&&h.Z.isCSSTransform();i.fixed_position&&(i.z<n||y.Z.isDesktop&&!this.mag.isStickyVerticalViewer&&!r)?i.$fixedContainer=s.$fixedPositionContainer:i.$fixedContainer=s.$fixedPositionContainerTop;var o=null;this.widgets&&this.widgets.length&&(o=this.widgets.find((function(e){return!!e&&e._id===i._id})));var c=o||new w.Widgets[i.type](i,a);"video"===c.type&&(c.updateWidgetData(i,a),c.applyBoxStyle(),c.updateVideoFrameSize(i.w,i.h)),"background"===c.type&&(s.BGWidget=c,s.hasVideoBG=c.hasVideoBG()),c.isValid()&&(c.fixed_position&&s.fixedWidgets.push(c),t.push(c))}.bind(this)),this.animations=new p.Z({page:this,widgets:t}),this.widgets=r.Z.sortBy(t,"y"),this.signalOnLoading(),this._onFontsLoad=[],this._widgetsWithFontsToLoad=[],this._fontLoaderCalled=0,this._widgetsWithFontsCount=r.Z.reduce(this.widgets,(function(e,t){return e+(t.hasFontsToLoad()?1:0)}),0),this._widgetsWithLoadAnimation=r.Z.reduce(this.widgets,(function(e,t){return e+(t.hasLoadAnimation()?1:0)}),0),this.hasFixedWidgets=!!this.fixedWidgets.length;var o=h.Z.isOn(e,this.mag.getViewportWidth(e),this.mag.viewOpts)&&h.Z.isCSSTransform();this.$el.removeClass("page-with-fixeds-desktop page-with-fixeds-sticky-or-mobile").toggleClass("page-with-fixeds-desktop",this.hasFixedWidgets&&y.Z.isDesktop).toggleClass("page-with-fixeds-sticky-or-mobile",!(!this.hasFixedWidgets||!this.isStickyVerticalViewer&&y.Z.isDesktop&&!o)),this.hasFixedWidgets&&!this.retargetScroll&&"horizontal"==this.viewerType&&y.Z.isDesktop&&(this.retargetScroll=b.Z&&(0,b.Z)(this.$fixedPositionContainerTop.get(0),this.$scrollWrapper.get(0)),b.Z&&(0,b.Z)(this.$fixedPositionContainer.get(0),this.$scrollWrapper.get(0))),this.lastViewportUsedForWidgetsCreation=e},getWidgetViewportData:function(e,t){var i=r.Z.clone(e),n={},a=["text_w","text_h","em_w","anchor_link_pos","font-size","font-style","font-weight","font-family","color","color-opacity","letter-spacing","hover-color","hover-color-opacity","current-font-size","current-font-style","current-font-weight","current-font-family","current-color","current-color-opacity","current-letter-spacing","background-color","background-color-opacity","hover-background-color","hover-background-color-opacity","current-background-color","current-background-color-opacity","border-radius","border-width","border-color","border-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity","icon_h","icon_w"];return"default"!=t&&e["viewport_"+t]&&(r.Z.each(v.ZP.viewport_fields[e.type]||v.ZP.viewport_fields_common,(function(i){if(("shape"!=e.type||"borders"!=i&&"weight"!=i&&"bg_color"!=i)&&!("background"==e.type&&"picture"==i||"text"===e.type&&3===e.version&&"blocks"===i)){if((0,P._)("constructor.viewportMinimal")||(n[i]=void 0),f.Z.isGlobalKey(i)){var s=f.Z.getGlobalPrefixedKey(i);n[s]=void 0}(0,P._)("constructor.viewportMinimal")||(n[i]="button"===e.type&&!r.Z.has(e["viewport_"+t],i)&&a.includes(i)?e[i]:void 0)}})),r.Z.extend(i,n,r.Z.omit(e["viewport_"+t],["_id","modelType"]))),e.is_global&&f.Z.fillUniqueValues(i,this._id,{}),i},getWidgetById:function(e){return r.Z.findWhere(this.widgets,{_id:e})},getWidgetDataById:function(e){return r.Z.findWhere(this.widgetsData,{_id:e})},signalOnLoading:function(){var e=this.widgets.length,t=this,i={};function n(){e--,clearTimeout(i[this._id]),"background"==this.type&&t.destroyLQBackground({animate:!0}),this.hasLoadAnimation()&&(t._widgetsWithLoadAnimation--,t._widgetsWithLoadAnimation||(t.loadAnimationsReady=!0,t.trigger("loadAnimationsReady"))),e||(t.fireReadyTimeout=setTimeout(a,200)),t.trigger("loaded"+this._id)}function a(){t.loaded=!0,t.trigger("pageLoaded")}r.Z.each(this.widgets,(function(e){RM.screenshot&&(i[e._id]=setTimeout((function(){e.widgetIsLoaded()}),2e4)),e.on("loaded",n,e)}),this),this.BGWidget&&this.hasVideoBG&&this.BGWidget.on("videoBGStarted",(function(){t.videoBGStarted=!0,r.Z.delay((function(){t.trigger("videoBGStarted")}),1300)}),this.BGWidget),0==e&&(this.fireReadyTimeout=setTimeout(a,200))},getFontsVariations:function(e,t){var i=g.Z.getUsedFontsFromWidgetsModels({includeCustom:!0,customList:r.Z.filter(this.mag.edit_params.fonts,{provider:"custom"}),models:e,excludeUnusedDefault:t,activeViewports:[this.getPageViewport()]}),n=[];return r.Z.each(i,(function(e){for(var t=0;t<e.used_variations.length;t++)n.push({fontFamily:e.css_name,fontWeight:100*(e.used_variations[t].substr(1,1)-0),fontStyle:"n"==e.used_variations[t].substr(0,1)?"normal":"italic"})})),n},addFontsToLoad:function(e,t){if(this._widgetsWithFontsToLoad.push(e),this._onFontsLoad.push(t),this._fontLoaderCalled++,this._fontLoaderCalled==this._widgetsWithFontsCount){var i=this.getFontsVariations(this._widgetsWithFontsToLoad);if(r.Z.isEmpty(i))return void this.onAllFontsLoad();this._fontsToLoadLeft=i.length,r.Z.each(i,r.Z.bind((function(e){g.Z.exactWaitForFontLoad(e.fontFamily,e.fontWeight,e.fontStyle,this.onOneFontLoad)}),this))}},onOneFontLoad:function(e,t,i,n){this._fontsToLoadLeft--,0==this._fontsToLoadLeft&&r.Z.delay(this.onAllFontsLoad,500)},onAllFontsLoad:function(){r.Z.each(this._onFontsLoad,(function(e){e&&e()}))},updateViewport:function(){var e=this.getPageViewport();e!==this.pageViewport&&(this.pageViewport=e,this.createLQBackground(),this.shown&&(this.loadAnimationsReady=!1,this.createWidgetsForCurrentViewport(),this.started&&(this.started=!1,this.start())))},waitForAnimationEnd:function(e){this.resetWaitHook=d.default.waitForTransitionEnd(this.$el,this.mag.getPageTransitionTime()+1e3,"transform",e)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},backToTop:function(){this.scrollTo(0)},scrollTo:function(e){this.$scrollWrapper.finish(),this.$scrollWrapper&&this.$scrollWrapper.animate({scrollTop:e},500)},focusPage:function(){y.Z.isDesktop&&"vertical"!==this.viewerType&&0===this.$el[0].getBoundingClientRect().left&&(this.$content.focus(),this.mag.$el.scrollTop(0))},markAsLast:function(){this.lastPage=!0,this.$el.addClass("last")},isLastPage:function(){return!!this.lastPage},isBottomArrowVisible:function(){return!this.wasScrolled&&this.scrollable},isPasswordProtected:function(){return this.unauthorized},scrollPageALittle:function(){this.$scrollWrapper.animate({scrollTop:(0,n.Z)(window).height()/2},500)},getPageViewport:function(){var e=this.mag.viewport,t=this;if("default"===e||RM.screenshot)return"default";if(this["viewport_"+e]&&this["viewport_"+e].enabled)return e;var i=r.Z.findWhere(v.ZP.viewports,{name:e}).width,n=r.Z.reduce(v.ZP.viewports,(function(e,n,a){return("default"==n.name||t["viewport_"+n.name]&&t["viewport_"+n.name].enabled)&&Math.abs(n.width-i)<=Math.abs(v.ZP.viewports[e].width-i)?a:e}),0);return v.ZP.viewports[n].name},onResize:function(e){if(e=e||{},this.shown||"horizontal"!==this.viewerType){var t=[v.sJ.PhonePortrait,v.sJ.TabletPortrait].includes(this.mag.viewport)&&this.pageViewport===v.sJ.Default&&this.mag.isPreview,i=(0,P._)("constructor.enhancedMobileFrame")&&this.pageViewport===v.sJ.PhonePortrait&&"top"===this.mag.viewOpts.phoneVerticalAlign,n=this.mag.getContainerSizeCached(),a=this.mag.getViewportWidth(this.pageViewport),s=v.ZP.dictionary[this.pageViewport].width,r=this.mag.getScale(this.pageViewport),o=this["viewport_"+this.pageViewport]&&this["viewport_"+this.pageViewport].height||this.height,c={width:s,height:o,scaledWidth:Math.round(a*r),scaledHeight:Math.round(o*r),scale:r},l=RM.screenshot&&"true"===d.default.queryUrlGetParam("pdf"),u=Math.min(c.scaledWidth,n.width),p=c.scaledHeight,g=l||i?0:Math.max(((RM.screenshot?672:n.height)-p)/2,0),m=Math.max(((RM.screenshot?1024:n.width)-u)/2,0)+(a-s)/2,f={width:c.width,height:c.height,top:i?0:g/(h.Z.isCSSZoom()&&h.Z.isDesktopDefault(this.pageViewport)&&!t?r:1),left:m};if(h.Z.isOn(this.pageViewport,a,this.mag.opts)&&h.Z.isCSSZoom()&&!t&&(f.zoom=r,f.left=n.width>this.mag.opts.scalewidth?(n.width/r-s)/2:(a-s)/2),this.$content.removeAttr("style"),this.$content.css(f),this.contentPosition={left:m,top:g},t||1!==h.Z.normalize(r,"transform",this.pageViewport,a,this.mag.viewOpts)?(d.default.applyTransform(this.$content,"scale("+c.scale+")"),h.Z.isDesktopDefault(this.pageViewport)&&!t?this.$content.css({left:Math.max((n.width-u)/2,0)+(a-s)/2*c.scale}):this.$content.css({left:(a-s)/2*c.scale})):d.default.applyTransform(this.$content,""),this.contentHeight=o,this.pageHeight=this.isPasswordProtected()?n.height:Math.max(n.height,Math.round(o*r)),this.pageBgHeight=n.height,this.pageWidth=a,"vertical"===this.viewerType&&this.isStickyVerticalViewer&&this.$el.css({height:this.pageHeight,top:e.absolutePosition}),this.scale=r,this.$contentBounds.css({width:n.width,height:this.pageHeight}),void 0!==this.prevScale&&this.prevScale!==this.scale&&this.animations){var b,w=null===(b=this.animations.animations)||void 0===b?void 0:b.filter((function(e){return O.findPlayingVideo(e.widgets)}));this.animations.updateTimelines(w.map((function(e){return e.animation.UUID}))),this.animations.resetStarted(),this.animations.start.__debounced()}return this.animations&&this.animations.onResize(),this.trigger("resize",{containerSize:n,contentPosition:this.contentPosition}),this.scrollable=Math.round(o*r)-this.mag.SCROLLABLE_TRESHOLD>n.height,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.top=-g,this.visibleWidgetsCoords.bottom=-g+n.height,this.visibleWidgetsCoords.scale=r,this.resizeLQBackground(),this.prevScale=this.scale,this.pageHeight}},onScroll:function(){this.wasScrolled=!0,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=this.$scrollWrapper.scrollTop(),this.mag.onCurrentPageScroll(this,this.visibleWidgetsCoords.scrollTop),this.animations&&this.animations.onScroll(),this.trigger("page scroll",this.visibleWidgetsCoords.scrollTop)},isCurrent:function(){return this.num===this.mag.currentPage.num},showPagePasswordForm:(x=S(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(52).then(i.bind(i,1132));case 2:t=e.sent,a=t.default,this.pagePasswordView=new a({router:this.router,mag:this.mag,page:this,$parent:(0,n.Z)("#page-".concat(this.num,"-password-container"))}),this.pagePasswordView.render();case 6:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),createLQBackground:function(){if(!RM.screenshot&&!this.isPasswordProtected()){var e=this.getWidgetViewportData(r.Z.findWhere(this.widgetsData,{type:"background"}),this.pageViewport);if(this.LQBG){if("picture"===e.selectedType&&"picture"===this.LQBG.selectedType&&e.picture&&this.LQBG.picture&&e.picture.poorUrl===this.LQBG.picture.poorUrl||"video"===e.selectedType&&"video"===this.LQBG.selectedType&&e.video&&this.LQBG.video&&e.video.thumbnail_url===this.LQBG.video.thumbnail_url)return void this.resizeLQBackground();this.destroyLQBackground({animate:!1})}if(this.$fixedBgContainer.css("background-color","#"+e.color),e.picture&&"picture"===e.selectedType&&(e.picture.poorUrl||l.Z.useLambdaUrl(e.picture))||e.video&&"video"===e.selectedType&&e.video.thumbnail_url){this.LQBG=r.Z.extend({},e);var t=$["template-viewer-widget-background"];if(this.LQBG.$el=(0,n.Z)(t({data:e})),this.LQBG.$el.addClass("low-quality").appendTo(this.$fixedBgContainer),"picture"===this.LQBG.selectedType){var i=this.LQBG.picture.poorUrl;l.Z.useLqipUrl(e.picture)&&(i=l.Z.getLqipUrl(this.LQBG.picture),this.LQBG.$el.addClass("lqip").appendTo(this.$fixedBgContainer)),(0,n.Z)("<img/>").on("load",r.Z.bind((function(){this.LQBG&&this.LQBG.$el.find(".picture-background").css({"background-image":"url(".concat(i,")")})}),this)).attr("src",i)}if("video"===this.LQBG.selectedType){var a=this.LQBG.video.thumbnail_url.replace("http://","https://"),s=(0,n.Z)("<img/>").addClass("poster").css("opacity",0).appendTo(this.LQBG.$el.find(".video-background .video-container"));s.on("load",r.Z.bind((function(){s.css({width:"",height:""}).css("opacity",1);var e=s[0].width,t=s[0].height;this.LQBG&&!this.LQBG.video.aspect_poster&&(this.LQBG.video.aspect_poster=e/t),this.resizeLQBackground()}),this)).attr("src",a)}}}},resizeLQBackground:function(){RM.screenshot||this.isPasswordProtected()||!this.LQBG||"video"===this.LQBG.selectedType&&m.Z.setVideoPosition({mag:this.mag,$container:this.LQBG.$el.find(".video-background .video-container"),$media:this.LQBG.$el.find(".video-background .video-container .poster"),provider:this.LQBG.video.provider_name,aspect_poster:this.LQBG.video.aspect_poster,aspect_real:this.LQBG.video.aspect_real,controls_remove:!0})},destroyLQBackground:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!RM.screenshot&&!this.isPasswordProtected()&&this.LQBG){e.animate=e.animate&&"picture"===this.LQBG.selectedType&&this.started;var t=this.LQBG.$el;this.LQBG=null,e.animate?(t.css("opacity",0),setTimeout((function(){t.remove()}),400)):t.remove()}},fixSafariScroll:function(e){Modernizr.safari&&y.Z.isDesktop&&(0!==this.$scrollWrapper.scrollTop()&&this.$scrollWrapper.scrollTop(0))}},{getScreenIndex:function(e,t,i,n){var a,s=Math.floor((e.y-t)/i),r=Math.ceil((e.y+e.h-t)/i)-1;return n&&e.canRenderImmediately()?a=1/0:e.hasLoadAnimation()||s<=0&&r>=0?a=0:s>0?a=s:r<0&&(a=r),{start:s,end:r!==1/0?r:0,index:a}},findPlayingVideo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.find((function(e){return"video"===e.type&&e.isPlaying}))}});t.Z=O},1067:function(e,t,i){"use strict";var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(1068),c=i(854),d=i(308),l=i(324),h=i(348),u=s().View.extend({template:o.Z["template-viewer-share"],events:{"click .buttons-wrapper .button":"share","click .send-report":"share","click .open-embed":"openEmbed","click .close":"hide","click .embed-wrapper .back":"closeEmbed","click .embed-wrapper .embed-code":"selectEmbedCode","keyup .embed-wrapper .embed-code":"onKeyUp","click .type-selector":"onTypeSelectorClick","click .size-selector":"onSizeSelectorClick",click:"onClick"},initialize:function(e){return r.Z.bindAll(this),r.Z.extend(this,e),this},render:function(){return this.setElement(this.template({hasOverlay:l.Z.isPhone,common:RM.common,icons:{sprite:(0,h.findImagePath)("./viewer/share/sprite".concat(h.is2X?"@2x":"",".png")),thumbArrows:(0,h.findImagePath)("./viewer/share/thumb-arrows".concat(h.is2X?"@2x":"",".png")),thumbOpen:(0,h.findImagePath)("./viewer/share/thumb-open".concat(h.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.selectFullMode(),l.Z.isPhone&&(this.shareSwipe=this.$el.RMSwipe({minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,beforeAutoAnimation:r.Z.bind((function(e,t){return{autoAnimate:!0,immediateCallback:!0}}),this),getCurrentConstraints:r.Z.bind((function(e){var t={},i=this.$el.filter(".share-popup");return t.$referenceItem=i,t.$moveItems=i,t.up={max:0,noTrigger:!0},t.down={max:i.height()},t}),this),callback:r.Z.bind((function(e){this.hide()}),this)}).data("swipe")),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+n.Z.keycodes.esc,this.hide),(0,n.Z)("body").on("click",this.hideOnBodyClick),this},show:function(){return this.shown||(clearTimeout(this.hideTimeout),this.$el.removeClass("hidden"),this.$el.height(),this.$el.addClass("show-popup"),this.$container.addClass("no-hover"),this.shown=!0,this.updateEmbed()),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.$el.removeClass("show-popup"),this.$container.removeClass("no-hover"),this.hideTimeout=setTimeout(r.Z.bind((function(){this.closeEmbed(),this.$el.addClass("hidden")}),this),400),this.shown=!1),this},destroy:function(){return clearTimeout(this.hideTimeout),(0,n.Z)("body").off("click",this.hideOnBodyClick),this.shareSwipe&&this.shareSwipe.destroy(),this.remove()},hideOnBodyClick:function(e){l.Z.isPhone||(0,n.Z)(e.target).closest(this.$container).length||this.hide()},onPageChange:function(e,t){this.hide()},onClick:function(e){l.Z.isPhone&&(0,n.Z)(e.currentTarget).hasClass("share-popup-overlay")&&this.hide()},onKeyUp:function(e){e.stopPropagation()},openEmbed:function(e){this.router.analytics&&this.router.analytics.sendEvent("Embed","contents ("+this.shareMode+")"),this.selectEmbedCode(),this.$el.addClass("show-embed")},updateEmbed:function(){var e,t=this.mag.currentPage||this.mag.pages[0],i=this.$(".size-selector").attr("data-selected");t&&t.unauthorized||(this.$(".embed-wrapper .embed-code").val(u.getEmbedCode({shareMode:this.shareMode,cur_page_num_id:t.num_id,mag_num_id:this.mag.num_id,size:{responsive:"responsive",big:512,small:288}[i]})),e=this.mag.model.getPageScreenshot(256,{_id:"page"===this.shareMode?t._id:this.mag.coverPid}),this.currentEmbedSrc!==e&&(this.$(".thumb-pic").attr("src",e),this.currentEmbedSrc=e))},closeEmbed:function(){this.$el.removeClass("show-embed")},share:function(e){c.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:(0,n.Z)(e.currentTarget).attr("data-tp"),source:"share panel",page:this.mag.currentPage||this.mag.pages[0],mag:r.Z.extend(this.mag.model.toJSON(),{user:this.mag.user}),forProject:"full"===this.shareMode,customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!==RM.common.embedDomainType),analytics:this.router.analytics,exportBasePath:window.RM.common.isDownloadedSource?window.RM.config&&window.RM.config.root:void 0})},onTypeSelectorClick:function(e){if(l.Z.isPhone){var t=(0,n.Z)(e.target);t.closest(".type-full").length&&this.selectFullMode(),t.closest(".type-page").length&&this.selectPageMode()}else{"page"===(this.$(".type-selector").attr("data-tp")||"page")?this.selectFullMode():this.selectPageMode()}},onSizeSelectorClick:function(e){var t,i,a=(0,n.Z)(e.currentTarget),s=a.attr("data-selected");i=(i=(t=r.Z.map(a.find(".size"),(function(e){return(0,n.Z)(e).attr("data-size")}))).indexOf(s)+1)>=t.length?0:i,a.attr("data-selected",t[i]),this.updateEmbed()},selectPageMode:function(){this.$(".type-selector").attr("data-tp","page"),this.shareMode="page",this.updateEmbed()},selectFullMode:function(){this.$(".type-selector").attr("data-tp","full"),this.shareMode="full",this.updateEmbed()},selectEmbedCode:function(){l.Z.isDesktop&&this.$(".embed-wrapper .embed-code").get(0).setSelectionRange(0,9999)}},{getEmbedCode:function(e){var t,i,n,a,s='<script async src="'+d.ZP.EMBED_SCRIPT_INIT+'" id="readymag-embed-init"><\/script>';return t=RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname,a=' data-uri="'+(i="full"===e.shareMode?e.mag_num_id:"p"+e.cur_page_num_id)+'" ',a+=' data-width="'+e.size+'" ',(RM.common.isDomainViewer||RM.common.embedDomainName)&&(a+=' data-domain="'+t+'" ',RM.common.customDomainProfile||"User"===RM.common.embedDomainType||(i="full"===e.shareMode?"":"p"+e.cur_page_num_id)),d.ZP.IS_LIVE||(a+=' data-origin="'+d.ZP.readymag_embed_host+'" '),'<a class="rm-mag-embed" href="'+(n=t+"/"+i)+'"'+a+' target="_blank">'+n+"</a>\n"+s}});t.Z=u},1065:function(e,t,i){"use strict";var n=i(313),a=i(337),s=i.n(a),r=i(322),o=i(1066),c=i(1067),d=i(1069),l=i(324),h=i(348),u=s().View.extend({PAGE_COUNTER_TIMEOUT:2800,PAGE_COUNTER_TIMEOUT_INITIAL:4e3,brandingInToolbar:!1,template:o.Z["template-viewer-toolbar"],events:{"click .menu-button":"toggleMenu","click .share-button":"toggleShare","click .embed-close-button":"onEmbedCloseClick"},initialize:function(e){return r.Z.bindAll(this),r.Z.extend(this,e),this},render:function(){if(this.setElement(this.template({mag:this.mag,isPreview:this.isPreview,hasMenu:this.hasMenu,hasShare:this.hasShare,hasPageCounter:this.hasPageCounter,pageCounterInsideMenu:this.hasMenu&&l.Z.isPhone,totalPages:this.mag.getPagesCount(),common:RM.common,controlsOnTop:this.controlsOnTop,brandingInToolbar:this.brandingInToolbar,icons:{sprite:(0,h.findImagePath)("./common/toolbar/sprite".concat(h.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.$menuButton=this.$el.find(".menu-button"),this.$shareButton=this.$el.find(".share-button"),this.$pageCounter=this.$el.find(".page-counter"),this.$pageCounterWrapper=this.$pageCounter.parent(),this.hasShare&&(this.share=new c.Z({mag:this.mag,router:this.router,$container:l.Z.isPhone?this.$container:this.$shareButton}).render(),this.hasMenu||this.$shareButton.addClass("without-menu-button")),this.hasMenu&&(this.magMenu=new d.Z({mag:this.mag,pages:this.pages,router:this.router,isPreview:this.isPreview,hasProjectInfo:this.hasProjectInfo,publishDate:this.publishDate,$container:this.$container,$toolbar:this.$el,viewerType:this.viewerType,showInitially:this.isSettingsOpened}).render()),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"menuShown",this.onMenuShow),this.listenTo(this.mag,"menuHidden",this.onMenuHide),this.listenTo(this.mag,"presentationModeOn",this.onPresentationModeOn),this.listenTo(this.mag,"presentationModeOff",this.onPresentationModeOff),!this.isPreview){var e=this.$(".offscreen-initially:visible"),t=150*e.length+800;e.each((function(e,i){setTimeout((function(){(0,n.Z)(i).removeClass("offscreen-initially")}),t),t-=150}))}return this.$("div[data-alt]:not(.rmalttext), a[data-alt]:not(.rmalttext)").RMAltText(),this},destroy:function(){return this.share&&this.share.destroy(),this.magMenu&&this.magMenu.destroy(),this.remove()},isMenuOpened:function(){return!!this.menuShown},closeMenu:function(){this.magMenu&&this.magMenu.hide()},onPageChange:function(e,t){this.showPageCounter(e,t),this.$menuButton.removeClass("waiting-video-bg-start preloading"),this.prevPage&&this.stopListening(this.prevPage),e&&(e.loaded||(this.$menuButton.addClass("preloading"),this.listenTo(e,"pageLoaded",this.onPageLoaded)),e.hasVideoBG&&!e.videoBGStarted&&(this.$menuButton.addClass("waiting-video-bg-start"),this.listenTo(e,"videoBGStarted",this.onVideoBGStarted)),this.prevPage=e)},onPageLoaded:function(){this.$menuButton.removeClass("preloading")},onVideoBGStarted:function(){this.$menuButton.removeClass("waiting-video-bg-start")},onPresentationModeOn:function(){this.isPresentationMode=!0,this.updateVisibilityState()},onPresentationModeOff:function(){this.isPresentationMode=!1,this.updateVisibilityState()},updateVisibilityState:function(){this.isPresentationMode?this.$el.stop().fadeOut(200):this.$el.stop().fadeIn(200)},onMenuShow:function(){this.menuShown=!0,this.hidePageCounter()},onMenuHide:function(){this.menuShown=!1},getPageCounterSize:function(e){if(!this.cachedPageCounterData){this.$pageCounter.find(".cur").text("0");var t=this.$pageCounter.outerWidth();this.$pageCounter.find(".cur").text("00");var i=this.$pageCounter.outerWidth()-t,n=t-i;this.cachedPageCounterData={baseSize:n,digitSize:i},this.$pageCounter.find(".cur").text(e)}var a=this.cachedPageCounterData;return a.baseSize+(e+"").length*a.digitSize},updatePageCounterSize:function(e){this.$pageCounter.length&&this.$pageCounterWrapper.length&&(!this.menuShown&&this.pageCounterShown?this.$pageCounterWrapper.css("width",this.getPageCounterSize(e)):this.$pageCounterWrapper.css("width",""))},showPageCounter:function(e,t){this.hasPageCounter&&(this.$pageCounter.find(".cur").text(e.num),t.showPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.addClass("show-page-counter"),this.pageCounterShown=!0,Modernizr.android?setTimeout(r.Z.bind((function(){this.updatePageCounterSize(e.num)}),this),17):this.updatePageCounterSize(e.num),this.pageCounterTimeout=setTimeout(this.hidePageCounter,t.initial?this.PAGE_COUNTER_TIMEOUT_INITIAL:this.PAGE_COUNTER_TIMEOUT)))},hidePageCounter:function(){this.hasPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.removeClass("show-page-counter"),this.pageCounterShown=!1,this.updatePageCounterSize())},toggleMenu:function(e){this.magMenu&&this.magMenu.toggle()},toggleShare:function(e){(0,n.Z)(e.target).is(this.$shareButton)&&this.share&&this.share.toggle()},postMessageToParent:function(e,t){var i={type:e,data:t},n=window.parent;n&&n.postMessage(JSON.stringify(i),"*")},onEmbedCloseClick:function(e){this.postMessageToParent("close-fullscreen")}});t.Z=u},1028:function(e){var t="codeinjection",i={instagram:[/^\s*<blockquote\s+class=.instagram-media.*<\/blockquote>\s*<script.*src=.*instagram.+>.*<\/script>\s*$/gi],pinterest:[/^\s*<a.*data-pin-do=.*<\/a>([\s\S]*<script.*src=.*pinterest.+>.*<\/script>)?\s*$/i],facebookvideo:[/^\s*<div\s+id=.fb-root.*<\/div>[\s\S]*<script>.*src.*facebook.*sdk.*<\/script>[\s\S]*<div\s+class=.fb-video.*<\/div>\s*$/i],readymag:[/^\s*<a\s+class=.rm-mag-embed.*<\/a>[\s\S]*<script.+id=.readymag-embed-init.+><\/script>\s*$/i],ecommerce:[/^\s*<form\s+action=.*method=.*POST.+>[\s\S]*<script.*src=.*stripe.+>.*<\/script>[\s\S]*<\/form>\s*$/gim,/^\s*(<!--.*-->)?[\s\S]*<script.*src=.*stripe.+>[\s\S]*<\/script>[\s\S]*(<!--.*-->)?[\s\S]*<button .*>.*<\/button>[\s\S]*<div .*>.*<\/div>[\s\S]*<script>.*stripe.*<\/script>\s*$/gim,/^\s*<div\s+id=.+>[\s\S]*<\/div>[\s\S]*<script[\s\S]*scriptUrl[\s\S]*shopifycdn[\s\S]*>*<\/script>.*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<div\s+class=.gumroad-product-embed.+>[\s\S]*<\/div>\s*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<a\s+class=.gumroad-button.+>[\s\S]*<\/a>\s*$/gim,/^\s*<div\s+class=.*ecwid.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>\s*$/gim,/^\s*<div\s+class=.*ecsp.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>\s*$/gim,/^\s*<div\s+class=.*ec-cart-widget.+><\/div>[\s\S]*<div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*Ecwid.*<\/script>[\s\S]*<\/div>\s*$/gim,/^\s*<div\s+id=.*.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>[\s\S]*<\/div>\s*$/gim],gdpr:[/^\s*<a\s+href="https:\/\/www\.iubenda\.com\/privacy-policy\/\d+"[\w\d\s/:;.,'"=-]*>[\w\d\s/:;.,'"=-]*<\/a>\s*<script[\w\d\s/:;.,'"=-]*>\(function\s*\(w,d\)\s*{[\s\S]*s\.src="https:\/\/cdn\.iubenda\.com\/iubenda\.js";[\s\S]*}\)\([\w\s,]*\);<\/script\s*>\s*$/gim,/^\s*<script[\w\d\s/:;.,'="-]*src="https:\/\/consent\.cookiebot\.com\/[\w\d-]+\/cd\.js"[\w\d\s/:;.,'="-]*><\/script\s*>\s*$/gim,/^\s*<script\s*(type="text\/javascript"){0,1}\s*>\s*var\s+cpm\s*=\s*{};\s*\(function\(h,u,b\){[\w\d\s()[\]{}/.,:;="'-]+e\.src='https:\/\/cookiehub\.net(\/dev){0,1}\/c2\/[\w\d-]+\.js';[\w\d\s()[\]{}/.,:;="'-]+}\)\([\w\d\s,]+\);\s*<\/script\s*>\s*$/gim],video:[/^\s*<video[\s\S]*>[\s\S]*<\/video>\s*$/gim],iframe:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.replace(/<!--[\s\S]*-->/gi,"");return/^\s*<iframe[\s\S]*>[\s\S]*<\/iframe>\s*$/i.test(t)}};e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,a=e.trim();for(var s in i){var r=i[s];if("function"==typeof r)return r(a,n)?s:t;for(var o in r)if("function"==typeof(o=r[o])){if(o(a,n))return s}else{var c=new RegExp(o.source,o.flags);if(c.test(a.replace(/\n/g,"")))return s}}return t}}}]);